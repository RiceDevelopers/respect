<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>سلة المشتريات - Gift Star</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/style.css">
<style>
.cart-page {
    padding: 50px 0;
    min-height: 60vh;
}
.cart-grid {
    display: grid;
    grid-template-columns: 1fr 400px;
    gap: 40px;
}
.cart-items-box, .cart-summary-box {
    background: var(--secondary-light);
    border-radius: var(--radius-lg);
    padding: 35px;
    border: 1px solid var(--border);
}
.cart-item {
    display: flex;
    gap: 20px;
    padding: 20px 0;
    border-bottom: 1px solid var(--border);
    position: relative;
}
.cart-item:last-child {
    border-bottom: none;
}
.cart-item-img {
    width: 100px;
    height: 100px;
    border-radius: var(--radius-sm);
    object-fit: cover;
    border: 2px solid var(--border);
}
.cart-item-info {
    flex: 1;
}
.cart-item-name {
    font-weight: 800;
    color: var(--text);
    margin-bottom: 8px;
    font-size: 16px;
}
.cart-item-price {
    font-size: 22px;
    font-weight: 900;
    color: var(--primary);
    margin: 10px 0;
}
.cart-item-remove {
    background: none;
    border: none;
    color: var(--danger);
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    margin-top: 8px;
    padding: 5px 10px;
    border-radius: 20px;
    transition: var(--transition);
}
.cart-item-remove:hover {
    background: rgba(224,85,85,0.1);
}
.summary-row {
    display: flex;
    justify-content: space-between;
    padding: 15px 0;
    font-size: 16px;
    border-bottom: 1px solid var(--border);
    color: var(--text-muted);
}
.summary-total {
    display: flex;
    justify-content: space-between;
    padding: 20px 0 0;
    font-size: 24px;
    font-weight: 900;
    color: var(--text);
    margin-top: 10px;
    border-top: 2px solid var(--border);
}
.btn-checkout {
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    color: var(--secondary);
    border: none;
    width: 100%;
    padding: 18px;
    border-radius: 50px;
    font-size: 18px;
    font-weight: 800;
    margin-top: 25px;
    transition: var(--transition);
    cursor: pointer;
    box-shadow: 0 5px 20px rgba(200,169,110,0.3);
}
.btn-checkout:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 30px rgba(200,169,110,0.4);
}
.empty-cart {
    text-align: center;
    padding: 80px 20px;
}
.empty-cart svg {
    width: 100px;
    height: 100px;
    margin-bottom: 20px;
    color: var(--border);
}
</style>
</head>
<body>
<header class="site-header">
    <div class="header-top">
        <div class="container">
            <span class="header-tagline">توصيل داخل الكويت فقط</span>
            <div class="header-links">
                <a href="cart.html" class="cart-link">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                    </svg>
                    <span class="cart-count" id="cartCount">0</span>
                </a>
                <a href="login.html" class="btn-login" id="loginBtn">تسجيل الدخول</a>
                <a href="#" class="btn-login" id="logoutBtn" style="display:none" onclick="logout()">خروج</a>
            </div>
        </div>
    </div>
    <div class="header-main">
        <div class="container header-flex">
            <a href="index.html" class="logo">
                <div class="logo-star">★</div>
                <div class="logo-text">
                    <span class="logo-gift">Gift</span>
                    <span class="logo-star-word">Star</span>
                </div>
            </a>
            <nav class="main-nav">
                <a href="index.html">الرئيسية</a>
                <a href="shop.html">المتجر</a>
            </nav>
        </div>
    </div>
</header>

<div class="container cart-page">
    <div id="emptyCart" class="empty-cart" style="display:none">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
            <circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
        </svg>
        <h3 style="color:var(--text-muted)">السلة فارغة</h3>
        <p style="color:var(--text-muted);margin:8px 0 20px">لم تضف أي منتجات بعد</p>
        <a href="shop.html" class="btn-primary">تصفح المنتجات</a>
    </div>

    <div class="cart-grid" id="cartContent" style="display:none">
        <div class="cart-items-box">
            <h3 style="font-size:18px;font-weight:700;margin-bottom:20px;">المنتجات</h3>
            <div id="cartItemsList"></div>
        </div>
        <div>
            <div class="cart-summary-box">
                <h3 style="font-size:18px;font-weight:700;margin-bottom:20px;">ملخص الطلب</h3>
                <div class="summary-row">
                    <span>المجموع الفرعي</span>
                    <span id="subTotal">0.000 د.ك</span>
                </div>
                <div class="summary-row">
                    <span>رسوم التوصيل</span>
                    <span id="deliveryFee">1.500 د.ك</span>
                </div>
                <div class="summary-total">
                    <span>الإجمالي</span>
                    <span id="totalAmount">0.000 د.ك</span>
                </div>
                <button class="btn-checkout" onclick="goCheckout()">المتابعة للدفع</button>
                <a href="shop.html" style="display:block;text-align:center;margin-top:12px;color:var(--primary)">متابعة التسوق</a>
            </div>
        </div>
    </div>
</div>

<footer class="site-footer">
    <div class="footer-bottom"><p>© 2024 Gift Star. جميع الحقوق محفوظة - الكويت</p></div>
</footer>
<div class="stars-bg"></div>

<script src="js/data.js"></script>
<script src="js/main.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    if (window.updateHeader) window.updateHeader();
    renderCart();

    window.addEventListener('cartUpdated', renderCart);
});

function renderCart() {
    const cart = window.getCart ? window.getCart() : [];
    const emptyEl = document.getElementById('emptyCart');
    const contentEl = document.getElementById('cartContent');

    if (!cart || cart.length === 0) {
        emptyEl.style.display = 'block';
        contentEl.style.display = 'none';
        return;
    }

    emptyEl.style.display = 'none';
    contentEl.style.display = 'grid';

    const subtotal = window.getCartTotal ? window.getCartTotal() : 0;
    const delivery = subtotal > 15 ? 0 : 1.500;
    const total = subtotal + delivery;
    const format = window.formatKWD || (a => a.toFixed(3) + ' د.ك');

    document.getElementById('cartItemsList').innerHTML = cart.map(item => `
        <div class="cart-item">
            <img src="${item.image}" alt="${item.name}" class="cart-item-img" onerror="this.src='https://images.unsplash.com/photo-1549465220-1a8b9238cd48?w=80&h=80&fit=crop'">
            <div class="cart-item-info">
                <div class="cart-item-name">${item.name}</div>
                <div style="display:flex;align-items:center;gap:12px;margin:6px 0">
                    <button style="background:none;border:1px solid var(--border);width:28px;height:28px;border-radius:50%;cursor:pointer" onclick="updateQty(${item.id}, -1)">-</button>
                    <span style="font-weight:700">${item.qty}</span>
                    <button style="background:none;border:1px solid var(--border);width:28px;height:28px;border-radius:50%;cursor:pointer" onclick="updateQty(${item.id}, 1)">+</button>
                </div>
                <div class="cart-item-price">${format(item.price * item.qty)}</div>
                <button class="cart-item-remove" onclick="removeItem(${item.id})">حذف</button>
            </div>
        </div>
    `).join('');

    document.getElementById('subTotal').textContent = format(subtotal);
    document.getElementById('deliveryFee').textContent = delivery === 0 ? 'مجاني' : format(delivery);
    document.getElementById('totalAmount').textContent = format(total);
}

window.updateQty = (id, dir) => {
    let cart = window.getCart ? window.getCart() : [];
    const item = cart.find(i => i.id === id);
    if (!item) return;

    item.qty = Math.max(1, item.qty + dir);
    if (window.saveCart) window.saveCart(cart);
    renderCart();
}

window.removeItem = (id) => {
    if (window.removeFromCart) window.removeFromCart(id);
    renderCart();
}

window.goCheckout = () => {
    const user = window.getCurrentUser ? window.getCurrentUser() : null;
    if (!user) {
        sessionStorage.setItem('giftstar_redirect_after_login', 'checkout.html');
        window.location.href = 'login.html?msg=login_required';
        return;
    }
    window.location.href = 'checkout.html';
}

window.logout = () => { if (window.logout) window.logout(); }
</script>

<!-- كود Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyCtHnYZT8yq9tp7xaA7AyJQV4Ag4Wi1Yks",
    authDomain: "gift-star-abf48.firebaseapp.com",
    projectId: "gift-star-abf48",
    storageBucket: "gift-star-abf48.firebasestorage.app",
    messagingSenderId: "546782076914",
    appId: "1:546782076914:web:3fb957a03c7e0501fc556b"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.db = db;
console.log('✅ Firebase loaded');
</script>

<!-- Firebase Messaging -->
<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/firebase-messaging-sw.js').catch(console.error);
}
</script>
</body>
</html>
