<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>سلة المشتريات - Gift Star</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/style.css">
</head>
<body>
<header class="site-header">
  <div class="header-top">
    <div class="container">
      <span class="header-tagline">توصيل داخل الكويت فقط</span>
      <div class="header-links">
        <a href="cart.html" class="cart-link">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
          <span class="cart-count" id="cartCount">0</span>
        </a>
        <a href="login.html" class="btn-login" id="loginBtn">تسجيل الدخول</a>
        <a href="#" class="btn-login" id="logoutBtn" style="display:none" onclick="logout()">خروج</a>
      </div>
    </div>
  </div>
  <div class="header-main">
    <div class="container header-flex">
      <a href="index.html" class="logo">
        <div class="logo-star">★</div>
        <div class="logo-text"><span class="logo-gift">Gift</span><span class="logo-star-word">Star</span></div>
      </a>
      <nav class="main-nav">
        <a href="index.html">الرئيسية</a>
        <a href="shop.html">المتجر</a>
      </nav>
    </div>
  </div>
</header>

<div class="page-hero">
  <h1>سلة المشتريات</h1>
</div>

<div class="container cart-page">
  <div id="emptyCart" style="display:none;text-align:center;padding:80px 20px">
    <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="var(--border)" stroke-width="1" style="margin:0 auto 20px"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
    <h3 style="color:var(--text-muted)">السلة فارغة</h3>
    <p style="color:var(--text-muted);margin:8px 0 20px">لم تضف أي منتجات بعد</p>
    <a href="shop.html" class="btn-primary">تصفح المنتجات</a>
  </div>
  <div class="cart-grid" id="cartContent">
    <div class="cart-items-box">
      <h3 style="font-size:18px;font-weight:700;margin-bottom:20px;color:var(--secondary)">المنتجات</h3>
      <div id="cartItemsList"></div>
    </div>
    <div>
      <div class="cart-summary-box">
        <h3 style="font-size:18px;font-weight:700;margin-bottom:20px;color:var(--secondary)">ملخص الطلب</h3>
        <div class="summary-row">
          <span>المجموع الفرعي</span>
          <span id="subTotal">0.000 د.ك</span>
        </div>
        <div class="summary-row">
          <span>رسوم التوصيل</span>
          <span id="deliveryFee">1.500 د.ك</span>
        </div>
        <div class="summary-total">
          <span>الإجمالي</span>
          <span id="totalAmount">0.000 د.ك</span>
        </div>
        <button class="btn-checkout" onclick="goCheckout()">المتابعة للدفع</button>
        <a href="shop.html" style="display:block;text-align:center;margin-top:12px;font-size:14px;color:var(--primary)">متابعة التسوق</a>
      </div>
    </div>
  </div>
</div>

<footer class="site-footer">
  <div class="footer-bottom" style="padding:20px 0">
    <p>© 2024 Gift Star. جميع الحقوق محفوظة - الكويت</p>
  </div>
</footer>

<script src="js/data.js"></script>
<script src="js/main.js"></script>
<script>
function init() {
  updateHeader();
  renderCart();
}

function renderCart() {
  const cart = getCart();
  const emptyEl = document.getElementById('emptyCart');
  const contentEl = document.getElementById('cartContent');

  if (!cart.length) {
    emptyEl.style.display = 'block';
    contentEl.style.display = 'none';
    return;
  }

  emptyEl.style.display = 'none';
  contentEl.style.display = 'grid';

  const subTotal = getCartTotal();
  const delivery = subTotal > 15 ? 0 : 1.500;
  const total = subTotal + delivery;

  document.getElementById('cartItemsList').innerHTML = cart.map(item => `
    <div class="cart-item">
      <img src="${item.image}" alt="${item.name}" class="cart-item-img" onerror="this.src='https://images.unsplash.com/photo-1549465220-1a8b9238cd48?w=80&h=80&fit=crop'">
      <div class="cart-item-info">
        <div class="cart-item-name">${item.name}</div>
        <div style="display:flex;align-items:center;gap:12px;margin:6px 0">
          <button style="background:none;border:1px solid var(--border);width:28px;height:28px;border-radius:50%;cursor:pointer" onclick="updateQty(${item.id}, -1)">-</button>
          <span style="font-weight:700">${item.qty}</span>
          <button style="background:none;border:1px solid var(--border);width:28px;height:28px;border-radius:50%;cursor:pointer" onclick="updateQty(${item.id}, 1)">+</button>
        </div>
        <div class="cart-item-price">${(item.price * item.qty).toFixed(3)} د.ك</div>
        <button class="cart-item-remove" onclick="removeItem(${item.id})">حذف</button>
      </div>
    </div>
  `).join('');

  document.getElementById('subTotal').textContent = subTotal.toFixed(3) + ' د.ك';
  document.getElementById('deliveryFee').textContent = delivery === 0 ? 'مجاني' : delivery.toFixed(3) + ' د.ك';
  document.getElementById('totalAmount').textContent = total.toFixed(3) + ' د.ك';
}

function updateQty(id, dir) {
  let cart = getCart();
  const item = cart.find(i => i.id === id);
  if (!item) return;
  item.qty = Math.max(1, item.qty + dir);
  saveCart(cart);
  updateCartBadge();
  renderCart();
}

function removeItem(id) {
  removeFromCart(id);
  renderCart();
}

function goCheckout() {
  const user = getCurrentUser();
  if (!user) {
    sessionStorage.setItem('giftstar_redirect_after_login', 'checkout.html');
    window.location.href = 'login.html?msg=login_required';
    return;
  }
  window.location.href = 'checkout.html';
}

init();
</script>
</body>
</html>
