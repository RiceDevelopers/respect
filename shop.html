<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>المتجر - Gift Star</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/style.css">
</head>
<body>
<header class="site-header">
  <div class="header-top">
    <div class="container">
      <span class="header-tagline">توصيل داخل الكويت فقط</span>
      <div class="header-links">
        <a href="cart.html" class="cart-link">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
          <span class="cart-count" id="cartCount">0</span>
        </a>
        <a href="login.html" class="btn-login" id="loginBtn">تسجيل الدخول</a>
        <a href="#" class="btn-login" id="logoutBtn" style="display:none" onclick="logout()">خروج</a>
      </div>
    </div>
  </div>
  <div class="header-main">
    <div class="container header-flex">
      <a href="index.html" class="logo">
        <div class="logo-star">★</div>
        <div class="logo-text">
          <span class="logo-gift">Gift</span>
          <span class="logo-star-word">Star</span>
        </div>
      </a>
      <nav class="main-nav">
        <a href="index.html">الرئيسية</a>
        <a href="shop.html" class="active">المتجر</a>
        <a href="shop.html?cat=cakes">كيك</a>
        <a href="shop.html?cat=flowers">ورد</a>
        <a href="shop.html?cat=gifts">هدايا</a>
      </nav>
    </div>
  </div>
</header>

<div class="page-hero">
  <h1>تسوق هداياك</h1>
  <p>اكتشف أجمل تشكيلة من الكيك والورد والهدايا الكويتية</p>
</div>

<div class="container">
  <div class="shop-layout">
    <aside class="shop-sidebar">
      <div class="sidebar-section">
        <h3>الفئات</h3>
        <button class="filter-btn active" onclick="filterByCategory('all', this)">جميع المنتجات</button>
        <button class="filter-btn" onclick="filterByCategory('cakes', this)">كيك</button>
        <button class="filter-btn" onclick="filterByCategory('flowers', this)">ورد</button>
        <button class="filter-btn" onclick="filterByCategory('gifts', this)">هدايا</button>
        <button class="filter-btn" onclick="filterByCategory('chocolate', this)">شوكولاتة</button>
      </div>
      <div class="sidebar-section" style="margin-top:24px">
        <h3>السعر (د.ك)</h3>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input type="number" id="priceMin" placeholder="من" class="form-input" style="padding:8px;font-size:13px">
          <input type="number" id="priceMax" placeholder="إلى" class="form-input" style="padding:8px;font-size:13px">
        </div>
        <button class="btn-primary" style="margin-top:10px;width:100%;padding:9px" onclick="filterByPrice()">تطبيق</button>
      </div>
    </aside>

    <div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
        <span id="resultsCount" style="color:var(--text-muted);font-size:14px"></span>
        <select class="form-select" style="width:auto;padding:8px 14px;font-size:14px" onchange="sortProducts(this.value)" id="sortSelect">
          <option value="default">الترتيب الافتراضي</option>
          <option value="price-asc">السعر: من الأقل للأعلى</option>
          <option value="price-desc">السعر: من الأعلى للأقل</option>
        </select>
      </div>
      <div class="products-grid" id="productsGrid">
        <div class="loading"><div class="spinner"></div>جاري التحميل...</div>
      </div>
    </div>
  </div>
</div>

<footer class="site-footer">
  <div class="footer-bottom" style="padding:20px 0">
    <p>© 2024 Gift Star. جميع الحقوق محفوظة - الكويت</p>
  </div>
</footer>

<script src="js/data.js"></script>
<script src="js/main.js"></script>
<script>
let allProducts = [];
let filteredProducts = [];
let currentCategory = 'all';

function init() {
  updateHeader();
  allProducts = getData('products', []).filter(p => p.active);
  
  const params = new URLSearchParams(window.location.search);
  const cat = params.get('cat');
  if (cat) {
    currentCategory = cat;
    document.querySelectorAll('.filter-btn').forEach(b => {
      b.classList.toggle('active', b.onclick.toString().includes(`'${cat}'`));
    });
  }
  
  renderShopProducts();
}

function renderShopProducts() {
  const grid = document.getElementById('productsGrid');
  filteredProducts = currentCategory === 'all' 
    ? [...allProducts] 
    : allProducts.filter(p => p.category === currentCategory);

  const sort = document.getElementById('sortSelect').value;
  if (sort === 'price-asc') filteredProducts.sort((a,b) => a.price - b.price);
  if (sort === 'price-desc') filteredProducts.sort((a,b) => b.price - a.price);

  document.getElementById('resultsCount').textContent = `${filteredProducts.length} منتج`;

  if (!filteredProducts.length) {
    grid.innerHTML = '<div class="loading">لا توجد منتجات في هذه الفئة</div>';
    return;
  }

  grid.innerHTML = filteredProducts.map(p => `
    <div class="product-card" onclick="window.location.href='product.html?id=${p.id}'" style="cursor:pointer">
      ${p.badge ? `<span class="product-badge">${p.badge}</span>` : ''}
      <img src="${p.image}" alt="${p.name}" class="product-img" onerror="this.src='https://images.unsplash.com/photo-1549465220-1a8b9238cd48?w=400&h=300&fit=crop'">
      <div class="product-info">
        <h3 class="product-name">${p.name}</h3>
        <p class="product-desc">${p.description.substring(0,70)}...</p>
        <div class="product-footer">
          <div class="product-price">${p.price.toFixed(3)} <span>د.ك</span></div>
          <button class="btn-add-cart" onclick="event.stopPropagation();handleAddToCart(${p.id}, this)">أضف للسلة</button>
        </div>
      </div>
    </div>
  `).join('');
}

function filterByCategory(cat, btn) {
  currentCategory = cat;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderShopProducts();
}

function sortProducts(val) { renderShopProducts(); }

function filterByPrice() {
  const min = parseFloat(document.getElementById('priceMin').value) || 0;
  const max = parseFloat(document.getElementById('priceMax').value) || Infinity;
  filteredProducts = allProducts.filter(p => 
    (currentCategory === 'all' || p.category === currentCategory) &&
    p.price >= min && p.price <= max
  );
  const grid = document.getElementById('productsGrid');
  document.getElementById('resultsCount').textContent = `${filteredProducts.length} منتج`;
  if (!filteredProducts.length) {
    grid.innerHTML = '<div class="loading">لا توجد منتجات بهذا النطاق السعري</div>';
    return;
  }
  grid.innerHTML = filteredProducts.map(p => `
    <div class="product-card" onclick="window.location.href='product.html?id=${p.id}'" style="cursor:pointer">
      ${p.badge ? `<span class="product-badge">${p.badge}</span>` : ''}
      <img src="${p.image}" alt="${p.name}" class="product-img">
      <div class="product-info">
        <h3 class="product-name">${p.name}</h3>
        <p class="product-desc">${p.description.substring(0,70)}...</p>
        <div class="product-footer">
          <div class="product-price">${p.price.toFixed(3)} <span>د.ك</span></div>
          <button class="btn-add-cart" onclick="event.stopPropagation();handleAddToCart(${p.id}, this)">أضف للسلة</button>
        </div>
      </div>
    </div>
  `).join('');
}

init();
</script>
</body>
</html>
