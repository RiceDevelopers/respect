<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù„Ù…ØªØ¬Ø± - Gift Star</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/style.css">
<style>
.page-hero {
    background: var(--secondary-light);
    color: var(--text);
    padding: 70px 0;
    text-align: center;
    border-bottom: 1px solid var(--border);
}
.page-hero h1 {
    font-size: 42px;
    font-weight: 900;
    font-family: 'Playfair Display', serif;
    margin-bottom: 15px;
}
.page-hero p {
    opacity: 0.9;
    font-size: 16px;
    max-width: 600px;
    margin: 0 auto;
}
.shop-layout {
    display: grid;
    grid-template-columns: 280px 1fr;
    gap: 40px;
    padding: 50px 0;
}
.shop-sidebar {
    background: var(--secondary-light);
    border-radius: var(--radius);
    padding: 30px;
    height: fit-content;
    border: 1px solid var(--border);
}
.sidebar-section {
    margin-bottom: 30px;
}
.sidebar-section h3 {
    font-size: 18px;
    font-weight: 800;
    margin-bottom: 20px;
    color: var(--text);
    padding-bottom: 10px;
    border-bottom: 2px solid var(--border);
}
.filter-btn {
    display: block;
    width: 100%;
    text-align: right;
    padding: 12px 16px;
    background: none;
    border: 1px solid transparent;
    border-radius: var(--radius-sm);
    font-size: 14px;
    cursor: pointer;
    transition: var(--transition);
    color: var(--text-muted);
    margin-bottom: 8px;
}
.filter-btn:hover,
.filter-btn.active {
    background: linear-gradient(135deg, rgba(200,169,110,0.1), rgba(226,201,142,0.1));
    border-color: var(--primary);
    color: var(--primary);
    transform: translateX(-5px);
}
</style>
</head>
<body>
<header class="site-header">
    <div class="header-top">
        <div class="container">
            <span class="header-tagline">ØªÙˆØµÙŠÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙˆÙŠØª ÙÙ‚Ø·</span>
            <div class="header-links">
                <a href="cart.html" class="cart-link">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                    </svg>
                    <span class="cart-count" id="cartCount">0</span>
                </a>
                <a href="login.html" class="btn-login" id="loginBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
                <a href="#" class="btn-login" id="logoutBtn" style="display:none" onclick="logout()">Ø®Ø±ÙˆØ¬</a>
            </div>
        </div>
    </div>
    <div class="header-main">
        <div class="container header-flex">
            <a href="index.html" class="logo">
                <div class="logo-star">â˜…</div>
                <div class="logo-text">
                    <span class="logo-gift">Gift</span>
                    <span class="logo-star-word">Star</span>
                </div>
            </a>
            <nav class="main-nav">
                <a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a href="shop.html" class="active">Ø§Ù„Ù…ØªØ¬Ø±</a>
            </nav>
        </div>
    </div>
</header>

<div class="page-hero">
    <h1>ØªØ³ÙˆÙ‚ Ù‡Ø¯Ø§ÙŠØ§Ùƒ</h1>
    <p>Ø§ÙƒØªØ´Ù Ø£Ø¬Ù…Ù„ ØªØ´ÙƒÙŠÙ„Ø© Ù…Ù† Ø§Ù„ÙƒÙŠÙƒ ÙˆØ§Ù„ÙˆØ±Ø¯ ÙˆØ§Ù„Ù‡Ø¯Ø§ÙŠØ§ Ø§Ù„ÙƒÙˆÙŠØªÙŠØ©</p>
</div>

<div class="container">
    <div class="shop-layout">
        <aside class="shop-sidebar">
            <div class="sidebar-section">
                <h3>Ø§Ù„ÙØ¦Ø§Øª</h3>
                <button class="filter-btn active" onclick="filterByCategory('all', this)">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
                <button class="filter-btn" onclick="filterByCategory('cakes', this)">ÙƒÙŠÙƒ</button>
                <button class="filter-btn" onclick="filterByCategory('flowers', this)">ÙˆØ±Ø¯</button>
                <button class="filter-btn" onclick="filterByCategory('gifts', this)">Ù‡Ø¯Ø§ÙŠØ§</button>
            </div>
            <div class="sidebar-section">
                <h3>Ø§Ù„Ø³Ø¹Ø±</h3>
                <div style="display:flex; gap:10px;">
                    <input type="number" id="priceMin" class="form-input" placeholder="Ù…Ù†" style="padding:10px;">
                    <input type="number" id="priceMax" class="form-input" placeholder="Ø¥Ù„Ù‰" style="padding:10px;">
                </div>
                <button class="filter-btn" onclick="filterByPrice()" style="margin-top:10px;">ØªØ·Ø¨ÙŠÙ‚</button>
            </div>
        </aside>

        <div>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px">
                <span id="resultsCount" style="color:var(--text-muted); font-size:14px;"></span>
                <select class="form-select" style="width:auto; padding:8px 14px;" onchange="sortProducts(this.value)" id="sortSelect">
                    <option value="default">Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</option>
                    <option value="price-asc">Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø£Ø¹Ù„Ù‰</option>
                    <option value="price-desc">Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø£Ù‚Ù„</option>
                </select>
            </div>
            <div class="products-grid" id="productsGrid">
                <div class="loading"><div class="spinner"></div>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
            </div>
        </div>
    </div>
</div>

<footer class="site-footer">
    <div class="footer-bottom"><p>Â© 2024 Gift Star. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© - Ø§Ù„ÙƒÙˆÙŠØª</p></div>
</footer>
<div class="stars-bg"></div>

<script src="js/data.js"></script>
<script src="js/main.js"></script>
<script>
let allProducts = [];
let filteredProducts = [];
let currentCategory = 'all';

document.addEventListener('DOMContentLoaded', () => {
    if (window.updateHeader) window.updateHeader();

    allProducts = window.getProducts ? window.getProducts({ active: true }) : [];

    const params = new URLSearchParams(window.location.search);
    const cat = params.get('cat');
    if (cat) {
        currentCategory = cat;
        document.querySelectorAll('.filter-btn').forEach(b => {
            b.classList.remove('active');
            if ((cat === 'cakes' && b.textContent.includes('ÙƒÙŠÙƒ')) ||
                (cat === 'flowers' && b.textContent.includes('ÙˆØ±Ø¯')) ||
                (cat === 'gifts' && b.textContent.includes('Ù‡Ø¯Ø§ÙŠØ§'))) {
                b.classList.add('active');
            }
        });
    }

    renderProducts();
});

function renderProducts() {
    filteredProducts = currentCategory === 'all'
        ? [...allProducts]
        : allProducts.filter(p => p.category === currentCategory);

    const sort = document.getElementById('sortSelect').value;
    if (sort === 'price-asc') filteredProducts.sort((a, b) => a.price - b.price);
    else if (sort === 'price-desc') filteredProducts.sort((a, b) => b.price - a.price);

    document.getElementById('resultsCount').textContent = `ğŸ“¦ ${filteredProducts.length} Ù…Ù†ØªØ¬`;

    const grid = document.getElementById('productsGrid');
    if (!filteredProducts.length) {
        grid.innerHTML = '<div class="loading" style="grid-column:1/-1">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</div>';
        return;
    }

    grid.innerHTML = filteredProducts.map(p => `
        <div class="product-card" onclick="window.location.href='product.html?id=${p.id}'">
            ${p.badge ? `<span class="product-badge">${p.badge}</span>` : ''}
            <img src="${p.image}" alt="${p.name}" class="product-img" loading="lazy">
            <div class="product-info">
                <h3 class="product-name">${p.name}</h3>
                <p class="product-desc">${p.description.substring(0, 70)}...</p>
                <div class="product-footer">
                    <div class="product-price">${window.formatKWD ? window.formatKWD(p.price) : p.price.toFixed(3) + ' Ø¯.Ùƒ'}</div>
                    <button class="btn-add-cart" onclick="event.stopPropagation(); window.handleAddToCart(${p.id}, this)">Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©</button>
                </div>
            </div>
        </div>
    `).join('');
}

window.filterByCategory = (cat, btn) => {
    currentCategory = cat;
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    renderProducts();
}

window.sortProducts = () => renderProducts();

window.filterByPrice = () => {
    const min = parseFloat(document.getElementById('priceMin').value) || 0;
    const max = parseFloat(document.getElementById('priceMax').value) || Infinity;

    filteredProducts = allProducts.filter(p =>
        (currentCategory === 'all' || p.category === currentCategory) &&
        p.price >= min && p.price <= max
    );

    document.getElementById('resultsCount').textContent = `ğŸ“¦ ${filteredProducts.length} Ù…Ù†ØªØ¬`;
    const grid = document.getElementById('productsGrid');

    if (!filteredProducts.length) {
        grid.innerHTML = '<div class="loading" style="grid-column:1/-1">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</div>';
        return;
    }

    grid.innerHTML = filteredProducts.map(p => `
        <div class="product-card" onclick="window.location.href='product.html?id=${p.id}'">
            ${p.badge ? `<span class="product-badge">${p.badge}</span>` : ''}
            <img src="${p.image}" alt="${p.name}" class="product-img" loading="lazy">
            <div class="product-info">
                <h3 class="product-name">${p.name}</h3>
                <p class="product-desc">${p.description.substring(0, 70)}...</p>
                <div class="product-footer">
                    <div class="product-price">${window.formatKWD ? window.formatKWD(p.price) : p.price.toFixed(3) + ' Ø¯.Ùƒ'}</div>
                    <button class="btn-add-cart" onclick="event.stopPropagation(); window.handleAddToCart(${p.id}, this)">Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©</button>
                </div>
            </div>
        </div>
    `).join('');
}

window.logout = () => { if (window.logout) window.logout(); }
</script>

<!-- ÙƒÙˆØ¯ Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyCtHnYZT8yq9tp7xaA7AyJQV4Ag4Wi1Yks",
    authDomain: "gift-star-abf48.firebaseapp.com",
    projectId: "gift-star-abf48",
    storageBucket: "gift-star-abf48.firebasestorage.app",
    messagingSenderId: "546782076914",
    appId: "1:546782076914:web:3fb957a03c7e0501fc556b"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.db = db;
console.log('âœ… Firebase loaded');
</script>

<!-- Firebase Messaging -->
<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/firebase-messaging-sw.js').catch(console.error);
}
</script>
</body>
</html>
