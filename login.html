<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - Gift Star</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/style.css">
<style>
  .auth-page {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 40px 20px;
    background: linear-gradient(135deg, var(--secondary) 0%, #0a0e1a 100%);
  }
  .auth-card {
    background: linear-gradient(135deg, var(--secondary-light) 0%, #1a1f2f 100%);
    border-radius: 30px;
    padding: 50px;
    width: 100%;
    max-width: 480px;
    box-shadow: 0 30px 60px rgba(0,0,0,0.5);
    border: 1px solid var(--border);
  }
  .auth-card h2 {
    font-size: 36px;
    font-weight: 900;
    color: var(--text);
    margin-bottom: 10px;
    text-align: center;
    font-family: 'Playfair Display', serif;
  }
  .auth-sub {
    text-align: center;
    color: var(--text-muted);
    font-size: 16px;
    margin-bottom: 40px;
  }
  .form-group {
    margin-bottom: 25px;
  }
  .form-label {
    display: block;
    font-size: 14px;
    font-weight: 700;
    color: var(--text-muted);
    margin-bottom: 8px;
  }
  .form-input {
    width: 100%;
    padding: 16px 20px;
    border: 2px solid var(--border);
    border-radius: 15px;
    font-family: var(--font);
    font-size: 16px;
    color: var(--text);
    background: rgba(0,0,0,0.3);
    transition: all 0.3s ease;
    direction: ltr;
    text-align: left;
  }
  .form-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(200,169,110,0.1);
  }
  .btn-submit {
    width: 100%;
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    color: var(--secondary);
    border: none;
    padding: 18px;
    border-radius: 15px;
    font-size: 18px;
    font-weight: 800;
    transition: all 0.3s ease;
    cursor: pointer;
    margin-top: 20px;
  }
  .btn-submit:hover { 
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(200,169,110,0.4);
  }
  .btn-submit:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  .auth-footer {
    text-align: center;
    margin-top: 25px;
    font-size: 15px;
    color: var(--text-muted);
  }
  .auth-footer a {
    color: var(--primary);
    font-weight: 700;
  }
  .alert {
    padding: 16px 20px;
    border-radius: 15px;
    margin-bottom: 25px;
    font-size: 14px;
    font-weight: 600;
    text-align: center;
  }
  .alert-error {
    background: rgba(224,85,85,0.15);
    color: #ff6b6b;
    border: 1px solid rgba(224,85,85,0.3);
  }
  .alert-success {
    background: rgba(94,201,138,0.15);
    color: #5ec98a;
    border: 1px solid rgba(94,201,138,0.3);
  }
  .reset-btn {
    margin-top: 25px;
    text-align: center;
  }
  .reset-btn button {
    background: none;
    border: 1px solid var(--primary);
    color: var(--primary);
    padding: 10px 20px;
    border-radius: 30px;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  .reset-btn button:hover {
    background: var(--primary);
    color: var(--secondary);
  }
  .demo-accounts {
    margin-top: 30px;
    padding: 20px;
    background: rgba(0,0,0,0.2);
    border-radius: 15px;
    border: 1px solid var(--border);
  }
  .demo-accounts h4 {
    color: var(--primary);
    margin-bottom: 15px;
    text-align: center;
  }
  .demo-account {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    background: rgba(0,0,0,0.2);
    border-radius: 10px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  .demo-account:hover {
    background: rgba(200,169,110,0.1);
    transform: translateX(-5px);
  }
  .demo-account .email {
    color: var(--text);
    font-family: monospace;
  }
  .demo-account .badge {
    background: var(--primary);
    color: var(--secondary);
    padding: 3px 8px;
    border-radius: 12px;
    font-size: 11px;
  }
</style>
</head>
<body>
<header class="site-header">
  <div class="header-main">
    <div class="container header-flex">
      <a href="index.html" class="logo">
        <div class="logo-star">â˜…</div>
        <div class="logo-text">
          <span class="logo-gift">Gift</span>
          <span class="logo-star-word">Star</span>
        </div>
      </a>
    </div>
  </div>
</header>

<div class="auth-page">
  <div class="auth-card">
    <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    <p class="auth-sub">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Gift Star</p>

    <div id="msgBanner" class="alert alert-error" style="display:none"></div>
    <div id="successBanner" class="alert alert-success" style="display:none"></div>

    <div class="form-group">
      <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
      <input type="email" id="email" class="form-input" value="admin@giftstar.kw">
    </div>
    
    <div class="form-group">
      <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
      <input type="password" id="password" class="form-input" value="Admin@2024">
    </div>

    <button class="btn-submit" onclick="doLogin()" id="loginBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>

    <div class="auth-footer">
      Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a href="register.html">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</a>
    </div>

    <div class="demo-accounts">
      <h4>ğŸŒŸ Ø­Ø³Ø§Ø¨Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©</h4>
      <div class="demo-account" onclick="fillCredentials('admin@giftstar.kw', 'Admin@2024')">
        <span class="email">admin@giftstar.kw</span>
        <span class="badge">Ù…Ø¯ÙŠØ±</span>
      </div>
      <div class="demo-account" onclick="fillCredentials('ahmed@test.com', '12345678')">
        <span class="email">ahmed@test.com</span>
        <span class="badge">Ø¹Ù…ÙŠÙ„</span>
      </div>
    </div>

    <div class="reset-btn">
      <button onclick="resetSystem()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù…</button>
    </div>
  </div>
</div>

<script src="js/data.js"></script>
<script>
function fillCredentials(email, password) {
    document.getElementById('email').value = email;
    document.getElementById('password').value = password;
}

function resetSystem() {
    localStorage.clear();
    sessionStorage.clear();
    location.reload();
}

function doLogin() {
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;
    const banner = document.getElementById('msgBanner');
    const loginBtn = document.getElementById('loginBtn');
    
    banner.style.display = 'none';
    
    if (!email || !password) {
        banner.textContent = 'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„';
        banner.style.display = 'block';
        return;
    }
    
    loginBtn.textContent = 'Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...';
    loginBtn.disabled = true;
    
    setTimeout(async () => {
        const result = window.login ? await window.login(email, password) : null;
        
        if (result && result.success) {
            document.getElementById('successBanner').style.display = 'block';
            document.getElementById('successBanner').textContent = 'âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!';
            
            setTimeout(() => {
                const redirect = sessionStorage.getItem('giftstar_redirect_after_login') || 
                               (result.user.role === 'admin' ? 'admin/index.html' : 'index.html');
                sessionStorage.removeItem('giftstar_redirect_after_login');
                window.location.href = redirect;
            }, 1000);
        } else {
            banner.textContent = result?.error || 'ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
            banner.style.display = 'block';
            loginBtn.textContent = 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
            loginBtn.disabled = false;
        }
    }, 500);
}

const params = new URLSearchParams(window.location.search);
if (params.get('msg') === 'login_required') {
    document.getElementById('msgBanner').textContent = 'ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹';
    document.getElementById('msgBanner').style.display = 'block';
}

document.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') doLogin();
});
</script>

<!-- ========================================= -->
<!-- ÙƒÙˆØ¯ Firebase - ÙŠØ¶Ø§Ù ÙÙŠ Ù†Ù‡Ø§ÙŠØ© ÙƒÙ„ ØµÙØ­Ø© -->
<!-- ========================================= -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { 
  getFirestore,
  collection,
  addDoc,
  onSnapshot,
  doc,
  updateDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCtHnYZT8yq9tp7xaA7AyJQV4Ag4Wi1Yks",
  authDomain: "gift-star-abf48.firebaseapp.com",
  projectId: "gift-star-abf48",
  storageBucket: "gift-star-abf48.firebasestorage.app",
  messagingSenderId: "546782076914",
  appId: "1:546782076914:web:3fb957a03c7e0501fc556b"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.db = db;
window.fb = {
  collection,
  addDoc,
  onSnapshot,
  doc,
  updateDoc,
  serverTimestamp
};

console.log('âœ… Firebase loaded in login.html');
</script>

<!-- Firebase Messaging -->
<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/firebase-messaging-sw.js')
        .then((registration) => {
            console.log('âœ… Service Worker registered:', registration);
        })
        .catch((error) => {
            console.error('âŒ Service Worker registration failed:', error);
        });
}
</script>
</body>
</html>
