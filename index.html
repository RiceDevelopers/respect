<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gift Star - متجر الهدايا الكويتي</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/style.css">
</head>
<body>

<!-- Header -->
<header class="site-header">
  <div class="header-top">
    <div class="container">
      <span class="header-tagline">توصيل داخل الكويت فقط</span>
      <div class="header-links">
        <a href="cart.html" class="cart-link">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="9" cy="21" r="1"/>
            <circle cx="20" cy="21" r="1"/>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
          </svg>
          <span class="cart-count" id="cartCount">0</span>
        </a>
        <a href="login.html" class="btn-login" id="loginBtn">تسجيل الدخول</a>
        <a href="#" class="btn-login" id="logoutBtn" style="display:none" onclick="logout()">خروج</a>
      </div>
    </div>
  </div>
  <div class="header-main">
    <div class="container header-flex">
      <a href="index.html" class="logo">
        <div class="logo-star">★</div>
        <div class="logo-text">
          <span class="logo-gift">Gift</span>
          <span class="logo-star-word">Star</span>
        </div>
      </a>
      <nav class="main-nav">
        <a href="index.html" class="active">الرئيسية</a>
        <a href="shop.html">المتجر</a>
      </nav>
    </div>
  </div>
</header>

<!-- Promotions Banner -->
<section class="promo-section" id="promoSection">
  <div class="container">
    <h2 class="section-title">العروض والتخفيضات</h2>
    <div class="promo-grid" id="promoGrid">
      <!-- Loaded from JS -->
    </div>
  </div>
</section>

<!-- Categories -->
<section class="categories-section">
  <div class="container">
    <h2 class="section-title">تسوق حسب الفئة</h2>
    <div class="categories-grid">
      <a href="shop.html?cat=cakes" class="category-card">
        <div class="cat-img-wrap">
          <img src="https://images.unsplash.com/photo-1578985545062-69928b1d9587?w=300&h=300&fit=crop" alt="كيك">
        </div>
        <span>كيك</span>
      </a>
      <a href="shop.html?cat=flowers" class="category-card">
        <div class="cat-img-wrap">
          <img src="https://images.unsplash.com/photo-1490750967868-88df5691cc95?w=300&h=300&fit=crop" alt="ورد">
        </div>
        <span>ورد</span>
      </a>
      <a href="shop.html?cat=gifts" class="category-card">
        <div class="cat-img-wrap">
          <img src="https://images.unsplash.com/photo-1513885535751-8b9238bd345a?w=300&h=300&fit=crop" alt="هدايا">
        </div>
        <span>هدايا</span>
      </a>
    </div>
  </div>
</section>

<!-- Featured Products -->
<section class="featured-section">
  <div class="container">
    <h2 class="section-title">المنتجات المميزة</h2>
    <div class="products-grid" id="featuredProducts">
      <!-- Loaded from JS -->
    </div>
    <div class="text-center" style="margin-top:2rem; text-align:center">
      <a href="shop.html" class="btn-outline">عرض جميع المنتجات</a>
    </div>
  </div>
</section>

<!-- Why Us -->
<section class="why-section">
  <div class="container">
    <h2 class="section-title">لماذا Gift Star؟</h2>
    <div class="why-grid">
      <div class="why-card">
        <div class="why-icon">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
          </svg>
        </div>
        <h3>جودة مضمونة</h3>
        <p>جميع منتجاتنا طازجة ومختارة بعناية فائقة</p>
      </div>
      <div class="why-card">
        <div class="why-icon">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12 6 12 12 16 14"/>
          </svg>
        </div>
        <h3>توصيل سريع</h3>
        <p>نوصل في نفس اليوم لجميع مناطق الكويت</p>
      </div>
      <div class="why-card">
        <div class="why-icon">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
          </svg>
        </div>
        <h3>خدمة شخصية</h3>
        <p>نساعدك في اختيار الهدية المثالية لأحبائك</p>
      </div>
      <div class="why-card">
        <div class="why-icon">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
            <line x1="1" y1="10" x2="23" y2="10"/>
          </svg>
        </div>
        <h3>دفع آمن</h3>
        <p>طرق دفع متعددة وآمنة 100%</p>
      </div>
    </div>
  </div>
</section>

<!-- Footer -->
<footer class="site-footer">
  <div class="container">
    <div class="footer-grid">
      <div class="footer-brand">
        <div class="logo" style="margin-bottom:1rem">
          <div class="logo-star">★</div>
          <div class="logo-text">
            <span class="logo-gift">Gift</span>
            <span class="logo-star-word">Star</span>
          </div>
        </div>
        <p>متجر الهدايا الكويتي الأول لكل مناسباتك المميزة</p>
      </div>
      <div class="footer-links-col">
        <h4>المتجر</h4>
        <a href="shop.html?cat=cakes">كيك</a>
        <a href="shop.html?cat=flowers">ورد</a>
      </div>
      <div class="footer-links-col">
        <h4>الحساب</h4>
        <a href="login.html">تسجيل الدخول</a>
        <a href="register.html">إنشاء حساب</a>
        <a href="cart.html">سلة المشتريات</a>
      </div>
      <div class="footer-links-col">
        <h4>تواصل معنا</h4>
        <span>الكويت - جميع المحافظات</span>
        <span>support@giftstar.com.kw</span>
        <span>+965 XXXX XXXX</span>
      </div>
    </div>
    <div class="footer-bottom">
      <p>© 2024 Gift Star. جميع الحقوق محفوظة - الكويت</p>
    </div>
  </div>
</footer>

<div class="stars-bg"></div>

<!-- Firebase SDK -->
<script type="importmap">
  {
    "imports": {
      "firebase/app": "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js",
      "firebase/firestore": "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js",
      "firebase/auth": "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js",
      "firebase/analytics": "https://www.gstatic.com/firebasejs/12.9.0/firebase-analytics.js"
    }
  }
</script>

<script type="module" src="js/data.js"></script>
<script type="module">
import { getCurrentUser, getProducts, getPromos, addToCart, logout as firebaseLogout, updateHeader } from './js/data.js';

// تهيئة الصفحة
window.addEventListener('DOMContentLoaded', async () => {
  // تحديث الهيدر
  updateHeader();
  
  // عرض العروض
  renderPromos();
  
  // عرض المنتجات المميزة
  renderFeaturedProducts();
});

// عرض العروض
async function renderPromos() {
  const container = document.getElementById('promoGrid');
  if (!container) return;

  const promos = getPromos();
  
  if (!promos.length) {
    document.querySelector('.promo-section').style.display = 'none';
    return;
  }

  container.innerHTML = promos.map(p => `
    <div class="promo-card">
      <img src="${p.image}" alt="${p.title}" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1549465220-1a8b9238cd48?w=600&h=300&fit=crop'">
      <div class="promo-overlay">
        <span class="promo-badge">${p.badge || 'عرض'}</span>
        <h3>${p.title}</h3>
        <p>${p.description}</p>
      </div>
    </div>
  `).join('');
}

// عرض المنتجات المميزة
async function renderFeaturedProducts() {
  const container = document.getElementById('featuredProducts');
  if (!container) return;

  const products = getProducts({ featured: true, active: true }).slice(0, 8);
  
  if (!products.length) {
    container.innerHTML = '<div class="loading" style="grid-column:1/-1">لا توجد منتجات</div>';
    return;
  }

  container.innerHTML = products.map(p => productCardHTML(p)).join('');
}

// قالب بطاقة المنتج
function productCardHTML(p) {
  return `
    <div class="product-card" onclick="window.location.href='product.html?id=${p.id}'" style="cursor:pointer">
      ${p.badge ? `<span class="product-badge">${p.badge}</span>` : ''}
      <img src="${p.image}" alt="${p.name}" class="product-img" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1549465220-1a8b9238cd48?w=400&h=300&fit=crop'">
      <div class="product-info">
        <h3 class="product-name">${p.name}</h3>
        <p class="product-desc">${p.description.substring(0, 60)}...</p>
        <div class="product-footer">
          <div class="product-price">${formatPrice(p.price)}</div>
          <button class="btn-add-cart" onclick="event.stopPropagation();window.handleAddToCart(${p.id}, this)">أضف للسلة</button>
        </div>
      </div>
    </div>
  `;
}

// تنسيق السعر
function formatPrice(price) {
  return price.toFixed(3) + ' د.ك';
}

// إضافة للسلة
window.handleAddToCart = async (productId, btn) => {
  const user = getCurrentUser();
  
  if (!user) {
    sessionStorage.setItem('giftstar_redirect_after_login', window.location.href);
    window.location.href = 'login.html?msg=login_required';
    return;
  }
  
  const result = addToCart(productId);
  
  btn.textContent = '✓ تمت الإضافة';
  btn.style.background = 'var(--success)';
  
  setTimeout(() => {
    btn.textContent = 'أضف للسلة';
    btn.style.background = '';
  }, 1500);
  
  showNotification('تمت إضافة المنتج للسلة', 'success');
}

// إشعارات
function showNotification(msg, type) {
  const el = document.createElement('div');
  el.className = 'notification ' + (type || 'success');
  el.textContent = msg;
  el.style.cssText = `
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: ${type === 'success' ? '#5ec98a' : '#e05555'};
    color: white;
    padding: 12px 30px;
    border-radius: 50px;
    font-size: 14px;
    font-weight: 600;
    z-index: 10000;
    box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    animation: slideDown 0.3s ease;
  `;
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 3000);
}

// تسجيل الخروج
window.logout = () => {
  firebaseLogout();
};
</script>
</body>
</html>
