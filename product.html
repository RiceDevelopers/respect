<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>المنتج - Gift Star</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/style.css">
<style>
.breadcrumb {
    background: var(--secondary-light);
    padding: 15px 0;
    border-bottom: 1px solid var(--border);
    font-size: 14px;
}
.breadcrumb .container {
    display: flex;
    align-items: center;
    gap: 10px;
    color: var(--text-muted);
}
.breadcrumb a {
    color: var(--primary);
    font-weight: 600;
}
.product-detail {
    padding: 50px 0;
}
.product-detail-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 60px;
    align-items: start;
    background: var(--secondary-light);
    border-radius: var(--radius-lg);
    padding: 40px;
    border: 1px solid var(--border);
}
.product-detail-img {
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    position: relative;
}
.product-detail-img img {
    width: 100%;
    height: 450px;
    object-fit: cover;
    transition: transform 0.5s;
}
.product-detail-img:hover img {
    transform: scale(1.05);
}
.product-detail-info h1 {
    font-size: 36px;
    font-weight: 900;
    color: var(--text);
    margin-bottom: 15px;
    font-family: 'Playfair Display', serif;
}
.product-detail-price {
    font-size: 42px;
    font-weight: 900;
    color: var(--primary);
    margin: 20px 0;
    display: flex;
    align-items: baseline;
    gap: 5px;
}
.product-detail-price small {
    font-size: 18px;
    color: var(--text-muted);
    font-weight: 500;
}
.product-detail-desc {
    font-size: 16px;
    color: var(--text-muted);
    line-height: 1.8;
    margin-bottom: 30px;
    padding: 20px 0;
    border-top: 1px solid var(--border);
    border-bottom: 1px solid var(--border);
}
.qty-control {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 30px;
    background: var(--secondary);
    padding: 10px 20px;
    border-radius: 50px;
    width: fit-content;
}
.qty-btn {
    width: 40px;
    height: 40px;
    border: 2px solid var(--border);
    background: var(--secondary-light);
    border-radius: 50%;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
    cursor: pointer;
    font-weight: 700;
    color: var(--text);
}
.qty-btn:hover {
    border-color: var(--primary);
    background: var(--primary);
    color: var(--secondary);
    transform: scale(1.1);
}
.qty-display {
    font-size: 22px;
    font-weight: 800;
    min-width: 50px;
    text-align: center;
    color: var(--text);
}
</style>
</head>
<body>
<header class="site-header">
    <div class="header-top">
        <div class="container">
            <span class="header-tagline">توصيل داخل الكويت فقط</span>
            <div class="header-links">
                <a href="cart.html" class="cart-link">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                    </svg>
                    <span class="cart-count" id="cartCount">0</span>
                </a>
                <a href="login.html" class="btn-login" id="loginBtn">تسجيل الدخول</a>
                <a href="#" class="btn-login" id="logoutBtn" style="display:none" onclick="logout()">خروج</a>
            </div>
        </div>
    </div>
    <div class="header-main">
        <div class="container header-flex">
            <a href="index.html" class="logo">
                <div class="logo-star">★</div>
                <div class="logo-text">
                    <span class="logo-gift">Gift</span>
                    <span class="logo-star-word">Star</span>
                </div>
            </a>
            <nav class="main-nav">
                <a href="index.html">الرئيسية</a>
                <a href="shop.html">المتجر</a>
            </nav>
        </div>
    </div>
</header>

<div class="breadcrumb">
    <div class="container">
        <a href="index.html">الرئيسية</a> / <a href="shop.html">المتجر</a> / <span id="breadcrumbName">المنتج</span>
    </div>
</div>

<div class="container product-detail" id="productContent">
    <div class="loading"><div class="spinner"></div>جاري التحميل...</div>
</div>

<footer class="site-footer">
    <div class="footer-bottom"><p>© 2024 Gift Star. جميع الحقوق محفوظة - الكويت</p></div>
</footer>
<div class="stars-bg"></div>

<script src="js/data.js"></script>
<script src="js/main.js"></script>
<script>
let qty = 1;
let currentProduct = null;

document.addEventListener('DOMContentLoaded', () => {
    if (window.updateHeader) window.updateHeader();

    const id = parseInt(new URLSearchParams(window.location.search).get('id'));
    const product = window.getProductById ? window.getProductById(id) : null;

    if (!product) {
        document.getElementById('productContent').innerHTML = '<div class="loading">المنتج غير موجود</div>';
        return;
    }

    currentProduct = product;
    document.title = product.name + ' - Gift Star';
    document.getElementById('breadcrumbName').textContent = product.name;

    document.getElementById('productContent').innerHTML = `
        <div class="product-detail-grid">
            <div class="product-detail-img">
                <img src="${product.image}" alt="${product.name}" onerror="this.src='https://images.unsplash.com/photo-1549465220-1a8b9238cd48?w=600&h=500&fit=crop'">
            </div>
            <div class="product-detail-info">
                ${product.badge ? `<span class="product-badge" style="position:static;margin-bottom:12px;display:inline-block">${product.badge}</span>` : ''}
                <h1>${product.name}</h1>
                <div class="product-detail-price">${window.formatKWD ? window.formatKWD(product.price) : product.price.toFixed(3) + ' <small>د.ك</small>'}</div>
                <p class="product-detail-desc">${product.description}</p>
                <div class="qty-control">
                    <button class="qty-btn" onclick="changeQty(-1)">-</button>
                    <span class="qty-display" id="qtyDisplay">1</span>
                    <button class="qty-btn" onclick="changeQty(1)">+</button>
                    <span style="color:var(--text-muted);font-size:14px">المتاح: ${product.stock || 10} قطعة</span>
                </div>
                <button class="btn-primary" style="width:100%;padding:15px;font-size:16px;border-radius:30px" onclick="addToCartAndRedirect(${product.id})">
                    أضف إلى السلة
                </button>
                <div style="display:flex;gap:12px;margin-top:24px;padding-top:20px;border-top:1px solid var(--border)">
                    <div style="font-size:13px;color:var(--text-muted);display:flex;align-items:center;gap:6px">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--success)" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>
                        توصيل داخل الكويت
                    </div>
                    <div style="font-size:13px;color:var(--text-muted);display:flex;align-items:center;gap:6px">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--success)" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>
                        جودة مضمونة
                    </div>
                </div>
            </div>
        </div>
    `;
});

function changeQty(dir) {
    qty = Math.max(1, qty + dir);
    document.getElementById('qtyDisplay').textContent = qty;
}

function addToCartAndRedirect(productId) {
    const user = window.getCurrentUser ? window.getCurrentUser() : null;
    if (!user) {
        sessionStorage.setItem('giftstar_redirect_after_login', window.location.href);
        window.location.href = 'login.html?msg=login_required';
        return;
    }

    if (window.addToCart) {
        for (let i = 0; i < qty; i++) {
            window.addToCart(productId);
        }
    }

    if (window.showNotification) {
        window.showNotification('تمت إضافة المنتج للسلة', 'success');
    }
    setTimeout(() => window.location.href = 'cart.html', 1000);
}

window.logout = () => { if (window.logout) window.logout(); }
</script>

<!-- كود Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyCtHnYZT8yq9tp7xaA7AyJQV4Ag4Wi1Yks",
    authDomain: "gift-star-abf48.firebaseapp.com",
    projectId: "gift-star-abf48",
    storageBucket: "gift-star-abf48.firebasestorage.app",
    messagingSenderId: "546782076914",
    appId: "1:546782076914:web:3fb957a03c7e0501fc556b"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.db = db;
console.log('✅ Firebase loaded');
</script>

<!-- Firebase Messaging -->
<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/firebase-messaging-sw.js').catch(console.error);
}
</script>
</body>
</html>
