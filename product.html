<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>المنتج - Gift Star</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/style.css">
</head>
<body>
<header class="site-header">
  <div class="header-top">
    <div class="container">
      <span class="header-tagline">توصيل داخل الكويت فقط</span>
      <div class="header-links">
        <a href="cart.html" class="cart-link">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
          <span class="cart-count" id="cartCount">0</span>
        </a>
        <a href="login.html" class="btn-login" id="loginBtn">تسجيل الدخول</a>
        <a href="#" class="btn-login" id="logoutBtn" style="display:none" onclick="logout()">خروج</a>
      </div>
    </div>
  </div>
  <div class="header-main">
    <div class="container header-flex">
      <a href="index.html" class="logo">
        <div class="logo-star">★</div>
        <div class="logo-text">
          <span class="logo-gift">Gift</span>
          <span class="logo-star-word">Star</span>
        </div>
      </a>
      <nav class="main-nav">
        <a href="index.html">الرئيسية</a>
        <a href="shop.html">المتجر</a>
      </nav>
    </div>
  </div>
</header>

<div class="breadcrumb">
  <div class="container">
    <a href="index.html">الرئيسية</a> / <a href="shop.html">المتجر</a> / <span id="breadcrumbName">المنتج</span>
  </div>
</div>

<div class="container product-detail" id="productContent">
  <div class="loading"><div class="spinner"></div>جاري التحميل...</div>
</div>

<footer class="site-footer">
  <div class="footer-bottom" style="padding:20px 0">
    <p>© 2024 Gift Star. جميع الحقوق محفوظة - الكويت</p>
  </div>
</footer>

<script src="js/data.js"></script>
<script src="js/main.js"></script>
<script>
let qty = 1;

function init() {
  updateHeader();
  const id = parseInt(new URLSearchParams(window.location.search).get('id'));
  const products = getData('products', []);
  const p = products.find(pr => pr.id === id);

  if (!p) {
    document.getElementById('productContent').innerHTML = '<div class="loading">المنتج غير موجود</div>';
    return;
  }

  document.title = p.name + ' - Gift Star';
  document.getElementById('breadcrumbName').textContent = p.name;

  document.getElementById('productContent').innerHTML = `
    <div class="product-detail-grid">
      <div class="product-detail-img">
        <img src="${p.image}" alt="${p.name}" onerror="this.src='https://images.unsplash.com/photo-1549465220-1a8b9238cd48?w=600&h=500&fit=crop'">
      </div>
      <div class="product-detail-info">
        ${p.badge ? `<span class="product-badge" style="position:static;margin-bottom:12px;display:inline-block">${p.badge}</span>` : ''}
        <h1>${p.name}</h1>
        <div class="product-detail-price">${p.price.toFixed(3)} <small>د.ك</small></div>
        <p class="product-detail-desc">${p.description}</p>
        <div class="qty-control">
          <button class="qty-btn" onclick="changeQty(-1)">-</button>
          <span class="qty-display" id="qtyDisplay">1</span>
          <button class="qty-btn" onclick="changeQty(1)">+</button>
          <span style="color:var(--text-muted);font-size:14px">المتاح: ${p.stock} قطعة</span>
        </div>
        <button class="btn-primary" style="width:100%;padding:15px;font-size:16px;border-radius:30px" onclick="addToCartAndRedirect(${p.id})">
          أضف إلى السلة
        </button>
        <div style="display:flex;gap:12px;margin-top:24px;padding-top:20px;border-top:1px solid var(--border)">
          <div style="font-size:13px;color:var(--text-muted);display:flex;align-items:center;gap:6px">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--success)" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>
            توصيل داخل الكويت
          </div>
          <div style="font-size:13px;color:var(--text-muted);display:flex;align-items:center;gap:6px">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--success)" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>
            جودة مضمونة
          </div>
        </div>
      </div>
    </div>
  `;
}

function changeQty(dir) {
  qty = Math.max(1, qty + dir);
  document.getElementById('qtyDisplay').textContent = qty;
}

function addToCartAndRedirect(productId) {
  const user = getCurrentUser();
  if (!user) {
    sessionStorage.setItem('giftstar_redirect_after_login', window.location.href);
    window.location.href = 'login.html?msg=login_required';
    return;
  }
  addToCart(productId, qty);
  showNotification('تمت الإضافة للسلة', 'success');
  setTimeout(() => window.location.href = 'cart.html', 1000);
}

init();
</script>
</body>
</html>
