<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gift Star - Ù…ØªØ¬Ø± Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ Ø§Ù„ÙƒÙˆÙŠØªÙŠ</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{--gold:#c8a96e;--gold-light:#e2c98a;--gold-dark:#a68840;--bg:#0f0f1a;--bg2:#161625;--bg3:#1e1e32;--border:rgba(200,169,110,0.15);--border2:rgba(200,169,110,0.3);--text:#e8e0d0;--muted:#8a7f6e;--success:#5ec98a;--danger:#e05555}
html,body{background:var(--bg);font-family:'Tajawal',sans-serif;color:var(--text);direction:rtl}
img{max-width:100%}
input,select,textarea,button{font-family:'Tajawal',sans-serif}
.btn-gold{background:linear-gradient(135deg,var(--gold),var(--gold-light));color:#0f0f1a;border:none;padding:12px 28px;border-radius:30px;font-size:15px;font-weight:800;cursor:pointer;transition:all .2s}
.btn-gold:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(200,169,110,.4)}
.btn-gold:disabled{opacity:.6;cursor:not-allowed;transform:none}
.btn-outline{background:transparent;color:var(--gold);border:2px solid var(--gold);padding:10px 24px;border-radius:30px;font-size:14px;font-weight:700;cursor:pointer;transition:all .2s}
.btn-outline:hover{background:var(--gold);color:#0f0f1a}
.container{max-width:1200px;margin:0 auto;padding:0 20px}
.input-field{width:100%;padding:13px 16px;background:var(--bg3);border:1.5px solid var(--border);border-radius:10px;color:var(--text);font-size:15px;transition:border .2s;outline:none}
.input-field:focus{border-color:var(--gold)}
.card{background:var(--bg2);border:1px solid var(--border);border-radius:16px;transition:all .2s}
.card:hover{border-color:var(--border2);box-shadow:0 8px 30px rgba(0,0,0,.3)}
.badge{display:inline-block;padding:4px 12px;border-radius:20px;font-size:12px;font-weight:700;background:linear-gradient(135deg,var(--gold),var(--gold-light));color:#0f0f1a}
.page-title{font-size:clamp(28px,5vw,48px);font-weight:900;background:linear-gradient(135deg,var(--gold),var(--gold-light));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
@keyframes fadeIn{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:none}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
@keyframes slideUp{from{transform:translateY(40px);opacity:0}to{transform:none;opacity:1}}
@keyframes spin{to{transform:rotate(360deg)}}
.animate-in{animation:fadeIn .4s ease forwards}
.grid-products{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:24px}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:20px}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}
.grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:20px}
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);padding:14px 28px;border-radius:30px;font-weight:700;font-size:15px;z-index:9999;animation:slideUp .3s ease;box-shadow:0 8px 30px rgba(0,0,0,.4);white-space:nowrap;pointer-events:none}
.admin-sidebar-btn{display:block;width:100%;padding:10px 14px;margin-bottom:6px;text-align:right;background:transparent;border:1px solid transparent;border-radius:10px;color:var(--muted);cursor:pointer;font-size:14px;font-weight:400;transition:all .15s;position:relative}
.admin-sidebar-btn.active{background:rgba(200,169,110,.15);border-color:var(--border2);color:var(--gold);font-weight:800}
.setup-overlay{position:fixed;inset:0;background:rgba(0,0,0,.85);display:flex;align-items:center;justify-content:center;z-index:1000;padding:20px;overflow-y:auto}
@media(max-width:768px){
  .grid-2,.grid-3,.grid-4{grid-template-columns:1fr!important}
  .grid-products{grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:14px}
  .admin-layout{grid-template-columns:1fr!important}
  .admin-sidebar{display:flex;overflow-x:auto;gap:6px}
  .admin-sidebar-btn{white-space:nowrap;width:auto}
  .product-detail-grid{grid-template-columns:1fr!important}
  .checkout-grid{grid-template-columns:1fr!important}
  .cart-grid{grid-template-columns:1fr!important}
  .notif-dropdown{width:290px!important}
}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useRef, useCallback } = React;

// â”€â”€ Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let SUPABASE_URL = localStorage.getItem('gs_sb_url') || '';
let SUPABASE_KEY = localStorage.getItem('gs_sb_key') || '';
let sb = null;
if (SUPABASE_URL && SUPABASE_KEY) sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const session = {
  get: () => { try { return JSON.parse(sessionStorage.getItem('gs:u')); } catch { return null; } },
  set: u => { try { sessionStorage.setItem('gs:u', JSON.stringify(u)); } catch {} },
  clear: () => { try { sessionStorage.removeItem('gs:u'); } catch {} }
};
const kwd = n => Number(n||0).toFixed(3) + ' Ø¯.Ùƒ';
const genId = () => 'GS-' + Date.now().toString(36).toUpperCase().slice(-6);
const STATUS_MAP = { new:'Ø¬Ø¯ÙŠØ¯', processing:'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', delivered:'ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„', cancelled:'Ù…Ù„ØºÙŠ' };
const STATUS_COLOR = { new:'#5ec98a', processing:'#f39c12', delivered:'#3498db', cancelled:'#e05555' };
const AREAS = ['Ø§Ù„Ø¹Ø§ØµÙ…Ø©','Ø­ÙˆÙ„ÙŠ','Ø§Ù„ÙØ±ÙˆØ§Ù†ÙŠØ©','Ù…Ø¨Ø§Ø±Ùƒ Ø§Ù„ÙƒØ¨ÙŠØ±','Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠ','Ø§Ù„Ø¬Ù‡Ø±Ø§Ø¡'];
const ANN_COLORS = {
  gold: { bg:'linear-gradient(90deg,#a68840,#c8a96e)', color:'#0f0f1a' },
  red:  { bg:'linear-gradient(90deg,#c0392b,#e74c3c)', color:'#fff' },
  green:{ bg:'linear-gradient(90deg,#27ae60,#2ecc71)', color:'#fff' },
  blue: { bg:'linear-gradient(90deg,#2980b9,#3498db)', color:'#fff' },
  dark: { bg:'linear-gradient(90deg,#1a1a2e,#2d2d4e)', color:'var(--gold)' },
};
const INIT_PRODUCTS = [
  {id:1,name:'ÙƒÙŠÙƒ Ø§Ù„ÙØ±Ø§ÙˆÙ„Ø© Ø§Ù„ÙØ§Ø®Ø±',cat:'cakes',price:12.5,img:'https://images.unsplash.com/photo-1565958011703-44f9829ba187?w=400&h=400&fit=crop',desc:'ÙƒÙŠÙƒ ÙØ±Ø§ÙˆÙ„Ø© Ø·Ø§Ø²Ø¬Ø© Ø¨ÙƒØ±ÙŠÙ…Ø© Ø§Ù„Ø´Ø§Ù†ØªÙŠÙ‡ Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©',badge:'Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹',stock:20,featured:true},
  {id:2,name:'Ø¨Ø§Ù‚Ø© ÙˆØ±Ø¯ Ø­Ù…Ø±Ø§Ø¡',cat:'flowers',price:8.75,img:'https://images.unsplash.com/photo-1518621736915-f3b1c41bfd00?w=400&h=400&fit=crop',desc:'24 ÙˆØ±Ø¯Ø© Ø­Ù…Ø±Ø§Ø¡ Ø·Ø§Ø²Ø¬Ø© Ù…Ø¹ ÙˆØ±Ù‚ Ø§Ù„Ø²ÙŠÙ†Ø©',badge:'Ø¬Ø¯ÙŠØ¯',stock:30,featured:true},
  {id:3,name:'ØªÙˆØ±ØªØ© Ø§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©',cat:'cakes',price:15.0,img:'https://images.unsplash.com/photo-1578985545062-69928b1d9587?w=400&h=400&fit=crop',desc:'ØªÙˆØ±ØªØ© Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© Ø¨Ù„Ø¬ÙŠÙƒÙŠØ© ÙØ§Ø®Ø±Ø© Ø¨Ø·Ø¨Ù‚Ø§Øª Ø§Ù„ÙƒØ±ÙŠÙ…Ø©',badge:'',stock:15,featured:true},
  {id:4,name:'Ø¨Ø§Ù‚Ø© Ø²Ù‡ÙˆØ± Ø§Ù„Ø±Ø¨ÙŠØ¹',cat:'flowers',price:11.0,img:'https://images.unsplash.com/photo-1490750967868-88df5691cc95?w=400&h=400&fit=crop',desc:'ØªØ´ÙƒÙŠÙ„Ø© Ù…Ù† Ø£Ø¬Ù…Ù„ Ø²Ù‡ÙˆØ± Ø§Ù„Ø±Ø¨ÙŠØ¹ Ø§Ù„Ù…Ù„ÙˆÙ†Ø©',badge:'',stock:25,featured:false},
  {id:5,name:'Ø¹Ù„Ø¨Ø© Ù‡Ø¯Ø§ÙŠØ§ ÙØ§Ø®Ø±Ø©',cat:'gifts',price:22.0,img:'https://images.unsplash.com/photo-1513885535751-8b9238bd345a?w=400&h=400&fit=crop',desc:'Ø¹Ù„Ø¨Ø© Ù‡Ø¯Ø§ÙŠØ§ Ù…Ù…ÙŠØ²Ø© Ø¨ØªØ´ÙƒÙŠÙ„Ø© Ù…Ù† Ø§Ù„Ø­Ù„ÙˆÙŠØ§Øª',badge:'Ù…Ù…ÙŠØ²',stock:10,featured:true},
  {id:6,name:'Ø¨Ø§Ù„ÙˆÙ† ØªØ²ÙŠÙŠÙ†',cat:'gifts',price:5.5,img:'https://images.unsplash.com/photo-1530103862676-de8c9debad1d?w=400&h=400&fit=crop',desc:'Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ø§Ù„ÙˆÙ†Ø§Øª Ù…Ù„ÙˆÙ†Ø© Ù„Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„Ø³Ø¹ÙŠØ¯Ø©',badge:'',stock:50,featured:false},
  {id:7,name:'ÙƒÙŠÙƒ Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯',cat:'cakes',price:18.0,img:'https://images.unsplash.com/photo-1558636508-e0db3814bd1d?w=400&h=400&fit=crop',desc:'ÙƒÙŠÙƒ Ø§Ø­ØªÙØ§Ù„ÙŠ Ù…Ø¹ Ø´Ù…Ø¹Ø§Øª ÙˆØ²ÙŠÙ†Ø© Ù…Ù…ÙŠØ²Ø©',badge:'Ø¹Ø±Ø¶',stock:12,featured:true},
  {id:8,name:'ÙˆØ±Ø¯ Ø£Ø¨ÙŠØ¶ ÙØ§Ø®Ø±',cat:'flowers',price:14.5,img:'https://images.unsplash.com/photo-1487530811015-780aa15174b8?w=400&h=400&fit=crop',desc:'30 ÙˆØ±Ø¯Ø© Ø¨ÙŠØ¶Ø§Ø¡ Ø·Ø§Ø²Ø¬Ø© ÙÙŠ ØªØºÙ„ÙŠÙ ÙØ§Ø®Ø±',badge:'',stock:20,featured:false},
];
const INIT_USERS = [
  {id:'admin-1',name:'Ù…Ø¯ÙŠØ± Ø§Ù„Ù…ØªØ¬Ø±',email:'admin@giftstar.kw',password:'Admin@2024',role:'admin',phone:'51234567'},
  {id:'user-1',name:'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯',email:'ahmed@test.com',password:'12345678',role:'customer',phone:'51234568'},
];
const INIT_ANN = [{id:1,text:'âœ¨ ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù„Ø·Ù„Ø¨Ø§Øª ÙÙˆÙ‚ 15 Ø¯.Ùƒ Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙˆÙŠØª',active:true,color:'gold'}];

// â”€â”€ DB layer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const db = {
  getSetting: async k => { const {data} = await sb.from('gs_settings').select('value').eq('key',k).maybeSingle(); return data ? JSON.parse(data.value) : null; },
  setSetting: async (k,v) => { await sb.from('gs_settings').upsert({key:k,value:JSON.stringify(v)},{onConflict:'key'}); },
  getOrders: async () => { const {data} = await sb.from('gs_orders').select('*').order('created_at',{ascending:false}); return data||[]; },
  insertOrder: async o => { const {data} = await sb.from('gs_orders').insert([o]).select().single(); return data; },
  updateStatus: async (id,s) => { await sb.from('gs_orders').update({status:s}).eq('id',id); },
  getNotifs: async () => { const {data} = await sb.from('gs_notifications').select('*').order('created_at',{ascending:false}); return data||[]; },
  insertNotif: async n => { await sb.from('gs_notifications').insert([n]); },
  markRead: async () => { await sb.from('gs_notifications').update({read:true}).eq('read',false); },
  getUnread: async () => { const {count} = await sb.from('gs_notifications').select('*',{count:'exact',head:true}).eq('read',false); return count||0; },
};

// â”€â”€ SQL shown in setup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SQL = `create table if not exists gs_settings (
  key text primary key,
  value text not null
);
create table if not exists gs_orders (
  id text primary key,
  customer_name text, customer_email text, customer_phone text,
  user_id text, area text, address text, notes text, payment text,
  items jsonb, subtotal numeric, delivery numeric, total numeric,
  status text default 'new', order_date text, order_time text,
  created_at timestamptz default now()
);
create table if not exists gs_notifications (
  id bigserial primary key,
  text text, order_id text, read boolean default false,
  created_at timestamptz default now()
);
alter table gs_orders enable row level security;
alter table gs_notifications enable row level security;
alter table gs_settings enable row level security;
create policy "open" on gs_orders for all using (true) with check (true);
create policy "open" on gs_notifications for all using (true) with check (true);
create policy "open" on gs_settings for all using (true) with check (true);`;

// â”€â”€ Setup Screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function SetupScreen({onDone}) {
  const [url,setUrl]=useState('');
  const [key,setKey]=useState('');
  const [loading,setLoading]=useState(false);
  const [err,setErr]=useState('');

  const connect = async () => {
    if(!url.trim()||!key.trim()){setErr('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ§Ù„Ù…ÙØªØ§Ø­');return;}
    setLoading(true);setErr('');
    try {
      const client = window.supabase.createClient(url.trim(),key.trim());
      const {error} = await client.from('gs_settings').select('key').limit(1);
      if(error) throw error;
      localStorage.setItem('gs_sb_url',url.trim());
      localStorage.setItem('gs_sb_key',key.trim());
      SUPABASE_URL=url.trim(); SUPABASE_KEY=key.trim();
      sb = client;
      onDone();
    } catch(e) {
      setErr('ÙØ´Ù„: '+(e.message||'ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªØ´ØºÙŠÙ„ ÙƒÙˆØ¯ SQL'));
    }
    setLoading(false);
  };

  return (
    <div className="setup-overlay">
      <div className="card" style={{padding:32,width:'100%',maxWidth:540,margin:'auto'}}>
        <div style={{textAlign:'center',marginBottom:22}}>
          <div style={{fontSize:46}}>ğŸ”—</div>
          <h2 style={{color:'var(--gold)',fontWeight:900,fontSize:20,marginTop:8}}>Ø±Ø¨Ø· Supabase (Ù…Ø¬Ø§Ù†ÙŠ)</h2>
          <p style={{color:'var(--muted)',fontSize:13,marginTop:4}}>Ù„ØªØ´ØºÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ø´ØªØ±ÙƒØ© Ø¨ÙŠÙ† ÙƒÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>
        </div>

        <div style={{background:'var(--bg3)',borderRadius:10,padding:16,marginBottom:18,fontSize:13,lineHeight:2.1}}>
          <div style={{fontWeight:800,color:'var(--gold)',marginBottom:4}}>ğŸ“‹ Ø®Ø·ÙˆØ§Øª Ø³Ø±ÙŠØ¹Ø© (Ø¯Ù‚ÙŠÙ‚ØªÙŠÙ† ÙÙ‚Ø·):</div>
          <div>1ï¸âƒ£ <a href="https://supabase.com" target="_blank" style={{color:'var(--gold)'}}>supabase.com</a> â† New project â† Ø§Ø®ØªØ± Ø§Ø³Ù… ÙˆÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±</div>
          <div>2ï¸âƒ£ SQL Editor â† New Query â† Ø§Ù„ØµÙ‚ Ø§Ù„ÙƒÙˆØ¯ Ø£Ø¯Ù†Ø§Ù‡ â† Run â–¶</div>
          <div>3ï¸âƒ£ Settings â† API â† Ø§Ù†Ø³Ø® URL Ùˆ anon public key</div>
          <div>4ï¸âƒ£ Ø§Ù„ØµÙ‚Ù‡Ù…Ø§ Ù‡Ù†Ø§ ÙˆØ§Ø¶ØºØ· Ø§ØªØµØ§Ù„ âœ…</div>
        </div>

        <div style={{marginBottom:16,position:'relative'}}>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:5}}>
            <label style={{fontWeight:700,color:'var(--muted)',fontSize:12}}>ÙƒÙˆØ¯ SQL</label>
            <button onClick={()=>{navigator.clipboard.writeText(SQL);alert('ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ…');}} style={{padding:'3px 10px',background:'var(--gold)',border:'none',borderRadius:6,fontSize:11,fontWeight:700,cursor:'pointer',color:'#0f0f1a'}}>ğŸ“‹ Ù†Ø³Ø®</button>
          </div>
          <textarea readOnly value={SQL} style={{width:'100%',height:100,background:'#0a0a14',border:'1px solid var(--border)',borderRadius:8,padding:8,fontSize:9.5,color:'#7ee8a2',resize:'none',fontFamily:'monospace',direction:'ltr'}} />
        </div>

        {err && <div style={{background:'rgba(224,85,85,.1)',border:'1px solid rgba(224,85,85,.3)',color:'var(--danger)',padding:10,borderRadius:8,marginBottom:12,fontSize:12,textAlign:'center'}}>{err}</div>}

        <div style={{marginBottom:11}}>
          <label style={{display:'block',fontWeight:700,color:'var(--muted)',fontSize:12,marginBottom:4}}>Project URL</label>
          <input className="input-field" value={url} onChange={e=>setUrl(e.target.value)} placeholder="https://xxxxxxxxxxxx.supabase.co" style={{direction:'ltr',fontSize:13}} />
        </div>
        <div style={{marginBottom:18}}>
          <label style={{display:'block',fontWeight:700,color:'var(--muted)',fontSize:12,marginBottom:4}}>anon public key</label>
          <input className="input-field" value={key} onChange={e=>setKey(e.target.value)} placeholder="eyJhbGci..." style={{direction:'ltr',fontSize:13}} />
        </div>

        <button className="btn-gold" onClick={connect} disabled={loading} style={{width:'100%',padding:13,fontSize:15}}>
          {loading?'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...':'âœ… Ø§ØªØµØ§Ù„ ÙˆØ¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„'}
        </button>
        <p style={{textAlign:'center',marginTop:8,color:'var(--muted)',fontSize:11}}>ÙŠÙØ­ÙØ¸ ÙÙŠ Ù…ØªØµÙØ­Ùƒ â€” Ù„Ù† ØªÙØ·Ù„Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</p>
      </div>
    </div>
  );
}

// â”€â”€ App â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function App() {
  const [ready,setReady]=useState(!!SUPABASE_URL&&!!SUPABASE_KEY);
  const [loaded,setLoaded]=useState(false);
  const [page,setPage]=useState('home');
  const [products,setProducts]=useState(INIT_PRODUCTS);
  const [users,setUsers]=useState(INIT_USERS);
  const [orders,setOrders]=useState([]);
  const [cart,setCart]=useState([]);
  const [currentUser,setCurrentUser]=useState(()=>session.get());
  const [notifications,setNotifications]=useState([]);
  const [unreadCount,setUnreadCount]=useState(0);
  const [announcements,setAnnouncements]=useState(INIT_ANN);
  const [toast,setToast]=useState(null);
  const [selectedOrder,setSelectedOrder]=useState(null);
  const [adminTab,setAdminTab]=useState('dashboard');
  const toastTimer=useRef(null);

  const showToast=useCallback((msg,type='success')=>{
    if(toastTimer.current) clearTimeout(toastTimer.current);
    setToast({msg,type});
    toastTimer.current=setTimeout(()=>setToast(null),4000);
  },[]);

  // Load all data
  useEffect(()=>{
    if(!ready||!sb) return;
    (async()=>{
      try{
        const [p,u,ann,ords,notifs,uc]=await Promise.all([
          db.getSetting('products'), db.getSetting('users'), db.getSetting('announcements'),
          db.getOrders(), db.getNotifs(), db.getUnread()
        ]);
        // First time â€” seed data
        if(!p){ await Promise.all([db.setSetting('products',INIT_PRODUCTS),db.setSetting('users',INIT_USERS),db.setSetting('announcements',INIT_ANN)]); }
        setProducts(p||INIT_PRODUCTS);
        setUsers(u||INIT_USERS);
        setAnnouncements(ann||INIT_ANN);
        setOrders(ords);
        setNotifications(notifs);
        setUnreadCount(uc);
      }catch(e){console.error(e);}
      setLoaded(true);
    })();
  },[ready]);

  // Real-time subscriptions
  useEffect(()=>{
    if(!ready||!sb) return;
    const ch1 = sb.channel('orders_rt')
      .on('postgres_changes',{event:'INSERT',schema:'public',table:'gs_orders'},payload=>{
        setOrders(prev=>[payload.new,...prev]);
        // Notify admin
        const cu=session.get();
        if(cu?.role==='admin'){
          showToast(`ğŸ›’ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† ${payload.new.customer_name} â€” ${kwd(payload.new.total)}`,'success');
          setUnreadCount(c=>c+1);
        }
      })
      .on('postgres_changes',{event:'UPDATE',schema:'public',table:'gs_orders'},payload=>{
        setOrders(prev=>prev.map(o=>o.id===payload.new.id?payload.new:o));
      })
      .subscribe();

    const ch2 = sb.channel('notifs_rt')
      .on('postgres_changes',{event:'INSERT',schema:'public',table:'gs_notifications'},payload=>{
        setNotifications(prev=>[payload.new,...prev]);
      })
      .subscribe();

    return()=>{ sb.removeChannel(ch1); sb.removeChannel(ch2); };
  },[ready,showToast]);

  const saveProducts=async p=>{setProducts(p);await db.setSetting('products',p);};
  const saveUsers=async u=>{setUsers(u);await db.setSetting('users',u);};
  const saveAnnouncements=async a=>{setAnnouncements(a);await db.setSetting('announcements',a);};

  const placeOrder=async od=>{
    const order={id:genId(),customer_name:od.customerName,customer_email:od.customerEmail,customer_phone:od.customerPhone,user_id:od.userId,area:od.area,address:od.address,notes:od.notes,payment:od.payment,items:od.items,subtotal:od.subtotal,delivery:od.delivery,total:od.total,status:'new',order_date:new Date().toLocaleDateString('ar-KW'),order_time:new Date().toLocaleTimeString('ar-KW',{hour:'2-digit',minute:'2-digit'})};
    const saved=await db.insertOrder(order);
    await db.insertNotif({text:`Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ #${order.id} Ù…Ù† ${order.customer_name} Ø¨Ù‚ÙŠÙ…Ø© ${kwd(order.total)}`,order_id:order.id,read:false});
    setCart([]);showToast('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!');
    return saved||order;
  };

  const updateOrderStatus=async(id,s)=>{
    await db.updateStatus(id,s);
    setOrders(prev=>prev.map(o=>o.id===id?{...o,status:s}:o));
    showToast(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©: ${STATUS_MAP[s]}`);
  };

  const markAllRead=async()=>{
    await db.markRead();
    setNotifications(prev=>prev.map(n=>({...n,read:true})));
    setUnreadCount(0);
  };

  const login=([email,password])=>{
    const u=users.find(u=>u.email===email&&u.password===password);
    if(u){setCurrentUser(u);session.set(u);return{success:true,user:u};}
    return{success:false,error:'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©'};
  };

  const register=async(name,email,password,phone)=>{
    if(users.find(u=>u.email===email)) return{success:false,error:'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹'};
    const nu={id:'u-'+Date.now(),name,email,password,role:'customer',phone};
    await saveUsers([...users,nu]);
    setCurrentUser(nu);session.set(nu);
    return{success:true};
  };

  const logout=()=>{setCurrentUser(null);session.clear();setCart([]);setPage('home');};

  const addToCart=p=>{
    if(!currentUser){setPage('login');return;}
    setCart(prev=>{const ex=prev.find(i=>i.id===p.id);if(ex)return prev.map(i=>i.id===p.id?{...i,qty:i.qty+1}:i);return[...prev,{...p,qty:1}];});
    showToast('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© ğŸ›ï¸');
  };

  if(!ready) return <SetupScreen onDone={()=>setReady(true)} />;
  if(!loaded) return (
    <div style={{display:'flex',alignItems:'center',justifyContent:'center',height:'100vh',background:'var(--bg)',flexDirection:'column',gap:16}}>
      <div style={{width:44,height:44,border:'4px solid var(--border)',borderTopColor:'var(--gold)',borderRadius:'50%',animation:'spin 1s linear infinite'}}/>
      <div style={{color:'var(--gold)',fontSize:16,fontWeight:700}}>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Gift Star...</div>
    </div>
  );

  const cartCount=cart.reduce((s,i)=>s+i.qty,0);
  const cartTotal=cart.reduce((s,i)=>s+i.price*i.qty,0);
  const isAdmin=currentUser?.role==='admin';
  const p={page,setPage,products,users,orders,cart,setCart,currentUser,notifications,unreadCount,announcements,addToCart,placeOrder,login,register,logout,updateOrderStatus,saveProducts,saveUsers,saveAnnouncements,markAllRead,cartCount,cartTotal,isAdmin,selectedOrder,setSelectedOrder,adminTab,setAdminTab,showToast};

  return (
    <div style={{minHeight:'100vh',background:'var(--bg)',color:'var(--text)'}}>
      <Header {...p}/>
      <main>
        {page==='home'&&<HomePage {...p}/>}
        {page==='shop'&&<ShopPage {...p}/>}
        {page.startsWith('product:')&&<ProductPage {...p}/>}
        {page==='cart'&&<CartPage {...p}/>}
        {page==='checkout'&&<CheckoutPage {...p}/>}
        {page==='receipt'&&<ReceiptPage {...p}/>}
        {page==='orders'&&<MyOrdersPage {...p}/>}
        {page==='login'&&<LoginPage {...p}/>}
        {page==='register'&&<RegisterPage {...p}/>}
        {page==='admin'&&isAdmin&&<AdminPage {...p}/>}
      </main>
      {toast&&<div className="toast" style={{background:toast.type==='success'?'rgba(94,201,138,.95)':'rgba(224,85,85,.95)',color:'#fff'}}>{toast.msg}</div>}
    </div>
  );
}

// â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Header({page,setPage,cartCount,currentUser,notifications,unreadCount,markAllRead,isAdmin,logout,announcements}){
  const [showN,setShowN]=useState(false);
  const [showM,setShowM]=useState(false);
  const [idx,setIdx]=useState(0);
  const active=(announcements||[]).filter(a=>a.active);
  useEffect(()=>{if(active.length<=1)return;const t=setInterval(()=>setIdx(i=>(i+1)%active.length),4000);return()=>clearInterval(t);},[active.length]);
  const ann=active[idx]||null;
  const as=ann?(ANN_COLORS[ann.color]||ANN_COLORS.gold):null;
  return(
    <header style={{background:'rgba(15,15,26,.97)',backdropFilter:'blur(20px)',borderBottom:'1px solid var(--border)',position:'sticky',top:0,zIndex:100}}>
      {ann&&<div style={{background:as.bg,padding:'7px 16px',textAlign:'center',fontSize:13,fontWeight:600,color:as.color,position:'relative'}}>{ann.text}{active.length>1&&<span style={{position:'absolute',left:14,top:'50%',transform:'translateY(-50%)',display:'flex',gap:4}}>{active.map((_,i)=><span key={i} onClick={()=>setIdx(i)} style={{width:6,height:6,borderRadius:'50%',background:i===idx?'rgba(0,0,0,.6)':'rgba(0,0,0,.25)',cursor:'pointer',display:'inline-block'}}/>)}</span>}</div>}
      <div className="container" style={{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'14px 20px',gap:12}}>
        <button onClick={()=>setPage('home')} style={{background:'none',border:'none',cursor:'pointer',display:'flex',alignItems:'center',gap:8,flexShrink:0}}>
          <span style={{fontSize:26,color:'var(--gold)'}}>â˜…</span>
          <span style={{fontSize:20,fontWeight:900,background:'linear-gradient(135deg,var(--gold),var(--gold-light))',WebkitBackgroundClip:'text',WebkitTextFillColor:'transparent'}}>Gift Star</span>
        </button>
        <nav style={{display:'flex',alignItems:'center',gap:20,flexWrap:'wrap'}}>
          {[['home','Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©'],['shop','Ø§Ù„Ù…ØªØ¬Ø±']].map(([pg,l])=>(<button key={pg} onClick={()=>setPage(pg)} style={{background:'none',border:'none',cursor:'pointer',fontSize:14,fontWeight:600,color:page===pg?'var(--gold)':'var(--muted)',borderBottom:page===pg?'2px solid var(--gold)':'2px solid transparent',paddingBottom:2}}>{l}</button>))}
          {currentUser&&<button onClick={()=>setPage('orders')} style={{background:'none',border:'none',cursor:'pointer',fontSize:14,fontWeight:600,color:page==='orders'?'var(--gold)':'var(--muted)'}}>Ø·Ù„Ø¨Ø§ØªÙŠ</button>}
          {isAdmin&&<button onClick={()=>setPage('admin')} style={{background:'linear-gradient(135deg,var(--gold),var(--gold-light))',border:'none',cursor:'pointer',fontSize:13,fontWeight:800,color:'#0f0f1a',padding:'5px 14px',borderRadius:18}}>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>}
        </nav>
        <div style={{display:'flex',alignItems:'center',gap:12,flexShrink:0}}>
          <button onClick={()=>setPage('cart')} style={{background:'none',border:'none',cursor:'pointer',position:'relative'}}>
            <svg width={22} height={22} viewBox="0 0 24 24" fill="none" stroke="var(--gold)" strokeWidth={2}><circle cx={9} cy={21} r={1}/><circle cx={20} cy={21} r={1}/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
            {cartCount>0&&<span style={{position:'absolute',top:-6,right:-6,background:'var(--gold)',color:'#0f0f1a',borderRadius:'50%',width:18,height:18,fontSize:11,fontWeight:900,display:'flex',alignItems:'center',justifyContent:'center'}}>{cartCount}</span>}
          </button>
          {isAdmin&&(
            <div style={{position:'relative'}}>
              <button onClick={()=>{setShowN(!showN);if(!showN)markAllRead();}} style={{background:'none',border:'none',cursor:'pointer',position:'relative'}}>
                <svg width={22} height={22} viewBox="0 0 24 24" fill="none" stroke="var(--gold)" strokeWidth={2}><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
                {unreadCount>0&&<span style={{position:'absolute',top:-5,right:-5,background:'var(--danger)',color:'#fff',borderRadius:'50%',width:18,height:18,fontSize:10,fontWeight:900,display:'flex',alignItems:'center',justifyContent:'center',animation:'pulse 1.5s infinite'}}>{unreadCount>9?'9+':unreadCount}</span>}
              </button>
              {showN&&(
                <div className="notif-dropdown" style={{position:'absolute',left:0,top:'115%',background:'var(--bg2)',border:'1px solid var(--border)',borderRadius:14,width:330,maxHeight:380,overflowY:'auto',boxShadow:'0 12px 40px rgba(0,0,0,.5)',zIndex:200}}>
                  <div style={{padding:'12px 16px',borderBottom:'1px solid var(--border)',fontWeight:800,color:'var(--gold)',fontSize:14}}>ğŸ”” Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</div>
                  {!notifications.length?<div style={{padding:30,textAlign:'center',color:'var(--muted)',fontSize:14}}>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</div>
                  :notifications.slice(0,20).map(n=>(
                    <div key={n.id} style={{padding:'12px 16px',borderBottom:'1px solid var(--border)',background:n.read?'transparent':'rgba(200,169,110,.05)',display:'flex',gap:10}}>
                      <span style={{fontSize:18}}>ğŸ›’</span>
                      <div style={{flex:1}}><div style={{fontSize:13,lineHeight:1.5}}>{n.text}</div><div style={{fontSize:11,color:'var(--muted)',marginTop:3}}>{new Date(n.created_at).toLocaleString('ar-KW')}</div></div>
                      {!n.read&&<div style={{width:8,height:8,borderRadius:'50%',background:'var(--gold)',flexShrink:0,marginTop:4}}/>}
                    </div>
                  ))}
                </div>
              )}
            </div>
          )}
          {currentUser?(
            <div style={{position:'relative'}}>
              <button onClick={()=>setShowM(!showM)} style={{background:'var(--bg3)',border:'1px solid var(--border)',borderRadius:24,padding:'6px 14px',cursor:'pointer',display:'flex',alignItems:'center',gap:8,color:'var(--text)',fontSize:14}}>
                <span style={{color:'var(--gold)'}}>ğŸ‘¤</span>{currentUser.name.split(' ')[0]}
              </button>
              {showM&&<div style={{position:'absolute',left:0,top:'115%',background:'var(--bg2)',border:'1px solid var(--border)',borderRadius:12,minWidth:160,overflow:'hidden',boxShadow:'0 8px 30px rgba(0,0,0,.4)',zIndex:200}}>
                <button onClick={()=>{setPage('orders');setShowM(false);}} style={{display:'block',width:'100%',padding:'12px 16px',background:'none',border:'none',color:'var(--text)',cursor:'pointer',textAlign:'right',fontSize:14}}>ğŸ“¦ Ø·Ù„Ø¨Ø§ØªÙŠ</button>
                <button onClick={()=>{logout();setShowM(false);}} style={{display:'block',width:'100%',padding:'12px 16px',background:'none',border:'none',color:'var(--danger)',cursor:'pointer',textAlign:'right',fontSize:14}}>ğŸšª Ø®Ø±ÙˆØ¬</button>
              </div>}
            </div>
          ):<button onClick={()=>setPage('login')} className="btn-gold" style={{padding:'8px 18px',fontSize:13}}>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>}
        </div>
      </div>
    </header>
  );
}

// â”€â”€ Pages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function HomePage({setPage,products,addToCart}){
  const featured=products.filter(p=>p.featured).slice(0,8);
  return(
    <div>
      <div style={{background:'linear-gradient(135deg,#0f0f1a,#1a1a2e,#1e1a0e)',padding:'80px 20px',textAlign:'center',position:'relative',overflow:'hidden'}}>
        <div style={{position:'absolute',inset:0,background:'radial-gradient(circle at 50% 50%,rgba(200,169,110,.08),transparent 60%)',pointerEvents:'none'}}/>
        <div style={{position:'relative',zIndex:1}}>
          <div style={{fontSize:56,marginBottom:14}}>â˜…</div>
          <h1 style={{marginBottom:18}}>
            <span className="page-title" style={{fontSize:'clamp(38px,7vw,70px)',display:'block'}}>Gift Star</span>
            <span style={{color:'var(--muted)',fontSize:'clamp(18px,3vw,28px)',fontWeight:400}}>Ù…ØªØ¬Ø± Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ Ø§Ù„ÙƒÙˆÙŠØªÙŠ Ø§Ù„Ø£ÙˆÙ„</span>
          </h1>
          <p style={{color:'var(--muted)',fontSize:16,maxWidth:480,margin:'0 auto 34px'}}>Ø£Ø¬Ù…Ù„ Ø§Ù„ÙƒÙŠÙƒ ÙˆØ§Ù„ÙˆØ±Ø¯ ÙˆØ§Ù„Ù‡Ø¯Ø§ÙŠØ§ Ù„ÙƒÙ„ Ù…Ù†Ø§Ø³Ø¨Ø§ØªÙƒ Ø§Ù„Ù…Ù…ÙŠØ²Ø©</p>
          <button className="btn-gold" onClick={()=>setPage('shop')} style={{padding:'14px 36px',fontSize:17}}>ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù† ğŸ›ï¸</button>
        </div>
      </div>
      <div className="container" style={{padding:'60px 20px'}}>
        <h2 className="page-title" style={{textAlign:'center',marginBottom:32}}>ØªØ³ÙˆÙ‚ Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©</h2>
        <div className="grid-3">
          {[['cakes','ÙƒÙŠÙƒ ğŸ‚','https://images.unsplash.com/photo-1578985545062-69928b1d9587?w=400&h=200&fit=crop'],['flowers','ÙˆØ±Ø¯ ğŸŒ¹','https://images.unsplash.com/photo-1490750967868-88df5691cc95?w=400&h=200&fit=crop'],['gifts','Ù‡Ø¯Ø§ÙŠØ§ ğŸ','https://images.unsplash.com/photo-1513885535751-8b9238bd345a?w=400&h=200&fit=crop']].map(([k,l,img])=>(
            <div key={k} className="card" onClick={()=>setPage('shop:'+k)} style={{cursor:'pointer',overflow:'hidden'}}>
              <img src={img} alt={l} style={{width:'100%',height:140,objectFit:'cover'}}/>
              <div style={{padding:16,textAlign:'center',fontSize:17,fontWeight:800}}>{l}</div>
            </div>
          ))}
        </div>
      </div>
      <div style={{background:'var(--bg2)',padding:'60px 0'}}>
        <div className="container">
          <h2 className="page-title" style={{textAlign:'center',marginBottom:32}}>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø©</h2>
          <div className="grid-products">{featured.map(p=><ProductCard key={p.id} product={p} onAdd={addToCart} setPage={setPage}/>)}</div>
          <div style={{textAlign:'center',marginTop:32}}><button className="btn-outline" onClick={()=>setPage('shop')}>Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button></div>
        </div>
      </div>
      <div className="container" style={{padding:'60px 20px'}}>
        <h2 className="page-title" style={{textAlign:'center',marginBottom:32}}>Ù„Ù…Ø§Ø°Ø§ Gift StarØŸ</h2>
        <div className="grid-4">
          {[['ğŸ›¡ï¸','Ø¬ÙˆØ¯Ø© Ù…Ø¶Ù…ÙˆÙ†Ø©','Ù…Ù†ØªØ¬Ø§Øª Ø·Ø§Ø²Ø¬Ø© Ù…Ø®ØªØ§Ø±Ø© Ø¨Ø¹Ù†Ø§ÙŠØ©'],['âš¡','ØªÙˆØµÙŠÙ„ Ø³Ø±ÙŠØ¹','ØªÙˆØµÙŠÙ„ ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙŠÙˆÙ… Ù„ÙƒÙ„ Ø§Ù„ÙƒÙˆÙŠØª'],['ğŸ’','Ø®Ø¯Ù…Ø© Ø´Ø®ØµÙŠØ©','Ù†Ø³Ø§Ø¹Ø¯Ùƒ ÙÙŠ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‡Ø¯ÙŠØ© Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ©'],['ğŸ”’','Ø¯ÙØ¹ Ø¢Ù…Ù†','Ø·Ø±Ù‚ Ø¯ÙØ¹ Ù…ØªØ¹Ø¯Ø¯Ø© ÙˆØ¢Ù…Ù†Ø© 100%']].map(([ic,t,d],i)=>(
            <div key={i} className="card" style={{padding:22,textAlign:'center'}}><div style={{fontSize:36,marginBottom:10}}>{ic}</div><h3 style={{color:'var(--gold)',fontWeight:800,marginBottom:8,fontSize:15}}>{t}</h3><p style={{color:'var(--muted)',fontSize:13}}>{d}</p></div>
          ))}
        </div>
      </div>
      <footer style={{background:'var(--bg2)',borderTop:'1px solid var(--border)',padding:'20px 0',textAlign:'center'}}><p style={{color:'var(--muted)',fontSize:13}}>Â© 2024 Gift Star. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© â€” Ø§Ù„ÙƒÙˆÙŠØª</p></footer>
    </div>
  );
}

function ProductCard({product:p,onAdd,setPage}){
  const [added,setAdded]=useState(false);
  const h=e=>{e.stopPropagation();onAdd(p);setAdded(true);setTimeout(()=>setAdded(false),1500);};
  return(
    <div className="card animate-in" style={{overflow:'hidden',cursor:'pointer'}} onClick={()=>setPage('product:'+p.id)}>
      <div style={{position:'relative'}}><img src={p.img} alt={p.name} style={{width:'100%',height:200,objectFit:'cover'}} onError={e=>e.target.src='https://images.unsplash.com/photo-1549465220-1a8b9238cd48?w=400&h=200&fit=crop'}/>{p.badge&&<span className="badge" style={{position:'absolute',top:10,right:10}}>{p.badge}</span>}</div>
      <div style={{padding:16}}>
        <h3 style={{fontWeight:800,marginBottom:6,fontSize:15}}>{p.name}</h3>
        <p style={{color:'var(--muted)',fontSize:13,marginBottom:14,lineHeight:1.5}}>{p.desc.substring(0,55)}...</p>
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
          <span style={{color:'var(--gold)',fontWeight:900,fontSize:17}}>{kwd(p.price)}</span>
          <button className="btn-gold" onClick={h} style={{padding:'7px 16px',fontSize:12,background:added?'linear-gradient(135deg,var(--success),#7fe0a0)':undefined}}>{added?'âœ“':'Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©'}</button>
        </div>
      </div>
    </div>
  );
}

function ShopPage({page,products,addToCart,setPage}){
  const [cat,setCat]=useState(page.includes(':')?page.split(':')[1]:'all');
  const [sort,setSort]=useState('default');
  let list=cat==='all'?products:products.filter(p=>p.cat===cat);
  if(sort==='asc')list=[...list].sort((a,b)=>a.price-b.price);
  if(sort==='desc')list=[...list].sort((a,b)=>b.price-a.price);
  return(
    <div className="container" style={{padding:'40px 20px'}}>
      <h1 className="page-title" style={{marginBottom:28}}>Ø§Ù„Ù…ØªØ¬Ø±</h1>
      <div style={{display:'flex',gap:12,alignItems:'center',marginBottom:28,flexWrap:'wrap',justifyContent:'space-between'}}>
        <div style={{display:'flex',gap:8,flexWrap:'wrap'}}>
          {[['all','Ø§Ù„ÙƒÙ„'],['cakes','ÙƒÙŠÙƒ ğŸ‚'],['flowers','ÙˆØ±Ø¯ ğŸŒ¹'],['gifts','Ù‡Ø¯Ø§ÙŠØ§ ğŸ']].map(([v,l])=>(
            <button key={v} onClick={()=>setCat(v)} style={{padding:'7px 18px',borderRadius:20,border:'1.5px solid',borderColor:cat===v?'var(--gold)':'var(--border)',background:cat===v?'var(--gold)':'transparent',color:cat===v?'#0f0f1a':'var(--muted)',cursor:'pointer',fontWeight:700,fontSize:13}}>{l}</button>
          ))}
        </div>
        <select className="input-field" value={sort} onChange={e=>setSort(e.target.value)} style={{width:'auto',padding:'8px 14px'}}>
          <option value="default">Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</option><option value="asc">Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ù‚Ù„</option><option value="desc">Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰</option>
        </select>
      </div>
      <p style={{color:'var(--muted)',marginBottom:18,fontSize:13}}>ğŸ“¦ {list.length} Ù…Ù†ØªØ¬</p>
      <div className="grid-products">{list.map(p=><ProductCard key={p.id} product={p} onAdd={addToCart} setPage={setPage}/>)}</div>
    </div>
  );
}

function ProductPage({page,products,addToCart,setPage}){
  const id=parseInt(page.split(':')[1]);
  const p=products.find(pr=>pr.id===id);
  const [qty,setQty]=useState(1);
  const [added,setAdded]=useState(false);
  if(!p) return <div style={{padding:80,textAlign:'center',color:'var(--muted)'}}>Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</div>;
  const h=()=>{for(let i=0;i<qty;i++)addToCart(p);setAdded(true);setTimeout(()=>{setAdded(false);setPage('cart');},1000);};
  return(
    <div className="container" style={{padding:'40px 20px'}}>
      <button onClick={()=>setPage('shop')} style={{background:'none',border:'none',color:'var(--muted)',cursor:'pointer',marginBottom:24,fontSize:14}}>â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ØªØ¬Ø±</button>
      <div className="product-detail-grid" style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:40}}>
        <img src={p.img} alt={p.name} style={{width:'100%',borderRadius:16,maxHeight:440,objectFit:'cover'}} onError={e=>e.target.src='https://images.unsplash.com/photo-1549465220-1a8b9238cd48?w=500&h=440&fit=crop'}/>
        <div>
          {p.badge&&<span className="badge" style={{marginBottom:14,display:'inline-block'}}>{p.badge}</span>}
          <h1 style={{fontSize:30,fontWeight:900,marginBottom:10}}>{p.name}</h1>
          <div style={{fontSize:30,color:'var(--gold)',fontWeight:900,marginBottom:18}}>{kwd(p.price)}</div>
          <p style={{color:'var(--muted)',lineHeight:1.8,marginBottom:28,fontSize:15}}>{p.desc}</p>
          <div style={{display:'flex',alignItems:'center',gap:14,marginBottom:22}}>
            <button onClick={()=>setQty(Math.max(1,qty-1))} style={{width:38,height:38,borderRadius:'50%',background:'var(--bg3)',border:'1px solid var(--border)',color:'var(--text)',fontSize:20,cursor:'pointer'}}>-</button>
            <span style={{fontSize:20,fontWeight:800,minWidth:28,textAlign:'center'}}>{qty}</span>
            <button onClick={()=>setQty(qty+1)} style={{width:38,height:38,borderRadius:'50%',background:'var(--bg3)',border:'1px solid var(--border)',color:'var(--text)',fontSize:20,cursor:'pointer'}}>+</button>
          </div>
          <button className="btn-gold" onClick={h} style={{width:'100%',padding:15,fontSize:16,background:added?'linear-gradient(135deg,var(--success),#7fe0a0)':undefined}}>{added?'âœ“ ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©...':'Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø© ğŸ›’'}</button>
        </div>
      </div>
    </div>
  );
}

function CartPage({cart,setCart,setPage,currentUser}){
  const sub=cart.reduce((s,i)=>s+i.price*i.qty,0);
  const delivery=sub>15?0:1.5;
  const total=sub+delivery;
  if(!cart.length) return(<div style={{textAlign:'center',padding:'100px 20px'}}><div style={{fontSize:72,marginBottom:18,opacity:.3}}>ğŸ›’</div><h2 style={{color:'var(--muted)',marginBottom:16}}>Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</h2><button className="btn-gold" onClick={()=>setPage('shop')}>ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†</button></div>);
  return(
    <div className="container" style={{padding:'40px 20px'}}>
      <h1 className="page-title" style={{marginBottom:28}}>Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h1>
      <div className="cart-grid" style={{display:'grid',gridTemplateColumns:'1fr 340px',gap:28}}>
        <div>
          {cart.map(item=>(
            <div key={item.id} className="card" style={{display:'flex',gap:14,padding:18,marginBottom:14}}>
              <img src={item.img} alt={item.name} style={{width:88,height:88,borderRadius:10,objectFit:'cover',flexShrink:0}} onError={e=>e.target.src='https://images.unsplash.com/photo-1549465220-1a8b9238cd48?w=88&h=88&fit=crop'}/>
              <div style={{flex:1}}>
                <h3 style={{marginBottom:8,fontWeight:800,fontSize:15}}>{item.name}</h3>
                <div style={{display:'flex',alignItems:'center',gap:10,marginBottom:8}}>
                  <button onClick={()=>setCart(p=>p.map(i=>i.id===item.id?{...i,qty:Math.max(1,i.qty-1)}:i))} style={{width:28,height:28,borderRadius:'50%',background:'var(--bg3)',border:'1px solid var(--border)',cursor:'pointer',color:'var(--text)'}}>-</button>
                  <span style={{fontWeight:800,minWidth:20,textAlign:'center'}}>{item.qty}</span>
                  <button onClick={()=>setCart(p=>p.map(i=>i.id===item.id?{...i,qty:i.qty+1}:i))} style={{width:28,height:28,borderRadius:'50%',background:'var(--bg3)',border:'1px solid var(--border)',cursor:'pointer',color:'var(--text)'}}>+</button>
                </div>
                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                  <span style={{color:'var(--gold)',fontWeight:900}}>{kwd(item.price*item.qty)}</span>
                  <button onClick={()=>setCart(p=>p.filter(i=>i.id!==item.id))} style={{background:'none',border:'none',color:'var(--danger)',cursor:'pointer',fontSize:13}}>Ø­Ø°Ù âœ•</button>
                </div>
              </div>
            </div>
          ))}
        </div>
        <div>
          <div className="card" style={{padding:22,position:'sticky',top:80}}>
            <h3 style={{fontWeight:800,marginBottom:18,color:'var(--gold)'}}>Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨</h3>
            {[['Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ',kwd(sub)],['Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„',delivery===0?'Ù…Ø¬Ø§Ù†ÙŠ ğŸ‰':kwd(delivery)]].map(([l,v])=>(<div key={l} style={{display:'flex',justifyContent:'space-between',padding:'9px 0',borderBottom:'1px solid var(--border)',color:'var(--muted)',fontSize:14}}><span>{l}</span><span style={{color:delivery===0&&l.includes('ØªÙˆØµÙŠÙ„')?'var(--success)':undefined}}>{v}</span></div>))}
            <div style={{display:'flex',justifyContent:'space-between',padding:'15px 0 0',fontSize:19,fontWeight:900}}><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span><span style={{color:'var(--gold)'}}>{kwd(total)}</span></div>
            <button className="btn-gold" onClick={()=>setPage(currentUser?'checkout':'login')} style={{width:'100%',padding:13,fontSize:15,marginTop:18}}>{currentUser?'Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø¯ÙØ¹ â†’':'Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©'}</button>
            <button className="btn-outline" onClick={()=>setPage('shop')} style={{width:'100%',marginTop:10,padding:11}}>Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ³ÙˆÙ‚</button>
          </div>
        </div>
      </div>
    </div>
  );
}

function CheckoutPage({cart,currentUser,placeOrder,setPage,setSelectedOrder}){
  const [form,setForm]=useState({name:currentUser?.name||'',phone:currentUser?.phone||'',area:'',address:'',notes:'',payment:'cash'});
  const [errors,setErrors]=useState({});
  const [loading,setLoading]=useState(false);
  const sub=cart.reduce((s,i)=>s+i.price*i.qty,0);
  const delivery=sub>15?0:1.5;
  const total=sub+delivery;
  if(!cart.length){setPage('shop');return null;}
  const validate=()=>{const e={};if(!form.name.trim())e.name='Ø§Ù„Ø§Ø³Ù… Ù…Ø·Ù„ÙˆØ¨';if(!form.phone.match(/^[569]\d{7}$/))e.phone='Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­';if(!form.area)e.area='Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©';if(!form.address.trim())e.address='Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù…Ø·Ù„ÙˆØ¨';setErrors(e);return!Object.keys(e).length;};
  const submit=async()=>{
    if(!validate())return;
    setLoading(true);
    const order=await placeOrder({customerName:form.name,customerEmail:currentUser.email,customerPhone:form.phone,userId:currentUser.id,area:form.area,address:form.address,notes:form.notes,payment:form.payment,items:cart,subtotal:sub,delivery,total});
    setSelectedOrder(order);setLoading(false);setPage('receipt');
  };
  return(
    <div className="container" style={{padding:'40px 20px'}}>
      <h1 className="page-title" style={{marginBottom:28}}>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</h1>
      <div className="checkout-grid" style={{display:'grid',gridTemplateColumns:'1fr 340px',gap:28}}>
        <div>
          <div className="card" style={{padding:22,marginBottom:18}}>
            <h3 style={{color:'var(--gold)',fontWeight:800,marginBottom:18}}>ğŸ“ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</h3>
            {[['Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *','name','text','Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…'],['Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *','phone','tel','5xxxxxxx']].map(([l,f,t,ph])=>(
              <div key={f} style={{marginBottom:14}}>
                <label style={{display:'block',fontWeight:700,color:'var(--muted)',fontSize:13,marginBottom:5}}>{l}</label>
                <input className="input-field" type={t} value={form[f]} placeholder={ph} onChange={e=>setForm({...form,[f]:e.target.value})}/>
                {errors[f]&&<div style={{color:'var(--danger)',fontSize:12,marginTop:3}}>{errors[f]}</div>}
              </div>
            ))}
            <div style={{marginBottom:14}}>
              <label style={{display:'block',fontWeight:700,color:'var(--muted)',fontSize:13,marginBottom:5}}>Ø§Ù„Ù…Ù†Ø·Ù‚Ø© *</label>
              <select className="input-field" value={form.area} onChange={e=>setForm({...form,area:e.target.value})}><option value="">Ø§Ø®ØªØ±</option>{AREAS.map(a=><option key={a} value={a}>{a}</option>)}</select>
              {errors.area&&<div style={{color:'var(--danger)',fontSize:12,marginTop:3}}>{errors.area}</div>}
            </div>
            <div style={{marginBottom:14}}>
              <label style={{display:'block',fontWeight:700,color:'var(--muted)',fontSize:13,marginBottom:5}}>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† *</label>
              <textarea className="input-field" rows={2} value={form.address} onChange={e=>setForm({...form,address:e.target.value})} placeholder="Ø§Ù„Ø´Ø§Ø±Ø¹ØŒ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰..." style={{resize:'vertical'}}/>
              {errors.address&&<div style={{color:'var(--danger)',fontSize:12,marginTop:3}}>{errors.address}</div>}
            </div>
            <div>
              <label style={{display:'block',fontWeight:700,color:'var(--muted)',fontSize:13,marginBottom:5}}>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
              <textarea className="input-field" rows={2} value={form.notes} onChange={e=>setForm({...form,notes:e.target.value})} style={{resize:'vertical'}}/>
            </div>
          </div>
          <div className="card" style={{padding:22}}>
            <h3 style={{color:'var(--gold)',fontWeight:800,marginBottom:16}}>ğŸ’³ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</h3>
            {[['cash','Ø§Ù„Ø¯ÙØ¹ Ù†Ù‚Ø¯Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… ğŸ’µ'],['card','Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†ÙŠØ© ğŸ’³'],['transfer','ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ ğŸ¦']].map(([v,l])=>(
              <label key={v} style={{display:'flex',alignItems:'center',gap:10,padding:13,marginBottom:9,background:'var(--bg3)',borderRadius:10,cursor:'pointer',border:'1.5px solid',borderColor:form.payment===v?'var(--gold)':'var(--border)'}}>
                <input type="radio" name="pay" value={v} checked={form.payment===v} onChange={()=>setForm({...form,payment:v})} style={{accentColor:'var(--gold)'}}/>
                <span style={{fontWeight:600,fontSize:14}}>{l}</span>
              </label>
            ))}
          </div>
        </div>
        <div>
          <div className="card" style={{padding:22,position:'sticky',top:80}}>
            <h3 style={{color:'var(--gold)',fontWeight:800,marginBottom:18}}>ğŸ›’ Ù…Ù„Ø®Øµ</h3>
            <div style={{maxHeight:190,overflowY:'auto',marginBottom:14}}>
              {cart.map(i=><div key={i.id} style={{display:'flex',justifyContent:'space-between',padding:'6px 0',borderBottom:'1px solid var(--border)',fontSize:13,color:'var(--muted)'}}><span>{i.name} Ã—{i.qty}</span><span>{kwd(i.price*i.qty)}</span></div>)}
            </div>
            {[['Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹',kwd(sub)],['Ø§Ù„ØªÙˆØµÙŠÙ„',delivery===0?'Ù…Ø¬Ø§Ù†ÙŠ ğŸ‰':kwd(delivery)]].map(([l,v])=>(<div key={l} style={{display:'flex',justifyContent:'space-between',padding:'7px 0',color:'var(--muted)',fontSize:14}}><span>{l}</span><span>{v}</span></div>))}
            <div style={{display:'flex',justifyContent:'space-between',padding:'14px 0 0',borderTop:'2px solid var(--border)',fontSize:19,fontWeight:900}}><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span><span style={{color:'var(--gold)'}}>{kwd(total)}</span></div>
            <button className="btn-gold" onClick={submit} disabled={loading} style={{width:'100%',padding:14,fontSize:15,marginTop:18}}>{loading?'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...':`Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ â€¢ ${kwd(total)}`}</button>
          </div>
        </div>
      </div>
    </div>
  );
}

function ReceiptPage({selectedOrder:o,setPage}){
  if(!o){setPage('home');return null;}
  return(
    <div className="container" style={{padding:'40px 20px',maxWidth:580}}>
      <div className="card" style={{padding:38,textAlign:'center'}}>
        <div style={{fontSize:64,marginBottom:14}}>ğŸ‰</div>
        <h1 style={{color:'var(--success)',marginBottom:8,fontWeight:900,fontSize:26}}>ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ!</h1>
        <p style={{color:'var(--muted)',marginBottom:28}}>Ø´ÙƒØ±Ø§Ù‹ {o.customer_name||o.customerName}ØŒ Ø³ÙŠØµÙ„ Ø·Ù„Ø¨Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹</p>
        <div style={{background:'var(--bg3)',borderRadius:12,padding:20,marginBottom:20,textAlign:'right'}}>
          <div style={{display:'flex',justifyContent:'space-between',marginBottom:10}}><span style={{color:'var(--gold)',fontWeight:800,fontSize:18}}>{o.id}</span><span style={{color:'var(--muted)',fontSize:12}}>{o.order_date}</span></div>
          {(o.items||[]).map((i,idx)=><div key={idx} style={{display:'flex',justifyContent:'space-between',padding:'5px 0',borderBottom:'1px solid var(--border)',color:'var(--muted)',fontSize:13}}><span>{i.name} Ã—{i.qty}</span><span>{kwd(i.price*i.qty)}</span></div>)}
          <div style={{display:'flex',justifyContent:'space-between',padding:'12px 0 0',fontWeight:900,fontSize:17}}><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span><span style={{color:'var(--gold)'}}>{kwd(o.total)}</span></div>
        </div>
        <div style={{background:'rgba(94,201,138,.1)',border:'1px solid rgba(94,201,138,.3)',borderRadius:10,padding:12,marginBottom:22,color:'var(--success)',fontSize:13,textAlign:'right'}}>ğŸ“ {o.area} â€” {o.address}</div>
        <div style={{display:'flex',gap:10,justifyContent:'center',flexWrap:'wrap'}}>
          <button className="btn-gold" onClick={()=>setPage('orders')}>Ø·Ù„Ø¨Ø§ØªÙŠ</button>
          <button className="btn-outline" onClick={()=>setPage('shop')}>Ù…ÙˆØ§ØµÙ„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</button>
        </div>
      </div>
    </div>
  );
}

function MyOrdersPage({orders,currentUser,setPage,setSelectedOrder}){
  if(!currentUser){setPage('login');return null;}
  const mine=orders.filter(o=>o.user_id===currentUser.id||o.customer_email===currentUser.email);
  return(
    <div className="container" style={{padding:'40px 20px'}}>
      <h1 className="page-title" style={{marginBottom:28}}>Ø·Ù„Ø¨Ø§ØªÙŠ</h1>
      {!mine.length?<div style={{textAlign:'center',padding:'80px 20px'}}><div style={{fontSize:64,opacity:.3,marginBottom:16}}>ğŸ“¦</div><h3 style={{color:'var(--muted)'}}>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯</h3><button className="btn-gold" onClick={()=>setPage('shop')} style={{marginTop:20}}>ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†</button></div>
      :mine.map(o=>(
        <div key={o.id} className="card" style={{padding:20,marginBottom:14,cursor:'pointer'}} onClick={()=>{setSelectedOrder(o);setPage('receipt');}}>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:12}}>
            <span style={{color:'var(--gold)',fontWeight:800,fontSize:17}}>{o.id}</span>
            <span style={{background:`${STATUS_COLOR[o.status]}20`,color:STATUS_COLOR[o.status],border:`1px solid ${STATUS_COLOR[o.status]}50`,padding:'3px 12px',borderRadius:18,fontSize:12,fontWeight:700}}>{STATUS_MAP[o.status]}</span>
          </div>
          <div style={{color:'var(--muted)',fontSize:13,marginBottom:10}}>{o.items?.length} Ù…Ù†ØªØ¬Ø§Øª â€¢ {o.order_date}</div>
          <div style={{display:'flex',justifyContent:'space-between'}}><span style={{color:'var(--muted)',fontSize:13}}>ğŸ“ {o.area}</span><span style={{color:'var(--gold)',fontWeight:900,fontSize:17}}>{kwd(o.total)}</span></div>
        </div>
      ))}
    </div>
  );
}

function LoginPage({login,setPage}){
  const [email,setEmail]=useState('admin@giftstar.kw');
  const [pass,setPass]=useState('Admin@2024');
  const [err,setErr]=useState('');
  const [loading,setLoading]=useState(false);
  const submit=()=>{setLoading(true);setErr('');setTimeout(()=>{const r=login([email,pass]);if(r.success)setPage(r.user.role==='admin'?'admin':'home');else setErr(r.error);setLoading(false);},400);};
  return(
    <div style={{display:'flex',alignItems:'center',justifyContent:'center',minHeight:'80vh',padding:20}}>
      <div className="card" style={{padding:38,width:'100%',maxWidth:420}}>
        <h2 style={{textAlign:'center',fontWeight:900,fontSize:26,marginBottom:8}}>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
        <p style={{textAlign:'center',color:'var(--muted)',marginBottom:28}}>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Gift Star âœ¨</p>
        {err&&<div style={{background:'rgba(224,85,85,.1)',border:'1px solid rgba(224,85,85,.3)',color:'var(--danger)',padding:12,borderRadius:10,marginBottom:18,textAlign:'center',fontSize:13}}>{err}</div>}
        {[['Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ','email',email,setEmail],['ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±','password',pass,setPass]].map(([l,t,v,sv])=>(
          <div key={l} style={{marginBottom:16}}><label style={{display:'block',fontWeight:700,color:'var(--muted)',fontSize:13,marginBottom:5}}>{l}</label><input className="input-field" type={t} value={v} onChange={e=>sv(e.target.value)} onKeyDown={e=>e.key==='Enter'&&submit()}/></div>
        ))}
        <button className="btn-gold" onClick={submit} disabled={loading} style={{width:'100%',padding:13,fontSize:15,marginTop:4}}>{loading?'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„...':'Ø¯Ø®ÙˆÙ„'}</button>
        <div style={{marginTop:16,padding:12,background:'var(--bg3)',borderRadius:10,fontSize:12,color:'var(--muted)'}}><div>ğŸ”‘ Ø£Ø¯Ù…Ù†: admin@giftstar.kw / Admin@2024</div><div style={{marginTop:3}}>ğŸ‘¤ Ø¹Ù…ÙŠÙ„: ahmed@test.com / 12345678</div></div>
        <p style={{textAlign:'center',marginTop:16,color:'var(--muted)',fontSize:13}}>Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <button onClick={()=>setPage('register')} style={{background:'none',border:'none',color:'var(--gold)',cursor:'pointer',fontWeight:700,fontSize:13}}>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button></p>
      </div>
    </div>
  );
}

function RegisterPage({register,setPage}){
  const [f,setF]=useState({name:'',email:'',phone:'',password:'',confirm:''});
  const [err,setErr]=useState('');
  const [loading,setLoading]=useState(false);
  const submit=async()=>{
    if(!f.name||!f.email||!f.password){setErr('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');return;}
    if(f.password.length<8){setErr('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± 8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');return;}
    if(f.password!==f.confirm){setErr('ÙƒÙ„Ù…ØªØ§ Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†');return;}
    setLoading(true);setErr('');
    const r=await register(f.name,f.email,f.password,f.phone);
    if(r.success)setPage('home');else setErr(r.error);
    setLoading(false);
  };
  return(
    <div style={{display:'flex',alignItems:'center',justifyContent:'center',minHeight:'80vh',padding:20}}>
      <div className="card" style={{padding:38,width:'100%',maxWidth:420}}>
        <h2 style={{textAlign:'center',fontWeight:900,fontSize:26,marginBottom:8}}>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h2>
        <p style={{textAlign:'center',color:'var(--muted)',marginBottom:28}}>Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Gift Star ğŸŒŸ</p>
        {err&&<div style={{background:'rgba(224,85,85,.1)',border:'1px solid rgba(224,85,85,.3)',color:'var(--danger)',padding:12,borderRadius:10,marginBottom:18,textAlign:'center',fontSize:13}}>{err}</div>}
        {[['name','Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„','text'],['email','Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ','email'],['phone','Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ','tel'],['password','ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±','password'],['confirm','ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±','password']].map(([field,label,type])=>(
          <div key={field} style={{marginBottom:13}}><label style={{display:'block',fontWeight:700,color:'var(--muted)',fontSize:13,marginBottom:5}}>{label}</label><input className="input-field" type={type} value={f[field]} onChange={e=>setF({...f,[field]:e.target.value})}/></div>
        ))}
        <button className="btn-gold" onClick={submit} disabled={loading} style={{width:'100%',padding:13,fontSize:15,marginTop:6}}>{loading?'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...':'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨'}</button>
        <p style={{textAlign:'center',marginTop:16,color:'var(--muted)',fontSize:13}}>Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <button onClick={()=>setPage('login')} style={{background:'none',border:'none',color:'var(--gold)',cursor:'pointer',fontWeight:700,fontSize:13}}>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button></p>
      </div>
    </div>
  );
}

// â”€â”€ Admin â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function AdminPage({orders,products,users,updateOrderStatus,saveProducts,adminTab,setAdminTab,notifications,unreadCount,markAllRead,showToast,announcements,saveAnnouncements}){
  const totalRev=orders.filter(o=>o.status!=='cancelled').reduce((s,o)=>s+o.total,0);
  const todayDate=new Date().toLocaleDateString('ar-KW');
  const todayOrders=orders.filter(o=>o.order_date===todayDate);
  const tabs=[['dashboard','ğŸ“Š Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©'],['orders','ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨Ø§Øª'],['products','ğŸ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª'],['announcements','ğŸ“¢ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª'],['notifications','ğŸ”” Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª'],['users','ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†']];
  return(
    <div className="admin-layout" style={{display:'grid',gridTemplateColumns:'210px 1fr',minHeight:'calc(100vh - 110px)'}}>
      <div className="admin-sidebar" style={{background:'var(--bg2)',borderLeft:'1px solid var(--border)',padding:16}}>
        <div style={{fontSize:12,color:'var(--muted)',fontWeight:700,marginBottom:12,padding:'0 4px'}}>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
        {tabs.map(([id,label])=>(
          <button key={id} className={'admin-sidebar-btn'+(adminTab===id?' active':'')} onClick={()=>setAdminTab(id)}>
            {label}
            {id==='notifications'&&unreadCount>0&&<span style={{position:'absolute',left:10,top:'50%',transform:'translateY(-50%)',background:'var(--danger)',color:'#fff',borderRadius:'50%',width:17,height:17,fontSize:10,fontWeight:900,display:'inline-flex',alignItems:'center',justifyContent:'center'}}>{unreadCount}</span>}
          </button>
        ))}
      </div>
      <div style={{padding:28,overflowY:'auto'}}>
        {adminTab==='dashboard'&&<AdminDash orders={orders} products={products} users={users} totalRev={totalRev} todayOrders={todayOrders}/>}
        {adminTab==='orders'&&<AdminOrders orders={orders} updateOrderStatus={updateOrderStatus}/>}
        {adminTab==='products'&&<AdminProducts products={products} saveProducts={saveProducts} showToast={showToast}/>}
        {adminTab==='announcements'&&<AdminAnn announcements={announcements} saveAnnouncements={saveAnnouncements} showToast={showToast}/>}
        {adminTab==='notifications'&&<AdminNotifs notifications={notifications} markAllRead={markAllRead}/>}
        {adminTab==='users'&&<AdminUsers users={users} orders={orders}/>}
      </div>
    </div>
  );
}

function AdminDash({orders,products,users,totalRev,todayOrders}){
  const stats=[{l:'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª',v:orders.length,i:'ğŸ“¦',c:'var(--gold)'},{l:'Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…',v:todayOrders.length,i:'ğŸ—“ï¸',c:'var(--success)'},{l:'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª',v:kwd(totalRev),i:'ğŸ’°',c:'#a78bfa'},{l:'Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª',v:products.length,i:'ğŸ',c:'#38bdf8'},{l:'Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡',v:users.filter(u=>u.role==='customer').length,i:'ğŸ‘¥',c:'#fb923c'},{l:'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©',v:orders.filter(o=>['new','processing'].includes(o.status)).length,i:'âš¡',c:'#f59e0b'}];
  return(
    <div>
      <h2 style={{color:'var(--gold)',fontWeight:900,marginBottom:22}}>ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</h2>
      <div className="grid-3" style={{marginBottom:28}}>{stats.map((s,i)=><div key={i} className="card" style={{padding:20}}><div style={{fontSize:30,marginBottom:8}}>{s.i}</div><div style={{fontSize:22,fontWeight:900,color:s.c}}>{s.v}</div><div style={{color:'var(--muted)',fontSize:13,marginTop:2}}>{s.l}</div></div>)}</div>
      <h3 style={{color:'var(--gold)',fontWeight:800,marginBottom:14}}>Ø¢Ø®Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
      {!orders.length?<div style={{color:'var(--muted)',textAlign:'center',padding:40}}>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯</div>
      :orders.slice(0,5).map(o=>(
        <div key={o.id} className="card" style={{padding:15,marginBottom:10,display:'flex',justifyContent:'space-between',alignItems:'center'}}>
          <div><span style={{color:'var(--gold)',fontWeight:800}}>{o.id}</span><span style={{color:'var(--muted)',fontSize:12,marginRight:10}}>{o.customer_name} â€¢ {o.order_date}</span></div>
          <div style={{display:'flex',gap:10,alignItems:'center'}}><span style={{background:`${STATUS_COLOR[o.status]}20`,color:STATUS_COLOR[o.status],border:`1px solid ${STATUS_COLOR[o.status]}50`,padding:'2px 10px',borderRadius:16,fontSize:12,fontWeight:700}}>{STATUS_MAP[o.status]}</span><span style={{color:'var(--gold)',fontWeight:900}}>{kwd(o.total)}</span></div>
        </div>
      ))}
    </div>
  );
}

function AdminOrders({orders,updateOrderStatus}){
  const [filter,setFilter]=useState('all');
  const filtered=filter==='all'?orders:orders.filter(o=>o.status===filter);
  return(
    <div>
      <h2 style={{color:'var(--gold)',fontWeight:900,marginBottom:22}}>ğŸ“¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª ({orders.length})</h2>
      <div style={{display:'flex',gap:8,marginBottom:20,flexWrap:'wrap'}}>
        {[['all','Ø§Ù„ÙƒÙ„'],['new','Ø¬Ø¯ÙŠØ¯'],['processing','Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©'],['delivered','Ù…ÙØ³Ù„ÙÙ‘Ù…'],['cancelled','Ù…Ù„ØºÙŠ']].map(([v,l])=>(
          <button key={v} onClick={()=>setFilter(v)} style={{padding:'6px 16px',borderRadius:18,border:'1.5px solid',borderColor:filter===v?'var(--gold)':'var(--border)',background:filter===v?'var(--gold)':'transparent',color:filter===v?'#0f0f1a':'var(--muted)',cursor:'pointer',fontWeight:700,fontSize:12}}>
            {l} {v!=='all'&&`(${orders.filter(o=>o.status===v).length})`}
          </button>
        ))}
      </div>
      {!filtered.length?<div style={{color:'var(--muted)',textAlign:'center',padding:50}}>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</div>
      :filtered.map(o=>(
        <div key={o.id} className="card" style={{padding:20,marginBottom:14}}>
          <div style={{display:'flex',justifyContent:'space-between',marginBottom:12}}>
            <div><span style={{color:'var(--gold)',fontWeight:900,fontSize:17}}>{o.id}</span><span style={{color:'var(--muted)',fontSize:12,marginRight:10}}>{o.order_date} {o.order_time}</span></div>
            <span style={{color:'var(--gold)',fontWeight:900,fontSize:18}}>{kwd(o.total)}</span>
          </div>
          <div className="grid-2" style={{marginBottom:12,fontSize:13,color:'var(--muted)'}}>
            <div>ğŸ‘¤ {o.customer_name}</div><div>ğŸ“± {o.customer_phone}</div>
            <div>ğŸ“ {o.area} â€” {o.address}</div>
            <div>ğŸ’³ {{cash:'Ù†Ù‚Ø¯Ø§Ù‹',card:'Ø¨Ø·Ø§Ù‚Ø©',transfer:'ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ'}[o.payment]||o.payment}</div>
          </div>
          <div style={{marginBottom:12}}>{(o.items||[]).map((i,idx)=><span key={idx} style={{display:'inline-block',background:'var(--bg3)',border:'1px solid var(--border)',borderRadius:8,padding:'2px 10px',margin:'2px',fontSize:12,color:'var(--muted)'}}>{i.name} Ã—{i.qty}</span>)}</div>
          {o.notes&&<div style={{color:'var(--muted)',fontSize:12,marginBottom:12,padding:'7px 12px',background:'var(--bg3)',borderRadius:8}}>ğŸ’¬ {o.notes}</div>}
          <div style={{display:'flex',gap:8,flexWrap:'wrap',alignItems:'center'}}>
            <span style={{fontSize:12,color:'var(--muted)'}}>Ø§Ù„Ø­Ø§Ù„Ø©:</span>
            {Object.entries(STATUS_MAP).map(([v,l])=>(
              <button key={v} onClick={()=>updateOrderStatus(o.id,v)} style={{padding:'5px 12px',borderRadius:18,border:'1.5px solid',borderColor:o.status===v?STATUS_COLOR[v]:'var(--border)',background:o.status===v?`${STATUS_COLOR[v]}20`:'transparent',color:o.status===v?STATUS_COLOR[v]:'var(--muted)',cursor:'pointer',fontSize:12,fontWeight:700}}>{l}</button>
            ))}
          </div>
        </div>
      ))}
    </div>
  );
}

function AdminProducts({products,saveProducts,showToast}){
  const [editing,setEditing]=useState(null);
  const [showAdd,setShowAdd]=useState(false);
  const [form,setForm]=useState({});
  const startEdit=p=>{setEditing(p.id);setForm({...p});setShowAdd(false);};
  const startAdd=()=>{setShowAdd(true);setEditing(null);setForm({id:Date.now(),name:'',cat:'cakes',price:0,img:'',desc:'',badge:'',stock:10,featured:false});};
  const cancel=()=>{setEditing(null);setShowAdd(false);};
  const save=async()=>{if(!form.name||!form.price){showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠØ©','error');return;}const np=showAdd?[form,...products]:products.map(p=>p.id===editing?form:p);await saveProducts(np);showToast(showAdd?'ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…':'ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« âœ…');cancel();};
  const del=async id=>{await saveProducts(products.filter(p=>p.id!==id));showToast('ØªÙ… Ø§Ù„Ø­Ø°Ù');};
  return(
    <div>
      <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:22}}>
        <h2 style={{color:'var(--gold)',fontWeight:900}}>ğŸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ({products.length})</h2>
        <button className="btn-gold" onClick={startAdd} style={{padding:'8px 20px',fontSize:13}}>+ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>
      </div>
      {(editing!==null||showAdd)&&(
        <div className="card" style={{padding:22,marginBottom:22}}>
          <h3 style={{color:'var(--gold)',marginBottom:18}}>{showAdd?'Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯':'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬'}</h3>
          <div className="grid-2">
            {[['Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ *','name','text'],['Ø§Ù„Ø³Ø¹Ø± (Ø¯.Ùƒ) *','price','number'],['Ø§Ù„Ù…Ø®Ø²ÙˆÙ†','stock','number']].map(([l,f,t])=>(
              <div key={f}><label style={{display:'block',fontWeight:700,color:'var(--muted)',fontSize:12,marginBottom:4}}>{l}</label><input className="input-field" type={t} value={form[f]||''} onChange={e=>setForm({...form,[f]:t==='number'?parseFloat(e.target.value):e.target.value})} style={{marginBottom:12}}/></div>
            ))}
            <div><label style={{display:'block',fontWeight:700,color:'var(--muted)',fontSize:12,marginBottom:4}}>Ø§Ù„ÙØ¦Ø©</label><select className="input-field" value={form.cat||'cakes'} onChange={e=>setForm({...form,cat:e.target.value})} style={{marginBottom:12}}><option value="cakes">ÙƒÙŠÙƒ</option><option value="flowers">ÙˆØ±Ø¯</option><option value="gifts">Ù‡Ø¯Ø§ÙŠØ§</option></select></div>
          </div>
          <div style={{marginBottom:12}}><label style={{display:'block',fontWeight:700,color:'var(--muted)',fontSize:12,marginBottom:4}}>Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©</label><input className="input-field" value={form.img||''} onChange={e=>setForm({...form,img:e.target.value})}/></div>
          <div style={{marginBottom:12}}><label style={{display:'block',fontWeight:700,color:'var(--muted)',fontSize:12,marginBottom:4}}>Ø§Ù„ÙˆØµÙ</label><textarea className="input-field" value={form.desc||''} onChange={e=>setForm({...form,desc:e.target.value})} rows={2} style={{resize:'vertical'}}/></div>
          <div className="grid-2" style={{marginBottom:14}}>
            <div><label style={{display:'block',fontWeight:700,color:'var(--muted)',fontSize:12,marginBottom:4}}>Ø´Ø§Ø±Ø©</label><input className="input-field" value={form.badge||''} onChange={e=>setForm({...form,badge:e.target.value})}/></div>
            <div><label style={{display:'block',fontWeight:700,color:'var(--muted)',fontSize:12,marginBottom:8}}>Ù…Ù…ÙŠØ²</label><label style={{display:'flex',alignItems:'center',gap:8,cursor:'pointer',marginTop:6}}><input type="checkbox" checked={form.featured||false} onChange={e=>setForm({...form,featured:e.target.checked})} style={{width:16,height:16,accentColor:'var(--gold)'}}/><span style={{fontSize:14}}>Ù†Ø¹Ù…</span></label></div>
          </div>
          <div style={{display:'flex',gap:10}}><button className="btn-gold" onClick={save} style={{padding:'9px 22px',fontSize:13}}>ğŸ’¾ Ø­ÙØ¸</button><button className="btn-outline" onClick={cancel} style={{padding:'9px 22px',fontSize:13}}>Ø¥Ù„ØºØ§Ø¡</button></div>
        </div>
      )}
      <div style={{display:'flex',flexDirection:'column',gap:10}}>
        {products.map(p=>(
          <div key={p.id} className="card" style={{padding:14,display:'flex',gap:12,alignItems:'center'}}>
            <img src={p.img} alt={p.name} style={{width:64,height:64,borderRadius:8,objectFit:'cover',flexShrink:0}} onError={e=>e.target.src='https://images.unsplash.com/photo-1549465220-1a8b9238cd48?w=64&h=64&fit=crop'}/>
            <div style={{flex:1}}><div style={{fontWeight:800,fontSize:14}}>{p.name}</div><div style={{color:'var(--muted)',fontSize:12,marginTop:3}}>{p.cat} â€¢ Ù…Ø®Ø²ÙˆÙ†: {p.stock} â€¢ {kwd(p.price)}</div></div>
            <div style={{display:'flex',gap:8}}><button className="btn-outline" onClick={()=>startEdit(p)} style={{padding:'5px 14px',fontSize:12}}>ØªØ¹Ø¯ÙŠÙ„</button><button onClick={()=>del(p.id)} style={{padding:'5px 14px',background:'rgba(224,85,85,.1)',border:'1px solid rgba(224,85,85,.3)',color:'var(--danger)',borderRadius:18,cursor:'pointer',fontSize:12}}>Ø­Ø°Ù</button></div>
          </div>
        ))}
      </div>
    </div>
  );
}

function AdminAnn({announcements,saveAnnouncements,showToast}){
  const [items,setItems]=useState(announcements||[]);
  const [text,setText]=useState('');
  const [color,setColor]=useState('gold');
  useEffect(()=>{setItems(announcements||[]);},[announcements]);
  const colorOpts=[{v:'gold',l:'Ø°Ù‡Ø¨ÙŠ'},{v:'red',l:'Ø£Ø­Ù…Ø±'},{v:'green',l:'Ø£Ø®Ø¶Ø±'},{v:'blue',l:'Ø£Ø²Ø±Ù‚'},{v:'dark',l:'Ø¯Ø§ÙƒÙ†'}];
  const add=async()=>{if(!text.trim()){showToast('Ø£Ø¯Ø®Ù„ Ù†Øµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†','error');return;}const u=[...items,{id:Date.now(),text:text.trim(),active:true,color}];setItems(u);await saveAnnouncements(u);setText('');setColor('gold');showToast('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…');};
  const toggle=async id=>{const u=items.map(a=>a.id===id?{...a,active:!a.active}:a);setItems(u);await saveAnnouncements(u);};
  const del=async id=>{const u=items.filter(a=>a.id!==id);setItems(u);await saveAnnouncements(u);showToast('ØªÙ… Ø§Ù„Ø­Ø°Ù');};
  return(
    <div>
      <h2 style={{color:'var(--gold)',fontWeight:900,marginBottom:8}}>ğŸ“¢ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</h2>
      <p style={{color:'var(--muted)',fontSize:13,marginBottom:22}}>ØªØ¸Ù‡Ø± Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø²ÙˆØ§Ø± ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ.</p>
      <div className="card" style={{padding:22,marginBottom:22}}>
        <h3 style={{color:'var(--gold)',fontWeight:800,marginBottom:14}}>+ Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù†</h3>
        <input className="input-field" value={text} onChange={e=>setText(e.target.value)} placeholder="âœ¨ Ø®ØµÙ… 20% Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙŠÙƒ Ø§Ù„ÙŠÙˆÙ…!" style={{marginBottom:14}} onKeyDown={e=>e.key==='Enter'&&add()}/>
        <div style={{display:'flex',gap:8,flexWrap:'wrap',marginBottom:16}}>
          {colorOpts.map(c=><button key={c.v} onClick={()=>setColor(c.v)} style={{padding:'6px 14px',borderRadius:16,border:'2px solid',borderColor:color===c.v?'#fff':'transparent',background:ANN_COLORS[c.v].bg,color:ANN_COLORS[c.v].color,cursor:'pointer',fontWeight:700,fontSize:12,boxShadow:color===c.v?'0 0 0 3px rgba(200,169,110,.4)':'none'}}>{c.l}</button>)}
        </div>
        {text&&<div style={{background:ANN_COLORS[color].bg,color:ANN_COLORS[color].color,padding:'7px 16px',borderRadius:8,fontSize:13,textAlign:'center',marginBottom:14}}>{text}</div>}
        <button className="btn-gold" onClick={add} style={{padding:'9px 22px',fontSize:13}}>+ Ø¥Ø¶Ø§ÙØ©</button>
      </div>
      {items.map(ann=>{const cs=ANN_COLORS[ann.color]||ANN_COLORS.gold;return(
        <div key={ann.id} className="card" style={{padding:16,display:'flex',gap:12,alignItems:'center',marginBottom:10,opacity:ann.active?1:0.5}}>
          <div style={{width:5,height:44,borderRadius:4,background:cs.bg,flexShrink:0}}/>
          <div style={{flex:1}}><div style={{fontWeight:700,fontSize:14}}>{ann.text}</div><div style={{fontSize:12,color:'var(--muted)',marginTop:2}}><span style={{color:ann.active?'var(--success)':'var(--danger)',fontWeight:700}}>{ann.active?'â— Ù…ÙØ¹Ù‘Ù„':'â— Ù…Ø®ÙÙŠ'}</span></div></div>
          <div style={{display:'flex',gap:8}}>
            <button onClick={()=>toggle(ann.id)} style={{padding:'5px 12px',borderRadius:16,border:'1.5px solid',borderColor:ann.active?'var(--success)':'var(--border)',background:ann.active?'rgba(94,201,138,.1)':'transparent',color:ann.active?'var(--success)':'var(--muted)',cursor:'pointer',fontSize:12,fontWeight:700}}>{ann.active?'Ø¥Ø®ÙØ§Ø¡':'Ø¥Ø¸Ù‡Ø§Ø±'}</button>
            <button onClick={()=>del(ann.id)} style={{padding:'5px 12px',borderRadius:16,border:'1px solid rgba(224,85,85,.3)',background:'rgba(224,85,85,.1)',color:'var(--danger)',cursor:'pointer',fontSize:12,fontWeight:700}}>Ø­Ø°Ù</button>
          </div>
        </div>
      );})}
    </div>
  );
}

function AdminNotifs({notifications,markAllRead}){
  return(
    <div>
      <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:22}}>
        <h2 style={{color:'var(--gold)',fontWeight:900}}>ğŸ”” Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ({notifications.length})</h2>
        {notifications.some(n=>!n.read)&&<button className="btn-outline" onClick={markAllRead} style={{fontSize:12,padding:'6px 16px'}}>ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ ÙƒÙ…Ù‚Ø±ÙˆØ¡</button>}
      </div>
      {!notifications.length?<div style={{textAlign:'center',padding:56,color:'var(--muted)'}}><div style={{fontSize:44,marginBottom:14}}>ğŸ”•</div><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¨Ø¹Ø¯ â€” Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø¹Ù†Ø¯ Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</p></div>
      :notifications.map(n=>(
        <div key={n.id} className="card" style={{padding:16,marginBottom:10,display:'flex',gap:12,alignItems:'flex-start',background:n.read?'var(--bg2)':'rgba(200,169,110,.05)',borderColor:n.read?'var(--border)':'var(--border2)'}}>
          <span style={{fontSize:22,flexShrink:0}}>ğŸ›’</span>
          <div style={{flex:1}}><div style={{fontSize:14,lineHeight:1.6}}>{n.text}</div><div style={{fontSize:11,color:'var(--muted)',marginTop:3}}>{new Date(n.created_at).toLocaleString('ar-KW')}</div></div>
          {!n.read&&<div style={{width:9,height:9,borderRadius:'50%',background:'var(--gold)',flexShrink:0,marginTop:5}}/>}
        </div>
      ))}
    </div>
  );
}

function AdminUsers({users,orders}){
  return(
    <div>
      <h2 style={{color:'var(--gold)',fontWeight:900,marginBottom:22}}>ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ({users.filter(u=>u.role==='customer').length})</h2>
      {users.filter(u=>u.role==='customer').map(u=>{
        const uO=orders.filter(o=>o.customer_email===u.email);
        const spent=uO.reduce((s,o)=>s+o.total,0);
        return(
          <div key={u.id} className="card" style={{padding:16,marginBottom:10,display:'flex',justifyContent:'space-between',alignItems:'center'}}>
            <div style={{display:'flex',gap:12,alignItems:'center'}}>
              <div style={{width:42,height:42,borderRadius:'50%',background:'linear-gradient(135deg,var(--gold),var(--gold-light))',display:'flex',alignItems:'center',justifyContent:'center',fontSize:16,color:'#0f0f1a',fontWeight:900}}>{u.name[0]}</div>
              <div><div style={{fontWeight:800,fontSize:14}}>{u.name}</div><div style={{color:'var(--muted)',fontSize:12}}>{u.email} â€¢ {u.phone}</div></div>
            </div>
            <div style={{textAlign:'left'}}><div style={{color:'var(--gold)',fontWeight:800,fontSize:15}}>{kwd(spent)}</div><div style={{color:'var(--muted)',fontSize:12}}>{uO.length} Ø·Ù„Ø¨Ø§Øª</div></div>
          </div>
        );
      })}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
