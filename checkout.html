<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ - Gift Star</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/style.css">
</head>
<body>
<header class="site-header">
  <div class="header-top">
    <div class="container">
      <span class="header-tagline">ØªÙˆØµÙŠÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙˆÙŠØª ÙÙ‚Ø·</span>
      <div class="header-links">
        <a href="cart.html" class="cart-link">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="9" cy="21" r="1"/>
            <circle cx="20" cy="21" r="1"/>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
          </svg>
          <span class="cart-count" id="cartCount">0</span>
        </a>
        <a href="login.html" class="btn-login" id="loginBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
        <a href="#" class="btn-login" id="logoutBtn" style="display:none" onclick="logout()">Ø®Ø±ÙˆØ¬</a>
      </div>
    </div>
  </div>
  <div class="header-main">
    <div class="container header-flex">
      <a href="index.html" class="logo">
        <div class="logo-star">â˜…</div>
        <div class="logo-text">
          <span class="logo-gift">Gift</span>
          <span class="logo-star-word">Star</span>
        </div>
      </a>
      <nav class="main-nav">
        <a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <a href="shop.html">Ø§Ù„Ù…ØªØ¬Ø±</a>
      </nav>
    </div>
  </div>
</header>

<div class="container checkout-page">
  <div class="checkout-grid">
    <!-- Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠÙ…Ù† - Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„ ÙˆØ§Ù„Ø¯ÙØ¹ -->
    <div>
      <div class="checkout-section">
        <h3>ğŸ“ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</h3>
        
        <div class="form-group">
          <label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ <span style="color: var(--danger);">*</span></label>
          <input type="text" id="delivName" class="form-input" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…" required>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <div class="form-group">
            <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ <span style="color: var(--danger);">*</span></label>
            <input type="tel" id="delivPhone" class="form-input" placeholder="5xxxxxxx" dir="ltr" maxlength="8" required>
            <small style="color: var(--text-muted); font-size: 12px;">8 Ø£Ø±Ù‚Ø§Ù… ØªØ¨Ø¯Ø£ Ø¨Ù€ 5 Ø£Ùˆ 6 Ø£Ùˆ 9</small>
          </div>
          
          <div class="form-group">
            <label class="form-label">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© <span style="color: var(--danger);">*</span></label>
            <select id="delivArea" class="form-select" required>
              <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</option>
              <option value="Ø§Ù„Ø¹Ø§ØµÙ…Ø©">Ø§Ù„Ø¹Ø§ØµÙ…Ø©</option>
              <option value="Ø­ÙˆÙ„ÙŠ">Ø­ÙˆÙ„ÙŠ</option>
              <option value="Ø§Ù„ÙØ±ÙˆØ§Ù†ÙŠØ©">Ø§Ù„ÙØ±ÙˆØ§Ù†ÙŠØ©</option>
              <option value="Ù…Ø¨Ø§Ø±Ùƒ Ø§Ù„ÙƒØ¨ÙŠØ±">Ù…Ø¨Ø§Ø±Ùƒ Ø§Ù„ÙƒØ¨ÙŠØ±</option>
              <option value="Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠ">Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠ</option>
              <option value="Ø§Ù„Ø¬Ù‡Ø±Ø§Ø¡">Ø§Ù„Ø¬Ù‡Ø±Ø§Ø¡</option>
            </select>
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ <span style="color: var(--danger);">*</span></label>
          <textarea id="delivAddress" class="form-textarea" rows="2" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø±Ø¹ØŒ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰ØŒ Ø±Ù‚Ù… Ø§Ù„Ø´Ù‚Ø©..." required></textarea>
        </div>
        
        <div class="form-group">
          <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <textarea id="delivNotes" class="form-textarea" rows="2" placeholder="Ø£ÙŠ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø®Ø§ØµØ© Ù„Ù„Ù…Ù†Ø¯ÙˆØ¨..."></textarea>
        </div>
      </div>

      <div class="checkout-section">
        <h3>ğŸ’³ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</h3>
        
        <div class="payment-methods" id="paymentMethods">
          <!-- Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ù‡Ù†Ø§ -->
        </div>

        <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†ÙŠØ© -->
        <div class="payment-form" id="cardForm" style="display:none; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
          <div class="form-group">
            <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</label>
            <input type="text" id="cardNum" class="form-input" placeholder="xxxx xxxx xxxx xxxx" maxlength="19" dir="ltr" oninput="formatCard(this)">
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div class="form-group">
              <label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label>
              <input type="text" id="cardExp" class="form-input" placeholder="MM/YY" maxlength="5" dir="ltr" oninput="formatExp(this)">
            </div>
            <div class="form-group">
              <label class="form-label">CVV</label>
              <input type="text" id="cardCvv" class="form-input" placeholder="â€¢â€¢â€¢" maxlength="3" dir="ltr">
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Ø§Ø³Ù… Ø­Ø§Ù…Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</label>
            <input type="text" id="cardName" class="form-input" placeholder="Ø§Ù„Ø§Ø³Ù… ÙƒÙ…Ø§ Ù‡Ùˆ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©" dir="ltr">
          </div>
        </div>

        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ù†ÙƒÙŠ -->
        <div id="bankInfo" style="display:none; margin-top: 20px; padding: 20px; background: var(--secondary); border-radius: var(--radius);">
          <h4 style="color: var(--primary); margin-bottom: 10px;">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ù†ÙƒÙŠ:</h4>
          <p style="margin: 8px 0;"><strong>IBAN:</strong> KW91NBOK0000000000001000372151</p>
          <p style="margin: 8px 0;"><strong>Ø§Ù„Ø¨Ù†Ùƒ:</strong> Ø¨Ù†Ùƒ Ø§Ù„ÙƒÙˆÙŠØª Ø§Ù„ÙˆØ·Ù†ÙŠ</p>
          <p style="margin: 8px 0;"><strong>Ø§Ù„Ù…Ø³ØªÙÙŠØ¯:</strong> Ø´Ø±ÙƒØ© Ø¬ÙØª Ø³ØªØ§Ø±</p>
          <div style="margin-top: 15px; padding: 10px; background: rgba(243,156,18,0.1); border-radius: 8px; color: #f39c12;">
            âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„
          </div>
        </div>

        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙØ¹ Ù†Ù‚Ø¯Ø§Ù‹ -->
        <div id="cashInfo" style="display:none; margin-top: 20px; padding: 20px; background: rgba(200,169,110,0.1); border-radius: var(--radius);">
          <p>ğŸ“¦ Ø³ÙŠØªÙ… Ø§Ù„Ø¯ÙØ¹ Ù†Ù‚Ø¯Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</p>
          <p style="font-size: 13px; color: var(--text-muted); margin-top: 5px;">ÙŠØ±Ø¬Ù‰ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</p>
        </div>
      </div>

      <button class="btn-primary" style="width: 100%; padding: 18px; font-size: 18px; margin: 20px 0;" onclick="placeOrder()" id="placeOrderBtn">
        <span>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</span>
        <span style="background: rgba(0,0,0,0.2); padding: 5px 15px; border-radius: 30px; margin-right: 10px;" id="btnTotal"></span>
      </button>

      <p style="text-align: center; font-size: 13px; color: var(--text-muted);">
        Ø¨Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ "Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨" ÙØ¥Ù†Ùƒ ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ 
        <a href="#" style="color: var(--primary);">Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</a> Ùˆ <a href="#" style="color: var(--primary);">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a>
      </p>
    </div>

    <!-- Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠØ³Ø± - Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨ -->
    <div>
      <div class="checkout-section">
        <h3>ğŸ›’ Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨</h3>
        
        <div id="orderItems" style="max-height: 300px; overflow-y: auto; margin-bottom: 20px;"></div>
        
        <div style="background: var(--secondary); padding: 15px; border-radius: var(--radius);">
          <div style="display: flex; justify-content: space-between; padding: 8px 0; color: var(--text-muted);">
            <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ</span>
            <span id="chkSubtotal">0.000 Ø¯.Ùƒ</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 8px 0; color: var(--text-muted);">
            <span>Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</span>
            <span id="chkDelivery">1.500 Ø¯.Ùƒ</span>
          </div>
          <div id="discountRow" style="display: none; justify-content: space-between; padding: 8px 0; color: var(--success);">
            <span>Ø®ØµÙ…</span>
            <span id="chkDiscount">-0.000 Ø¯.Ùƒ</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 15px 0 0; margin-top: 10px; border-top: 2px solid var(--border); font-size: 18px; font-weight: 700;">
            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</span>
            <span style="color: var(--primary); font-size: 20px;" id="chkTotal">0.000 Ø¯.Ùƒ</span>
          </div>
        </div>

        <!-- ÙƒÙˆØ¯ Ø®ØµÙ… -->
        <div style="display: flex; gap: 10px; margin: 20px 0;">
          <input type="text" id="promoCode" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…" style="flex: 1;">
          <button class="btn-outline" style="padding: 10px 20px;" onclick="applyPromo()">ØªØ·Ø¨ÙŠÙ‚</button>
        </div>

        <!-- Ø¶Ù…Ø§Ù†Ø§Øª -->
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
          <div style="display: flex; align-items: center; gap: 5px; font-size: 12px; color: var(--text-muted);">
            <span style="color: var(--success); font-weight: 700;">âœ“</span>
            <span>Ø¯ÙØ¹ Ø¢Ù…Ù†</span>
          </div>
          <div style="display: flex; align-items: center; gap: 5px; font-size: 12px; color: var(--text-muted);">
            <span style="color: var(--success); font-weight: 700;">âœ“</span>
            <span>ØªÙˆØµÙŠÙ„ Ø³Ø±ÙŠØ¹</span>
          </div>
          <div style="display: flex; align-items: center; gap: 5px; font-size: 12px; color: var(--text-muted);">
            <span style="color: var(--success); font-weight: 700;">âœ“</span>
            <span>Ø¬ÙˆØ¯Ø© Ù…Ø¶Ù…ÙˆÙ†Ø©</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ -->
<div class="modal-overlay" id="confirmModal" style="display: none;">
  <div class="modal-card">
    <div class="modal-header">
      <h3>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</h3>
      <button class="modal-close" onclick="closeConfirmModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <p>Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ØŸ</p>
      <div id="confirmDetails" style="margin-top: 20px; padding: 15px; background: var(--secondary); border-radius: var(--radius);"></div>
    </div>
    <div class="modal-footer">
      <button class="btn-outline" onclick="closeConfirmModal()">Ø¥Ù„ØºØ§Ø¡</button>
      <button class="btn-primary" onclick="processOrder()">ØªØ£ÙƒÙŠØ¯ ÙˆØ¥ØªÙ…Ø§Ù…</button>
    </div>
  </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ù†Ø¬Ø§Ø­ Ø§Ù„Ø·Ù„Ø¨ -->
<div class="modal-overlay" id="successModal" style="display: none;">
  <div class="modal-card" style="max-width: 400px;">
    <div class="modal-body" style="text-align: center; padding: 40px;">
      <div style="width: 80px; height: 80px; background: var(--success); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 40px; margin: 0 auto; animation: scaleIn 0.5s ease;">âœ“</div>
      <h3 style="color: var(--success); margin: 20px 0;">ØªÙ… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!</h3>
      <p style="color: var(--text-muted);">Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</p>
      <div style="margin-top: 30px;">
        <a href="receipt.html" class="btn-primary">Ø¹Ø±Ø¶ Ø§Ù„Ø¥ÙŠØµØ§Ù„</a>
        <a href="index.html" class="btn-outline" style="margin-right: 10px;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      </div>
    </div>
  </div>
</div>

<footer class="site-footer">
  <div class="footer-bottom">
    <p>Â© 2024 Gift Star. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© - Ø§Ù„ÙƒÙˆÙŠØª</p>
  </div>
</footer>

<div class="stars-bg"></div>

<script src="js/data.js"></script>
<script>
let selectedPayment = null;
let paymentMethods = [];
let appliedPromo = null;
let orderTotal = 0;

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
async function init() {
  console.log('Checkout page initializing...');
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  const user = typeof giftstar !== 'undefined' && giftstar.getCurrentUser ? 
               giftstar.getCurrentUser() : getCurrentUserLocal();
  
  if (!user) { 
    sessionStorage.setItem('giftstar_redirect_after_login', 'checkout.html');
    window.location.href = 'login.html?msg=login_required'; 
    return; 
  }

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø³Ù„Ø©
  const cart = getCartLocal();
  console.log('Cart:', cart);
  
  if (!cart || !cart.length) { 
    window.location.href = 'cart.html'; 
    return; 
  }

  // ØªØ¹Ø¨Ø¦Ø© Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  const nameInput = document.getElementById('delivName');
  if (nameInput && user.name) {
    nameInput.value = user.name || '';
  }
  
  // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ù„Ø©
  updateCartCountLocal();
  
  // Ø­Ø³Ø§Ø¨ ÙˆØ¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨
  calculateOrderTotal();
  
  // ØªØ­Ù…ÙŠÙ„ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹
  await loadPaymentMethods();
}

// Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨
function calculateOrderTotal() {
  try {
    const cart = getCartLocal();
    const subtotal = cart.reduce((sum, item) => sum + ((item.price || 0) * (item.qty || 0)), 0);
    const delivery = subtotal > 15 ? 0 : 1.500;
    
    let discount = 0;
    if (appliedPromo) {
      discount = subtotal * 0.1; // 10% Ø®ØµÙ…
    }
    
    orderTotal = subtotal + delivery - discount;

    // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    const orderItemsEl = document.getElementById('orderItems');
    if (orderItemsEl) {
      orderItemsEl.innerHTML = cart.map(item => `
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid var(--border);">
          <div style="display: flex; align-items: center; gap: 10px;">
            <img src="${item.image || 'https://images.unsplash.com/photo-1549465220-1a8b9238cd48?w=50&h=50&fit=crop'}" 
                 alt="${item.name || 'Ù…Ù†ØªØ¬'}" 
                 style="width: 50px; height: 50px; border-radius: 8px; object-fit: cover;" 
                 onerror="this.src='https://images.unsplash.com/photo-1549465220-1a8b9238cd48?w=50&h=50&fit=crop'">
            <div>
              <div style="font-weight: 600; color: var(--text);">${item.name || 'Ù…Ù†ØªØ¬'}</div>
              <div style="font-size: 12px; color: var(--text-muted);">Ø§Ù„ÙƒÙ…ÙŠØ©: ${item.qty || 1}</div>
            </div>
          </div>
          <div style="font-weight: 700; color: var(--primary);">${formatKWD((item.price || 0) * (item.qty || 1))}</div>
        </div>
      `).join('');
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª
    const subtotalEl = document.getElementById('chkSubtotal');
    const deliveryEl = document.getElementById('chkDelivery');
    const totalEl = document.getElementById('chkTotal');
    const btnTotalEl = document.getElementById('btnTotal');
    
    if (subtotalEl) subtotalEl.textContent = formatKWD(subtotal);
    if (deliveryEl) deliveryEl.textContent = delivery === 0 ? 'Ù…Ø¬Ø§Ù†ÙŠ' : formatKWD(delivery);
    if (totalEl) totalEl.textContent = formatKWD(orderTotal);
    if (btnTotalEl) btnTotalEl.textContent = formatKWD(orderTotal);
    
    const discountRow = document.getElementById('discountRow');
    const discountEl = document.getElementById('chkDiscount');
    
    if (discount > 0) {
      if (discountRow) discountRow.style.display = 'flex';
      if (discountEl) discountEl.textContent = '-' + formatKWD(discount);
    } else {
      if (discountRow) discountRow.style.display = 'none';
    }
  } catch (e) {
    console.error('Error calculating order total:', e);
  }
}

// ØªØ­Ù…ÙŠÙ„ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹
async function loadPaymentMethods() {
  console.log('Loading payment methods...');
  
  const paymentMethodsEl = document.getElementById('paymentMethods');
  if (!paymentMethodsEl) return;
  
  try {
    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ù…Ù† giftstar
    if (typeof giftstar !== 'undefined' && giftstar.getData) {
      paymentMethods = await giftstar.getData('payment_methods', []);
    } else {
      // Fallback Ù„Ø¬Ù„Ø¨ Ù…Ù† localStorage Ù…Ø¨Ø§Ø´Ø±Ø©
      const data = localStorage.getItem('giftstar_payment_methods');
      paymentMethods = data ? JSON.parse(data) : [];
    }
    
    console.log('Payment methods loaded:', paymentMethods);
    
    // Ø¥Ø°Ø§ Ù…Ø§ ÙÙŠ Ø·Ø±Ù‚ Ø¯ÙØ¹ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    if (!paymentMethods || paymentMethods.length === 0) {
      paymentMethods = [
        { id: 1, name: "Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†ÙŠØ©", description: "Visa, Mastercard", icon: "card", active: true },
        { id: 3, name: "ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ", description: "ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ Ù…Ø¨Ø§Ø´Ø±", icon: "bank", active: true },
        { id: 4, name: "Ù†Ù‚Ø¯Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…", description: "Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…", icon: "cash", active: true }
      ];
    }
    
    // ØªØµÙÙŠØ© Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„Ù†Ø´Ø·Ø© ÙÙ‚Ø·
    paymentMethods = paymentMethods.filter(m => m.active !== false);
    
    // Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹
    const icons = {
      card: `<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>`,
      bank: `<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 22V12M7 22V12M11 22V12M15 22V12M19 22V12M1 12l11-9 11 9"/></svg>`,
      cash: `<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>`,
      knet: `<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="5" width="20" height="14" rx="2"/><path d="M2 10h20"/></svg>`
    };

    // Ø¹Ø±Ø¶ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹
    paymentMethodsEl.innerHTML = paymentMethods.map(m => `
      <div class="payment-method" onclick="selectPayment('${m.icon || 'cash'}', this, ${m.id})" id="pm_${m.id}" style="cursor: pointer; display: flex; align-items: center; gap: 15px; padding: 15px; border: 2px solid var(--border); border-radius: var(--radius); margin-bottom: 10px; transition: var(--transition);">
        <input type="radio" name="payment" value="${m.id}" style="width: 20px; height: 20px; accent-color: var(--primary);">
        <div class="payment-icon" style="color: var(--primary);">${icons[m.icon] || icons.cash}</div>
        <div class="payment-method-label" style="flex: 1;">
          <strong style="display: block; color: var(--text);">${m.name || 'Ø·Ø±ÙŠÙ‚Ø© Ø¯ÙØ¹'}</strong>
          <span style="font-size: 13px; color: var(--text-muted);">${m.description || ''}</span>
        </div>
      </div>
    `).join('');

    // Ø§Ø®ØªÙŠØ§Ø± Ø£ÙˆÙ„ Ø·Ø±ÙŠÙ‚Ø© Ø¯ÙØ¹ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
    if (paymentMethods.length > 0) {
      const firstMethod = document.getElementById('pm_' + paymentMethods[0].id);
      if (firstMethod) {
        selectPayment(paymentMethods[0].icon || 'cash', firstMethod, paymentMethods[0].id);
      }
    }
    
  } catch (error) {
    console.error('Error loading payment methods:', error);
    paymentMethodsEl.innerHTML = '<div class="error-message" style="color: var(--danger); padding: 20px; text-align: center;">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹</div>';
  }
}

// Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
function selectPayment(icon, el, id) {
  console.log('Selected payment:', id, icon);
  
  selectedPayment = id;
  
  // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ø±Ù‚
  document.querySelectorAll('.payment-method').forEach(m => {
    m.classList.remove('selected');
    m.style.borderColor = 'var(--border)';
    m.style.background = 'none';
    const radio = m.querySelector('input[type="radio"]');
    if (radio) radio.checked = false;
  });
  
  // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
  if (el) {
    el.classList.add('selected');
    el.style.borderColor = 'var(--primary)';
    el.style.background = 'linear-gradient(135deg, rgba(200,169,110,0.1), rgba(226,201,142,0.1))';
    const radio = el.querySelector('input[type="radio"]');
    if (radio) radio.checked = true;
  }

  // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
  const cardForm = document.getElementById('cardForm');
  const bankInfo = document.getElementById('bankInfo');
  const cashInfo = document.getElementById('cashInfo');
  
  if (cardForm) cardForm.style.display = icon === 'card' ? 'block' : 'none';
  if (bankInfo) bankInfo.style.display = icon === 'bank' ? 'block' : 'none';
  if (cashInfo) cashInfo.style.display = icon === 'cash' ? 'block' : 'none';
}

// ØªÙ†Ø³ÙŠÙ‚ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
function formatCard(input) {
  let v = input.value.replace(/\D/g, '').substring(0, 16);
  input.value = v.replace(/(.{4})/g, '$1 ').trim();
}

// ØªÙ†Ø³ÙŠÙ‚ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
function formatExp(input) {
  let v = input.value.replace(/\D/g, '');
  if (v.length >= 2) v = v.substring(0, 2) + '/' + v.substring(2, 4);
  input.value = v;
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
function validateForm() {
  const name = document.getElementById('delivName')?.value.trim();
  const phone = document.getElementById('delivPhone')?.value.trim();
  const area = document.getElementById('delivArea')?.value;
  const address = document.getElementById('delivAddress')?.value.trim();

  if (!name) { 
    if (typeof giftstar !== 'undefined' && giftstar.showNotification) {
      giftstar.showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…', 'error');
    } else {
      alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…');
    }
    return false; 
  }
  
  if (!phone) { 
    if (typeof giftstar !== 'undefined' && giftstar.showNotification) {
      giftstar.showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ', 'error');
    } else {
      alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ');
    }
    return false; 
  }
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„ÙƒÙˆÙŠØªÙŠ (8 Ø£Ø±Ù‚Ø§Ù… ØªØ¨Ø¯Ø£ Ø¨Ù€ 5 Ø£Ùˆ 6 Ø£Ùˆ 9)
  if (phone.length !== 8 || !/^[569]\d{7}$/.test(phone)) {
    const msg = 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 8 Ø£Ø±Ù‚Ø§Ù… ÙˆÙŠØ¨Ø¯Ø£ Ø¨Ù€ 5 Ø£Ùˆ 6 Ø£Ùˆ 9';
    if (typeof giftstar !== 'undefined' && giftstar.showNotification) {
      giftstar.showNotification(msg, 'error');
    } else {
      alert(msg);
    }
    return false;
  }
  
  if (!area) { 
    if (typeof giftstar !== 'undefined' && giftstar.showNotification) {
      giftstar.showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©', 'error');
    } else {
      alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©');
    }
    return false; 
  }
  
  if (!address) { 
    if (typeof giftstar !== 'undefined' && giftstar.showNotification) {
      giftstar.showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', 'error');
    } else {
      alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†');
    }
    return false; 
  }
  
  if (!selectedPayment) { 
    if (typeof giftstar !== 'undefined' && giftstar.showNotification) {
      giftstar.showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹', 'error');
    } else {
      alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹');
    }
    return false; 
  }

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¥Ø°Ø§ ØªÙ… Ø§Ø®ØªÙŠØ§Ø±Ù‡Ø§
  const method = paymentMethods.find(m => m.id === selectedPayment);
  if (method && method.icon === 'card') {
    const cardNum = document.getElementById('cardNum')?.value.replace(/\s/g, '') || '';
    const cardExp = document.getElementById('cardExp')?.value || '';
    const cardCvv = document.getElementById('cardCvv')?.value || '';
    const cardName = document.getElementById('cardName')?.value.trim() || '';
    
    if (cardNum.length !== 16) {
      if (typeof giftstar !== 'undefined' && giftstar.showNotification) {
        giftstar.showNotification('Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
      } else {
        alert('Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ØºÙŠØ± ØµØ­ÙŠØ­');
      }
      return false;
    }
    
    if (!cardExp || !cardExp.includes('/')) {
      if (typeof giftstar !== 'undefined' && giftstar.showNotification) {
        giftstar.showNotification('ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
      } else {
        alert('ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ ØºÙŠØ± ØµØ­ÙŠØ­');
      }
      return false;
    }
    
    if (cardCvv.length !== 3) {
      if (typeof giftstar !== 'undefined' && giftstar.showNotification) {
        giftstar.showNotification('Ø±Ù…Ø² CVV ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
      } else {
        alert('Ø±Ù…Ø² CVV ØºÙŠØ± ØµØ­ÙŠØ­');
      }
      return false;
    }
    
    if (!cardName) {
      if (typeof giftstar !== 'undefined' && giftstar.showNotification) {
        giftstar.showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø­Ø§Ù…Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©', 'error');
      } else {
        alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø­Ø§Ù…Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©');
      }
      return false;
    }
  }

  return true;
}

// Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨
function placeOrder() {
  if (!validateForm()) return;
  
  const method = paymentMethods.find(m => m.id === selectedPayment);
  const confirmDetails = document.getElementById('confirmDetails');
  
  if (confirmDetails) {
    confirmDetails.innerHTML = `
      <p><strong>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</strong> ${method?.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
      <p><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong> ${formatKWD(orderTotal)}</p>
    `;
  }
  
  const confirmModal = document.getElementById('confirmModal');
  if (confirmModal) {
    confirmModal.style.display = 'flex';
  }
}

function closeConfirmModal() {
  const confirmModal = document.getElementById('confirmModal');
  if (confirmModal) {
    confirmModal.style.display = 'none';
  }
}

async function processOrder() {
  closeConfirmModal();
  
  const btn = document.getElementById('placeOrderBtn');
  const originalText = btn ? btn.innerHTML : '';
  
  if (btn) {
    btn.innerHTML = '<div class="spinner" style="width: 20px; height: 20px; display: inline-block; margin-left: 8px;"></div> Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨...';
    btn.disabled = true;
  }

  try {
    const name = document.getElementById('delivName')?.value.trim() || '';
    const phone = document.getElementById('delivPhone')?.value.trim() || '';
    const area = document.getElementById('delivArea')?.value || '';
    const address = document.getElementById('delivAddress')?.value.trim() || '';
    const notes = document.getElementById('delivNotes')?.value.trim() || '';
    
    const user = typeof giftstar !== 'undefined' && giftstar.getCurrentUser ? 
                 giftstar.getCurrentUser() : getCurrentUserLocal();
    
    const cart = getCartLocal();
    const subtotal = cart.reduce((sum, item) => sum + ((item.price || 0) * (item.qty || 0)), 0);
    const delivery = subtotal > 15 ? 0 : 1.500;
    const method = paymentMethods.find(m => m.id === selectedPayment);
    
    const orderData = {
      customer: { name, phone, area, address, notes },
      items: cart,
      subtotal: subtotal,
      delivery: delivery,
      total: orderTotal,
      paymentMethod: method ? method.name : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
      paymentIcon: method ? method.icon : 'cash',
      userId: user ? user.id : null,
      userEmail: user ? user.email : null,
      status: 'new'
    };
    
    console.log('Creating order:', orderData);
    
    let order;
    
    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… giftstar
    if (typeof giftstar !== 'undefined' && giftstar.createOrder) {
      order = await giftstar.createOrder(orderData);
    } else {
      // Fallback Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ù…Ø­Ù„ÙŠØ§Ù‹
      order = createOrderLocal(orderData);
    }
    
    console.log('Order created:', order);
    
    // ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©
    clearCartLocal();
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
    const successModal = document.getElementById('successModal');
    if (successModal) {
      successModal.style.display = 'flex';
    }
    
  } catch (error) {
    console.error('Error placing order:', error);
    
    if (typeof giftstar !== 'undefined' && giftstar.showNotification) {
      giftstar.showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨', 'error');
    } else {
      alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨');
    }
    
    if (btn) {
      btn.innerHTML = originalText;
      btn.disabled = false;
    }
  }
}

// Ø¯ÙˆØ§Ù„ Ù…Ø­Ù„ÙŠØ© Ù„Ù„ØªØ®Ø²ÙŠÙ† (Fallback)
function getCurrentUserLocal() {
  try {
    return JSON.parse(sessionStorage.getItem('giftstar_user'));
  } catch { return null; }
}

function getCartLocal() {
  try {
    const user = getCurrentUserLocal();
    if (user) {
      const cart = localStorage.getItem('giftstar_cart_' + user.id);
      return cart ? JSON.parse(cart) : [];
    }
    return JSON.parse(localStorage.getItem('giftstar_cart') || '[]');
  } catch {
    return [];
  }
}

function clearCartLocal() {
  try {
    const user = getCurrentUserLocal();
    if (user) {
      localStorage.removeItem('giftstar_cart_' + user.id);
    } else {
      localStorage.removeItem('giftstar_cart');
    }
    updateCartCountLocal();
  } catch (e) {
    console.error('Error clearing cart:', e);
  }
}

function updateCartCountLocal() {
  try {
    const cart = getCartLocal();
    const total = cart.reduce((sum, item) => sum + (item.qty || 0), 0);
    document.querySelectorAll('.cart-count, #cartCount').forEach(el => {
      if (el) el.textContent = total;
    });
  } catch (e) {
    console.error('Error updating cart count:', e);
  }
}

function createOrderLocal(orderData) {
  const orders = JSON.parse(localStorage.getItem('giftstar_orders') || '[]');
  
  const order = {
    id: 'GS' + Date.now() + Math.floor(Math.random() * 1000),
    ...orderData,
    date: new Date().toLocaleDateString('ar-KW'),
    time: new Date().toLocaleTimeString('ar-KW'),
    lastUpdate: new Date().toISOString()
  };
  
  orders.unshift(order);
  localStorage.setItem('giftstar_orders', JSON.stringify(orders));
  sessionStorage.setItem('giftstar_last_order', JSON.stringify(order));
  localStorage.setItem('giftstar_last_order', JSON.stringify(order));
  
  return order;
}

// ØªØ·Ø¨ÙŠÙ‚ ÙƒÙˆØ¯ Ø®ØµÙ…
function applyPromo() {
  const code = document.getElementById('promoCode')?.value.trim() || '';
  
  if (code === 'GIFT10' || code === 'STAR20') {
    appliedPromo = code;
    calculateOrderTotal();
    
    if (typeof giftstar !== 'undefined' && giftstar.showNotification) {
      giftstar.showNotification('ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ… Ø¨Ù†Ø¬Ø§Ø­', 'success');
    } else {
      alert('ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ… Ø¨Ù†Ø¬Ø§Ø­');
    }
  } else {
    if (typeof giftstar !== 'undefined' && giftstar.showNotification) {
      giftstar.showNotification('ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ… ØºÙŠØ± ØµØ§Ù„Ø­', 'error');
    } else {
      alert('ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ… ØºÙŠØ± ØµØ§Ù„Ø­');
    }
  }
}

// ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„Ø©
function formatKWD(amount) {
  try {
    return Number(amount || 0).toFixed(3) + ' Ø¯.Ùƒ';
  } catch {
    return '0.000 Ø¯.Ùƒ';
  }
}

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
function logout() {
  if (typeof giftstar !== 'undefined' && giftstar.logout) {
    giftstar.logout();
  } else {
    sessionStorage.removeItem('giftstar_user');
    window.location.href = 'index.html';
  }
}

// Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
document.addEventListener('DOMContentLoaded', init);

// Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù€ animation
const style = document.createElement('style');
style.textContent = `
  @keyframes scaleIn {
    from { transform: scale(0); }
    to { transform: scale(1); }
  }
`;
document.head.appendChild(style);
</script>
</body>
</html>
