<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ - Gift Star</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/style.css">
</head>
<body>
<header class="site-header">
  <div class="header-top">
    <div class="container">
      <span class="header-tagline">ØªÙˆØµÙŠÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙˆÙŠØª ÙÙ‚Ø·</span>
      <div class="header-links">
        <a href="cart.html" class="cart-link">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="9" cy="21" r="1"/>
            <circle cx="20" cy="21" r="1"/>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
          </svg>
          <span class="cart-count" id="cartCount">0</span>
        </a>
        <a href="login.html" class="btn-login" id="loginBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
        <a href="#" class="btn-login" id="logoutBtn" style="display:none" onclick="logout()">Ø®Ø±ÙˆØ¬</a>
      </div>
    </div>
  </div>
  <div class="header-main">
    <div class="container header-flex">
      <a href="index.html" class="logo">
        <div class="logo-star">â˜…</div>
        <div class="logo-text">
          <span class="logo-gift">Gift</span>
          <span class="logo-star-word">Star</span>
        </div>
      </a>
      <nav class="main-nav">
        <a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <a href="shop.html">Ø§Ù„Ù…ØªØ¬Ø±</a>
      </nav>
    </div>
  </div>
</header>

<div class="container checkout-page">
  <div class="checkout-grid">
    <!-- Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠÙ…Ù† - Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„ ÙˆØ§Ù„Ø¯ÙØ¹ -->
    <div>
      <div class="checkout-section">
        <h3>ğŸ“ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</h3>
        
        <div class="form-group">
          <label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ <span style="color: var(--danger);">*</span></label>
          <input type="text" id="delivName" class="form-input" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…" required>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <div class="form-group">
            <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ <span style="color: var(--danger);">*</span></label>
            <input type="tel" id="delivPhone" class="form-input" placeholder="5xxxxxxx" dir="ltr" maxlength="8" required>
            <small style="color: var(--text-muted); font-size: 12px;">8 Ø£Ø±Ù‚Ø§Ù… ØªØ¨Ø¯Ø£ Ø¨Ù€ 5 Ø£Ùˆ 6 Ø£Ùˆ 9</small>
          </div>
          
          <div class="form-group">
            <label class="form-label">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© <span style="color: var(--danger);">*</span></label>
            <select id="delivArea" class="form-select" required>
              <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</option>
              <option value="Ø§Ù„Ø¹Ø§ØµÙ…Ø©">Ø§Ù„Ø¹Ø§ØµÙ…Ø©</option>
              <option value="Ø­ÙˆÙ„ÙŠ">Ø­ÙˆÙ„ÙŠ</option>
              <option value="Ø§Ù„ÙØ±ÙˆØ§Ù†ÙŠØ©">Ø§Ù„ÙØ±ÙˆØ§Ù†ÙŠØ©</option>
              <option value="Ù…Ø¨Ø§Ø±Ùƒ Ø§Ù„ÙƒØ¨ÙŠØ±">Ù…Ø¨Ø§Ø±Ùƒ Ø§Ù„ÙƒØ¨ÙŠØ±</option>
              <option value="Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠ">Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠ</option>
              <option value="Ø§Ù„Ø¬Ù‡Ø±Ø§Ø¡">Ø§Ù„Ø¬Ù‡Ø±Ø§Ø¡</option>
            </select>
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ <span style="color: var(--danger);">*</span></label>
          <textarea id="delivAddress" class="form-textarea" rows="2" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø±Ø¹ØŒ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰ØŒ Ø±Ù‚Ù… Ø§Ù„Ø´Ù‚Ø©..." required></textarea>
        </div>
        
        <div class="form-group">
          <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <textarea id="delivNotes" class="form-textarea" rows="2" placeholder="Ø£ÙŠ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø®Ø§ØµØ© Ù„Ù„Ù…Ù†Ø¯ÙˆØ¨..."></textarea>
        </div>
      </div>

      <div class="checkout-section">
        <h3>ğŸ’³ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</h3>
        
        <div class="payment-methods" id="paymentMethods">
          <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ø®Ù„Ø§Ù„ JavaScript -->
        </div>

        <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†ÙŠØ© -->
        <div class="payment-form" id="cardForm" style="display:none; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
          <div class="form-group">
            <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</label>
            <input type="text" id="cardNum" class="form-input" placeholder="xxxx xxxx xxxx xxxx" maxlength="19" dir="ltr" oninput="formatCard(this)">
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div class="form-group">
              <label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label>
              <input type="text" id="cardExp" class="form-input" placeholder="MM/YY" maxlength="5" dir="ltr" oninput="formatExp(this)">
            </div>
            <div class="form-group">
              <label class="form-label">CVV</label>
              <input type="text" id="cardCvv" class="form-input" placeholder="â€¢â€¢â€¢" maxlength="3" dir="ltr">
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Ø§Ø³Ù… Ø­Ø§Ù…Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</label>
            <input type="text" id="cardName" class="form-input" placeholder="Ø§Ù„Ø§Ø³Ù… ÙƒÙ…Ø§ Ù‡Ùˆ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©" dir="ltr">
          </div>
        </div>

        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ù†ÙƒÙŠ -->
        <div id="bankInfo" style="display:none; margin-top: 20px; padding: 20px; background: var(--secondary); border-radius: var(--radius);">
          <h4 style="color: var(--primary); margin-bottom: 10px;">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ù†ÙƒÙŠ:</h4>
          <p style="margin: 8px 0;"><strong>IBAN:</strong> KW91NBOK0000000000001000372151</p>
          <p style="margin: 8px 0;"><strong>Ø§Ù„Ø¨Ù†Ùƒ:</strong> Ø¨Ù†Ùƒ Ø§Ù„ÙƒÙˆÙŠØª Ø§Ù„ÙˆØ·Ù†ÙŠ</p>
          <p style="margin: 8px 0;"><strong>Ø§Ù„Ù…Ø³ØªÙÙŠØ¯:</strong> Ø´Ø±ÙƒØ© Ø¬ÙØª Ø³ØªØ§Ø±</p>
          <div style="margin-top: 15px; padding: 10px; background: rgba(243,156,18,0.1); border-radius: 8px; color: #f39c12;">
            âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„
          </div>
        </div>

        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙØ¹ Ù†Ù‚Ø¯Ø§Ù‹ -->
        <div id="cashInfo" style="display:none; margin-top: 20px; padding: 20px; background: rgba(200,169,110,0.1); border-radius: var(--radius);">
          <p>ğŸ“¦ Ø³ÙŠØªÙ… Ø§Ù„Ø¯ÙØ¹ Ù†Ù‚Ø¯Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</p>
          <p style="font-size: 13px; color: var(--text-muted); margin-top: 5px;">ÙŠØ±Ø¬Ù‰ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</p>
        </div>
      </div>

      <button class="btn-primary" style="width: 100%; padding: 18px; font-size: 18px; margin: 20px 0;" onclick="placeOrder()" id="placeOrderBtn">
        <span>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</span>
        <span style="background: rgba(0,0,0,0.2); padding: 5px 15px; border-radius: 30px; margin-right: 10px;" id="btnTotal"></span>
      </button>

      <p style="text-align: center; font-size: 13px; color: var(--text-muted);">
        Ø¨Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ "Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨" ÙØ¥Ù†Ùƒ ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ 
        <a href="#" style="color: var(--primary);">Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</a> Ùˆ <a href="#" style="color: var(--primary);">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a>
      </p>
    </div>

    <!-- Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠØ³Ø± - Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨ -->
    <div>
      <div class="checkout-section">
        <h3>ğŸ›’ Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨</h3>
        
        <div id="orderItems" style="max-height: 300px; overflow-y: auto; margin-bottom: 20px;"></div>
        
        <div style="background: var(--secondary); padding: 15px; border-radius: var(--radius);">
          <div style="display: flex; justify-content: space-between; padding: 8px 0; color: var(--text-muted);">
            <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ</span>
            <span id="chkSubtotal">0.000 Ø¯.Ùƒ</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 8px 0; color: var(--text-muted);">
            <span>Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</span>
            <span id="chkDelivery">1.500 Ø¯.Ùƒ</span>
          </div>
          <div id="discountRow" style="display: none; justify-content: space-between; padding: 8px 0; color: var(--success);">
            <span>Ø®ØµÙ…</span>
            <span id="chkDiscount">-0.000 Ø¯.Ùƒ</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 15px 0 0; margin-top: 10px; border-top: 2px solid var(--border); font-size: 18px; font-weight: 700;">
            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</span>
            <span style="color: var(--primary); font-size: 20px;" id="chkTotal">0.000 Ø¯.Ùƒ</span>
          </div>
        </div>

        <!-- ÙƒÙˆØ¯ Ø®ØµÙ… -->
        <div style="display: flex; gap: 10px; margin: 20px 0;">
          <input type="text" id="promoCode" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…" style="flex: 1;">
          <button class="btn-outline" style="padding: 10px 20px;" onclick="applyPromo()">ØªØ·Ø¨ÙŠÙ‚</button>
        </div>

        <!-- Ø¶Ù…Ø§Ù†Ø§Øª -->
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
          <div style="display: flex; align-items: center; gap: 5px; font-size: 12px; color: var(--text-muted);">
            <span style="color: var(--success); font-weight: 700;">âœ“</span>
            <span>Ø¯ÙØ¹ Ø¢Ù…Ù†</span>
          </div>
          <div style="display: flex; align-items: center; gap: 5px; font-size: 12px; color: var(--text-muted);">
            <span style="color: var(--success); font-weight: 700;">âœ“</span>
            <span>ØªÙˆØµÙŠÙ„ Ø³Ø±ÙŠØ¹</span>
          </div>
          <div style="display: flex; align-items: center; gap: 5px; font-size: 12px; color: var(--text-muted);">
            <span style="color: var(--success); font-weight: 700;">âœ“</span>
            <span>Ø¬ÙˆØ¯Ø© Ù…Ø¶Ù…ÙˆÙ†Ø©</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ -->
<div class="modal-overlay" id="confirmModal" style="display: none;">
  <div class="modal-card">
    <div class="modal-header">
      <h3>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</h3>
      <button class="modal-close" onclick="closeConfirmModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <p>Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ØŸ</p>
      <div id="confirmDetails" style="margin-top: 20px; padding: 15px; background: var(--secondary); border-radius: var(--radius);"></div>
    </div>
    <div class="modal-footer">
      <button class="btn-outline" onclick="closeConfirmModal()">Ø¥Ù„ØºØ§Ø¡</button>
      <button class="btn-primary" onclick="processOrder()">ØªØ£ÙƒÙŠØ¯ ÙˆØ¥ØªÙ…Ø§Ù…</button>
    </div>
  </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ù†Ø¬Ø§Ø­ Ø§Ù„Ø·Ù„Ø¨ -->
<div class="modal-overlay" id="successModal" style="display: none;">
  <div class="modal-card" style="max-width: 400px;">
    <div class="modal-body" style="text-align: center; padding: 40px;">
      <div style="width: 80px; height: 80px; background: var(--success); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 40px; margin: 0 auto;">âœ“</div>
      <h3 style="color: var(--success); margin: 20px 0;">ØªÙ… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!</h3>
      <p style="color: var(--text-muted);">Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</p>
      <div style="margin-top: 30px;">
        <a href="receipt.html" class="btn-primary">Ø¹Ø±Ø¶ Ø§Ù„Ø¥ÙŠØµØ§Ù„</a>
        <a href="index.html" class="btn-outline" style="margin-right: 10px;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      </div>
    </div>
  </div>
</div>

<footer class="site-footer">
  <div class="footer-bottom">
    <p>Â© 2024 Gift Star. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© - Ø§Ù„ÙƒÙˆÙŠØª</p>
  </div>
</footer>

<div class="stars-bg"></div>

<script src="js/data.js"></script>
<script>
// =========================================
// Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
// =========================================
let selectedPayment = null;
let paymentMethods = [];
let appliedPromo = null;
let orderTotal = 0;
let currentOrder = null;

// =========================================
// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
// =========================================
function init() {
  console.log('Ø¨Ø¯Ø¡ ØªÙ‡ÙŠØ¦Ø© ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹...');
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  const user = typeof giftstar !== 'undefined' ? giftstar.getCurrentUser() : getCurrentUser();
  
  if (!user) { 
    console.log('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
    sessionStorage.setItem('giftstar_redirect_after_login', 'checkout.html');
    window.location.href = 'login.html?msg=login_required'; 
    return; 
  }

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø³Ù„Ø©
  const cart = typeof giftstar !== 'undefined' ? giftstar.getCart() : getCart();
  console.log('Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø³Ù„Ø©:', cart);
  
  if (!cart || cart.length === 0) { 
    console.log('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©');
    window.location.href = 'cart.html'; 
    return; 
  }

  // ØªØ¹Ø¨Ø¦Ø© Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  const nameInput = document.getElementById('delivName');
  if (nameInput && user.name) {
    nameInput.value = user.name;
  }
  
  // ØªØ¹Ø¨Ø¦Ø© Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
  const phoneInput = document.getElementById('delivPhone');
  if (phoneInput && user.phone) {
    phoneInput.value = user.phone;
  }
  
  // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ù„Ø©
  if (typeof giftstar !== 'undefined') {
    giftstar.updateCartBadge();
  } else {
    updateCartBadge();
  }
  
  // Ø­Ø³Ø§Ø¨ ÙˆØ¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨
  calculateOrderTotal();
  
  // ØªØ­Ù…ÙŠÙ„ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹
  loadPaymentMethods();
}

// =========================================
// Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹
// =========================================
function loadPaymentMethods() {
  console.log('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹...');
  
  const paymentMethodsEl = document.getElementById('paymentMethods');
  if (!paymentMethodsEl) {
    console.error('Ø¹Ù†ØµØ± Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
    return;
  }
  
  // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ù…Ù† localStorage
  try {
    const savedMethods = localStorage.getItem('giftstar_payment_methods');
    console.log('Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©:', savedMethods);
    
    if (savedMethods) {
      paymentMethods = JSON.parse(savedMethods);
      console.log('Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø­Ù…Ù„Ø©:', paymentMethods);
    }
  } catch (e) {
    console.error('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹:', e);
  }
  
  // Ø¥Ø°Ø§ Ù…Ø§ ÙÙŠ Ø·Ø±Ù‚ Ø¯ÙØ¹ Ù…Ø­ÙÙˆØ¸Ø©ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
  if (!paymentMethods || paymentMethods.length === 0) {
    console.log('Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
    paymentMethods = [
      { id: 1, name: "Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†ÙŠØ© / Ù…Ø¯ÙŠÙ†", description: "Visa, Mastercard", icon: "card", active: true },
      { id: 3, name: "ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ", description: "ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ Ù…Ø¨Ø§Ø´Ø±", icon: "bank", active: true },
      { id: 4, name: "Ù†Ù‚Ø¯Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…", description: "Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…", icon: "cash", active: true }
    ];
    
    // Ø­ÙØ¸ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    try {
      localStorage.setItem('giftstar_payment_methods', JSON.stringify(paymentMethods));
      console.log('ØªÙ… Ø­ÙØ¸ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
    } catch (e) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹:', e);
    }
  }
  
  // ØªØµÙÙŠØ© Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„Ù†Ø´Ø·Ø© ÙÙ‚Ø·
  paymentMethods = paymentMethods.filter(m => m.active !== false);
  console.log('Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ø¨Ø¹Ø¯ Ø§Ù„ØªØµÙÙŠØ©:', paymentMethods);
  
  // Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹
  const icons = {
    card: `<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>`,
    bank: `<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 22V12M7 22V12M11 22V12M15 22V12M19 22V12M1 12l11-9 11 9"/></svg>`,
    cash: `<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>`
  };

  // Ø¹Ø±Ø¶ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹
  let html = '';
  
  paymentMethods.forEach(m => {
    html += `
      <div class="payment-method" onclick="selectPayment('${m.icon || 'cash'}', this, ${m.id})" id="pm_${m.id}" style="cursor: pointer; display: flex; align-items: center; gap: 15px; padding: 15px; border: 2px solid var(--border); border-radius: var(--radius); margin-bottom: 10px; transition: var(--transition);">
        <input type="radio" name="payment" value="${m.id}" style="width: 20px; height: 20px; accent-color: var(--primary);">
        <div class="payment-icon" style="color: var(--primary);">${icons[m.icon] || icons.cash}</div>
        <div class="payment-method-label" style="flex: 1;">
          <strong style="display: block; color: var(--text);">${m.name || 'Ø·Ø±ÙŠÙ‚Ø© Ø¯ÙØ¹'}</strong>
          <span style="font-size: 13px; color: var(--text-muted);">${m.description || ''}</span>
        </div>
      </div>
    `;
  });

  paymentMethodsEl.innerHTML = html;
  console.log('ØªÙ… Ø¹Ø±Ø¶ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹');

  // Ø§Ø®ØªÙŠØ§Ø± Ø£ÙˆÙ„ Ø·Ø±ÙŠÙ‚Ø© Ø¯ÙØ¹ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
  if (paymentMethods.length > 0) {
    const firstMethod = document.getElementById('pm_' + paymentMethods[0].id);
    if (firstMethod) {
      setTimeout(() => {
        selectPayment(paymentMethods[0].icon || 'cash', firstMethod, paymentMethods[0].id);
      }, 100);
    }
  }
}

// =========================================
// Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
// =========================================
function selectPayment(icon, element, id) {
  console.log('ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:', id, icon);
  
  selectedPayment = id;
  
  // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ø±Ù‚
  document.querySelectorAll('.payment-method').forEach(m => {
    m.classList.remove('selected');
    m.style.borderColor = 'var(--border)';
    m.style.background = 'none';
    const radio = m.querySelector('input[type="radio"]');
    if (radio) radio.checked = false;
  });
  
  // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
  if (element) {
    element.classList.add('selected');
    element.style.borderColor = 'var(--primary)';
    element.style.background = 'linear-gradient(135deg, rgba(200,169,110,0.1), rgba(226,201,142,0.1))';
    const radio = element.querySelector('input[type="radio"]');
    if (radio) radio.checked = true;
  }

  // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
  const cardForm = document.getElementById('cardForm');
  const bankInfo = document.getElementById('bankInfo');
  const cashInfo = document.getElementById('cashInfo');
  
  if (cardForm) cardForm.style.display = icon === 'card' ? 'block' : 'none';
  if (bankInfo) bankInfo.style.display = icon === 'bank' ? 'block' : 'none';
  if (cashInfo) cashInfo.style.display = icon === 'cash' ? 'block' : 'none';
}

// =========================================
// Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨
// =========================================
function calculateOrderTotal() {
  try {
    const cart = typeof giftstar !== 'undefined' ? giftstar.getCart() : getCart();
    const subtotal = cart.reduce((sum, item) => sum + ((item.price || 0) * (item.qty || 0)), 0);
    const delivery = subtotal > 15 ? 0 : 1.500;
    
    let discount = 0;
    if (appliedPromo) {
      discount = subtotal * 0.1;
    }
    
    orderTotal = subtotal + delivery - discount;

    // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    const orderItemsEl = document.getElementById('orderItems');
    if (orderItemsEl) {
      if (cart.length === 0) {
        orderItemsEl.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-muted);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</div>';
      } else {
        orderItemsEl.innerHTML = cart.map(item => `
          <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid var(--border);">
            <div style="display: flex; align-items: center; gap: 10px;">
              <img src="${item.image || 'https://images.unsplash.com/photo-1549465220-1a8b9238cd48?w=50&h=50&fit=crop'}" 
                   alt="${item.name || 'Ù…Ù†ØªØ¬'}" 
                   style="width: 50px; height: 50px; border-radius: 8px; object-fit: cover;" 
                   onerror="this.src='https://images.unsplash.com/photo-1549465220-1a8b9238cd48?w=50&h=50&fit=crop'">
              <div>
                <div style="font-weight: 600; color: var(--text);">${item.name || 'Ù…Ù†ØªØ¬'}</div>
                <div style="font-size: 12px; color: var(--text-muted);">Ø§Ù„ÙƒÙ…ÙŠØ©: ${item.qty || 1}</div>
              </div>
            </div>
            <div style="font-weight: 700; color: var(--primary);">${formatKWD((item.price || 0) * (item.qty || 1))}</div>
          </div>
        `).join('');
      }
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª
    const subtotalEl = document.getElementById('chkSubtotal');
    const deliveryEl = document.getElementById('chkDelivery');
    const totalEl = document.getElementById('chkTotal');
    const btnTotalEl = document.getElementById('btnTotal');
    
    if (subtotalEl) subtotalEl.textContent = formatKWD(subtotal);
    if (deliveryEl) deliveryEl.textContent = delivery === 0 ? 'Ù…Ø¬Ø§Ù†ÙŠ' : formatKWD(delivery);
    if (totalEl) totalEl.textContent = formatKWD(orderTotal);
    if (btnTotalEl) btnTotalEl.textContent = formatKWD(orderTotal);
    
    const discountRow = document.getElementById('discountRow');
    const discountEl = document.getElementById('chkDiscount');
    
    if (discount > 0) {
      if (discountRow) discountRow.style.display = 'flex';
      if (discountEl) discountEl.textContent = '-' + formatKWD(discount);
    } else {
      if (discountRow) discountRow.style.display = 'none';
    }
  } catch (e) {
    console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:', e);
  }
}

// =========================================
// Ø¯ÙˆØ§Ù„ Ø§Ù„Ø³Ù„Ø© ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù… (fallback)
// =========================================
function getCurrentUser() {
  try {
    return JSON.parse(sessionStorage.getItem('giftstar_user'));
  } catch {
    return null;
  }
}

function getCart() {
  try {
    const user = getCurrentUser();
    if (user) {
      const cart = localStorage.getItem('giftstar_cart_' + user.id);
      return cart ? JSON.parse(cart) : [];
    }
    return JSON.parse(localStorage.getItem('giftstar_cart') || '[]');
  } catch {
    return [];
  }
}

function updateCartBadge() {
  try {
    const cart = getCart();
    const total = cart.reduce((sum, item) => sum + (item.qty || 0), 0);
    document.querySelectorAll('.cart-count, #cartCount').forEach(el => {
      if (el) el.textContent = total;
    });
  } catch (e) {
    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ù„Ø©:', e);
  }
}

function clearCart() {
  try {
    const user = getCurrentUser();
    if (user) {
      localStorage.removeItem('giftstar_cart_' + user.id);
    } else {
      localStorage.removeItem('giftstar_cart');
    }
    updateCartBadge();
  } catch (e) {
    console.error('Ø®Ø·Ø£ ÙÙŠ ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©:', e);
  }
}

// =========================================
// ØªÙ†Ø³ÙŠÙ‚Ø§Øª
// =========================================
function formatCard(input) {
  let v = input.value.replace(/\D/g, '').substring(0, 16);
  input.value = v.replace(/(.{4})/g, '$1 ').trim();
}

function formatExp(input) {
  let v = input.value.replace(/\D/g, '');
  if (v.length >= 2) v = v.substring(0, 2) + '/' + v.substring(2, 4);
  input.value = v;
}

function formatKWD(amount) {
  try {
    return Number(amount || 0).toFixed(3) + ' Ø¯.Ùƒ';
  } catch {
    return '0.000 Ø¯.Ùƒ';
  }
}

// =========================================
// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
// =========================================
function validateForm() {
  const name = document.getElementById('delivName')?.value.trim();
  const phone = document.getElementById('delivPhone')?.value.trim();
  const area = document.getElementById('delivArea')?.value;
  const address = document.getElementById('delivAddress')?.value.trim();

  if (!name) { showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…', 'error'); return false; }
  if (!phone) { showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ', 'error'); return false; }
  
  if (phone.length !== 8 || !/^[569]\d{7}$/.test(phone)) {
    showNotification('Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 8 Ø£Ø±Ù‚Ø§Ù… ÙˆÙŠØ¨Ø¯Ø£ Ø¨Ù€ 5 Ø£Ùˆ 6 Ø£Ùˆ 9', 'error');
    return false;
  }
  
  if (!area) { showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©', 'error'); return false; }
  if (!address) { showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', 'error'); return false; }
  if (!selectedPayment) { showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹', 'error'); return false; }

  const method = paymentMethods.find(m => m.id === selectedPayment);
  if (method && method.icon === 'card') {
    const cardNum = document.getElementById('cardNum')?.value.replace(/\s/g, '') || '';
    const cardExp = document.getElementById('cardExp')?.value || '';
    const cardCvv = document.getElementById('cardCvv')?.value || '';
    const cardName = document.getElementById('cardName')?.value.trim() || '';
    
    if (cardNum.length !== 16) { showNotification('Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ØºÙŠØ± ØµØ­ÙŠØ­', 'error'); return false; }
    if (!cardExp || !cardExp.includes('/')) { showNotification('ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ ØºÙŠØ± ØµØ­ÙŠØ­', 'error'); return false; }
    if (cardCvv.length !== 3) { showNotification('Ø±Ù…Ø² CVV ØºÙŠØ± ØµØ­ÙŠØ­', 'error'); return false; }
    if (!cardName) { showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø­Ø§Ù…Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©', 'error'); return false; }
  }

  return true;
}

// =========================================
// Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
// =========================================
function showNotification(msg, type) {
  if (typeof giftstar !== 'undefined' && giftstar.showNotification) {
    giftstar.showNotification(msg, type);
  } else {
    const el = document.createElement('div');
    el.className = 'notification ' + type;
    el.textContent = msg;
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 3000);
  }
}

// =========================================
// Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨
// =========================================
function placeOrder() {
  if (!validateForm()) return;
  
  const method = paymentMethods.find(m => m.id === selectedPayment);
  const confirmDetails = document.getElementById('confirmDetails');
  
  if (confirmDetails) {
    confirmDetails.innerHTML = `
      <p><strong>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</strong> ${method?.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
      <p><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong> ${formatKWD(orderTotal)}</p>
    `;
  }
  
  const confirmModal = document.getElementById('confirmModal');
  if (confirmModal) {
    confirmModal.style.display = 'flex';
  }
}

function closeConfirmModal() {
  const confirmModal = document.getElementById('confirmModal');
  if (confirmModal) {
    confirmModal.style.display = 'none';
  }
}

function processOrder() {
  closeConfirmModal();
  
  const btn = document.getElementById('placeOrderBtn');
  const originalText = btn ? btn.innerHTML : '';
  
  if (btn) {
    btn.innerHTML = '<span>Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨...</span>';
    btn.disabled = true;
  }

  try {
    const name = document.getElementById('delivName')?.value.trim() || '';
    const phone = document.getElementById('delivPhone')?.value.trim() || '';
    const area = document.getElementById('delivArea')?.value || '';
    const address = document.getElementById('delivAddress')?.value.trim() || '';
    const notes = document.getElementById('delivNotes')?.value.trim() || '';
    
    const user = typeof giftstar !== 'undefined' ? giftstar.getCurrentUser() : getCurrentUser();
    const cart = typeof giftstar !== 'undefined' ? giftstar.getCart() : getCart();
    const subtotal = cart.reduce((sum, item) => sum + ((item.price || 0) * (item.qty || 0)), 0);
    const delivery = subtotal > 15 ? 0 : 1.500;
    const method = paymentMethods.find(m => m.id === selectedPayment);
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨
    const orderData = {
      customer: { name, phone, area, address, notes },
      items: cart,
      subtotal: subtotal,
      delivery: delivery,
      total: orderTotal,
      paymentMethod: method ? method.name : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
      paymentIcon: method ? method.icon : 'cash',
      userEmail: user ? user.email : null
    };
    
    let order;
    
    // Ø§Ø³ØªØ®Ø¯Ø§Ù… giftstar Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØ§Ø­Ø§Ù‹
    if (typeof giftstar !== 'undefined' && giftstar.createOrder) {
      order = giftstar.createOrder(orderData);
    } else {
      // Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ Ù…Ø­Ù„ÙŠØ§Ù‹
      const orders = JSON.parse(localStorage.getItem('giftstar_orders') || '[]');
      order = {
        id: 'GS' + Date.now() + '-' + Math.floor(Math.random() * 10000),
        ...orderData,
        userId: user ? user.id : null,
        date: new Date().toLocaleDateString('ar-KW'),
        time: new Date().toLocaleTimeString('ar-KW'),
        status: 'new',
        statusHistory: [{
          status: 'new',
          date: new Date().toISOString(),
          note: 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­'
        }],
        createdAt: new Date().toISOString()
      };
      
      orders.unshift(order);
      localStorage.setItem('giftstar_orders', JSON.stringify(orders));
    }
    
    console.log('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨:', order);
    
    // Ø­ÙØ¸ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
    localStorage.setItem('giftstar_last_order', JSON.stringify(order));
    sessionStorage.setItem('giftstar_last_order', JSON.stringify(order));
    
    // ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©
    if (typeof giftstar !== 'undefined' && giftstar.clearCart) {
      giftstar.clearCart();
    } else {
      clearCart();
    }
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
    const successModal = document.getElementById('successModal');
    if (successModal) {
      successModal.style.display = 'flex';
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ù„Ø©
    if (typeof giftstar !== 'undefined' && giftstar.updateCartBadge) {
      giftstar.updateCartBadge();
    } else {
      updateCartBadge();
    }
    
    showNotification('ØªÙ… Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
    
  } catch (error) {
    console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨:', error);
    showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨', 'error');
    
    if (btn) {
      btn.innerHTML = originalText;
      btn.disabled = false;
    }
  }
}

// =========================================
// ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…
// =========================================
function applyPromo() {
  const code = document.getElementById('promoCode')?.value.trim() || '';
  
  if (code === 'GIFT10' || code === 'STAR20' || code === 'WELCOME15') {
    appliedPromo = code;
    calculateOrderTotal();
    showNotification('ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ… Ø¨Ù†Ø¬Ø§Ø­', 'success');
  } else {
    showNotification('ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ… ØºÙŠØ± ØµØ§Ù„Ø­', 'error');
  }
}

// =========================================
// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
// =========================================
function logout() {
  if (typeof giftstar !== 'undefined' && giftstar.logout) {
    giftstar.logout();
  } else {
    sessionStorage.removeItem('giftstar_user');
    window.location.href = 'index.html';
  }
}

// =========================================
// Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
// =========================================
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>